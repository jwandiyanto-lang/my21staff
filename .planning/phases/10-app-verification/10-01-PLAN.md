---
phase: 10-app-verification
plan: 01
type: execute
---

<objective>
Verify CRM displays synced contacts and fix any data flow issues between n8n, Supabase, and my21staff.

Purpose: Ensure the Google Sheets → n8n → Supabase → CRM data pipeline works end-to-end.
Output: All contacts visible in CRM with correct data.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-app-verification/10-CONTEXT.md

**n8n Instance:** http://100.113.96.25:5678 (Tailscale)
**CRM:** localhost:3000
**Workspace ID:** 0318fda5-22c4-419b-bdd8-04471b818d17

**Current Status:**
- 18 contacts synced to Supabase
- 144 pending (upsert config issue)
- CRM verification needed
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Fix n8n Upsert Configuration</action>
  <instructions>
In n8n workflow "Sheets to Database Sync":

1. Open the "Upsert to Database" node
2. Find "Columns to Match On" option
3. Add: `phone` and `workspace_id`
4. This tells n8n to update existing contacts (matching phone+workspace) or insert new ones
5. Save the workflow

Then click "Execute Workflow" to sync all 144 contacts.
  </instructions>
  <verification>Execution shows green checkmarks on all nodes, ~144 records processed</verification>
  <resume-signal>Type "synced" when all contacts are synced</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Verify CRM displays contacts</name>
  <files>Browser verification</files>
  <action>
Open my21staff CRM and verify:

1. Navigate to localhost:3000
2. Log in if needed
3. Go to Database/Contacts page
4. Check that synced contacts appear
5. Verify data fields:
   - Name displays correctly
   - Phone in +62xxx format
   - Lead status shows (new/hot/warm/cold)
   - Email if present

If contacts don't appear:
- Check browser console for errors
- Verify workspace_id matches logged-in user's workspace
- Check Supabase RLS policies
  </action>
  <verify>Contacts from Google Sheets visible in CRM with correct data</verify>
  <done>CRM displays synced contacts correctly</done>
</task>

<task type="auto">
  <name>Task 3: Fix data flow issues (if any)</name>
  <files>src/app/*, src/lib/*</files>
  <action>
If contacts don't display correctly, investigate and fix:

1. **Workspace ID mismatch:**
   - Query: SELECT DISTINCT workspace_id FROM contacts
   - Compare with CRM's workspace_id
   - Update n8n transform if needed

2. **RLS Policy issues:**
   - Check Supabase RLS for contacts table
   - Ensure user can read contacts in their workspace

3. **Data format issues:**
   - Phone number format consistency
   - Status enum values
   - Required fields present

Document any fixes made.
  </action>
  <verify>All data flow issues resolved</verify>
  <done>Data flows correctly from Sheets → n8n → Supabase → CRM</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] All ~144 contacts synced via n8n
- [ ] Contacts visible in my21staff CRM
- [ ] Data displays correctly (name, phone, status)
- [ ] No console errors
- [ ] End-to-end flow verified
</verification>

<success_criteria>

- All Google Sheets contacts synced to Supabase
- Contacts display correctly in my21staff CRM
- Phone format consistent (+62xxx)
- Lead status mapping works
- No data flow errors

</success_criteria>

<output>
After completion, create `.planning/phases/10-app-verification/10-01-SUMMARY.md`:

# Phase 10 Plan 1: App Verification Summary

**[One-liner about what was accomplished]**

## Accomplishments

- All contacts synced from Google Sheets
- CRM displays synced contacts
- Data flow verified end-to-end

## Verification Results

- Total contacts synced: [number]
- Display issues fixed: [list or none]
- Data integrity: [status]

## Next Step

v1.2 milestone complete. Ready for production deployment.
</output>
