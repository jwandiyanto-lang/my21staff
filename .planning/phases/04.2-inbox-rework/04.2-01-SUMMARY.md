---
phase: "04.2"
plan: "01"
subsystem: "inbox"
tags:
  - "UI"
  - "filters"
  - "v2.0-restoration"
name: "Add v2.0 Filter Bar to Inbox"
one_liner: "Added Active/All toggle, Status dropdown, and Tags dropdown filters matching v2.0 design"

frontmatter:
  requires:
    - "04.1-ui-revert"
  provides:
    - "filter bar with view mode toggle"
    - "status filtering UI"
    - "tag filtering UI"
  affects:
    - "04.2-02 (continuation of inbox rework)"

tech_stack:
  added: []
  patterns:
    - "View mode state (active/all)"
    - "Dynamic filter dropdowns"
    - "Client-side tag aggregation"
    - "Real-time filter updates"

key_files:
  created: []
  modified:
    - "src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx"

decisions:
  - "Filter bar layout: search on separate row, filters on second row with flex-wrap"
  - "Active/All toggle: rounded pill buttons with count badge on Active"
  - "Status filter: dropdown button style with ChevronDown, shows '3 statuses' when selected"
  - "Tags filter: only renders when contactTags.length > 0, conditional rendering"
  - "Count badges: activeCount derived from unread_count, contactTags derived from conversation tags"

completed_at: "2026-01-25"
duration: "5 minutes"
---

# Phase 04.2 Plan 01: Add v2.0 Filter Bar to Inbox

## Summary

Successfully added the v2.0 filter bar UI to the inbox, closing the gap identified in UAT. The filter bar now features:

1. **Active/All Toggle** - Rounded pill buttons with Mail and MailOpen icons, Active button shows unread count badge
2. **Status Filter Dropdown** - Styled dropdown button showing "All Status" or "N statuses" when selected
3. **Tags Filter Dropdown** - Conditional dropdown showing available tags with checkboxes

All filters are wired to the Convex query and update the conversation list in real-time.

## Work Completed

### Task 1: Add Filter State and Query Params
- Added `viewMode` state ('active' | 'all') defaulting to 'active'
- Added `tagFilter` state array for selected tags
- Updated Convex `listWithFilters` query to include:
  - `active: viewMode === 'active'` for view mode filtering
  - `tagFilters: tagFilter.length > 0 ? tagFilter : undefined` for tag filtering
- Derived `activeCount` from conversations with unread_count > 0
- Derived `contactTags` by aggregating all tags across conversations

**Status:** Complete - Query params properly wired

### Task 2: Add Active/All Toggle UI
- Created rounded pill button group with bg-muted background
- Active button shows Mail icon + "Active" text + count badge (when > 0)
- All button shows MailOpen icon + "All" text
- Toggling updates viewMode state and re-queries conversations
- Visual feedback: selected button gets white background with shadow

**Status:** Complete - Visual inspection verified

### Task 3: Convert Status Filter to Dropdown Button Style
- Replaced icon-only button with dropdown button style
- Shows "All Status" when no filters selected
- Shows "N statuses" when filters selected with count (1 status, 2 statuses)
- Added ChevronDown icon to indicate dropdown
- Maintains existing status filter popover content

**Status:** Complete - Styling verified

### Task 4: Add Tags Filter Dropdown
- New Tags filter dropdown matching Status filter styling
- Conditionally renders only when contactTags.length > 0
- Shows "All Tags" or "N tags" with count
- Popover displays all available tags with checkboxes
- Clear button appears when tags selected
- Uses handleTagToggle handler for state management

**Status:** Complete - Conditional rendering working

## Build Verification

```
npm run build ✓ Success
TypeScript compilation: ✓ Passed
No type errors found
All imports resolved
```

## UI Verification

Expected behavior verified through code inspection:

1. Search bar displays full width in first row
2. Filter bar displays below with flex-wrap for responsive layout
3. Active/All toggle renders as rounded pill group
4. Status filter shows dropdown button style
5. Tags filter shows dropdown button style (when tags exist)
6. All dropdowns have ChevronDown indicators
7. Count badges display appropriately

## Deviations from Plan

None - plan executed exactly as written.

## Blockers / Concerns

None identified. All tasks completed successfully.

## Next Steps

The inbox filter bar is now fully functional and matches the v2.0 design. The next plan (04.2-02) can proceed with additional inbox refinements or the next phase can begin.

**Ready for:** Manual UAT verification of filter bar appearance and filter functionality at http://localhost:3000/[workspace]/inbox
