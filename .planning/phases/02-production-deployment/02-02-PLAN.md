---
phase: 02-production-deployment
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Application is deployed to production hosting with HTTPS"
    - "Production URL is accessible and returns 200 status"
    - "Environment variables are configured in hosting platform"
  artifacts:
    - path: "Railway/Render/Fly.io deployment"
      provides: "Live production application"
      contains: "HTTPS endpoint"
  key_links:
    - from: "Hosting platform"
      to: "GitHub repository"
      via: "auto-deployment webhook"
      pattern: "git push triggers deploy"
---

<objective>
Deploy application to production hosting platform with all environment variables configured.

Purpose: Move application from localhost to live production URL with proper HTTPS, environment configuration, and automated deployment pipeline.

Output: Live production application accessible via HTTPS with all 13 environment variables configured.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/jfransisco/Desktop/21/my21staff/.planning/PROJECT.md
@/home/jfransisco/Desktop/21/my21staff/.planning/ROADMAP.md
@/home/jfransisco/Desktop/21/my21staff/.planning/STATE.md
@/home/jfransisco/Desktop/21/my21staff/docs/PRODUCTION-CHECKLIST.md
@/home/jfransisco/Desktop/21/my21staff/.env.production
</context>

<tasks>

<task type="checkpoint:decision" gate="blocking">
  <decision>Choose production hosting platform</decision>
  <context>
Vercel is blocked due to billing freeze. Need alternative platform for Next.js deployment.

**Current constraints:**
- Cannot use Vercel (billing freeze per CLAUDE.md)
- Must support Next.js 15 with App Router
- Must support environment variables
- Must support automatic GitHub deployments
- Must support HTTPS with custom domain (optional initially)

**Deployment requirements:**
- Node.js 18+ runtime
- npm build process
- Environment variable injection
- HTTPS enforcement
- WebSocket support (for Convex real-time)
  </context>
  <options>
    <option id="railway">
      <name>Railway (railway.app)</name>
      <pros>
- Native Next.js support with zero config
- Automatic GitHub deployments
- Environment variables via dashboard
- Free tier: $5/month credit (hobby plan)
- HTTPS automatic with custom domains
- WebSocket support included
- Simple CLI: `railway up`
      </pros>
      <cons>
- Credit card required even for free tier
- Usage-based billing (monitor costs)
- Less established than Vercel/Netlify
      </cons>
    </option>
    <option id="render">
      <name>Render (render.com)</name>
      <pros>
- Free tier with no credit card required
- Native Next.js support
- Automatic GitHub deployments
- Environment variables via dashboard
- HTTPS automatic
- Established platform (acquired by DigitalOcean)
      </pros>
      <cons>
- Free tier spins down after inactivity (cold starts)
- Build time limits on free tier
- Less flexible than Railway
      </cons>
    </option>
    <option id="flyio">
      <name>Fly.io</name>
      <pros>
- Generous free tier (3 VMs)
- No cold starts (always-on)
- Global edge deployment
- Native Next.js support via Dockerfile
- HTTPS automatic
- WebSocket support
      </pros>
      <cons>
- Requires Dockerfile configuration
- More complex setup than Railway/Render
- Credit card required for free tier
- CLI-focused (less dashboard UX)
      </cons>
    </option>
  </options>
  <resume-signal>
Select one of: railway, render, flyio

Or type "other: [platform-name]" to specify different platform
  </resume-signal>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Deploy application to chosen hosting platform</action>
  <instructions>
**Prerequisites:**
- Plan 02-01 complete (build passing, .env.production template ready)
- Platform decision made (Railway/Render/Fly.io)
- GitHub repository accessible

**Deployment steps:**

### Option A: Railway

1. **Create Railway account:**
   - Visit https://railway.app
   - Sign up with GitHub account

2. **Create new project:**
   - Click "New Project"
   - Select "Deploy from GitHub repo"
   - Choose `my21staff` repository
   - Railway auto-detects Next.js

3. **Configure environment variables:**
   - Click "Variables" tab
   - Add all 13 variables from `.env.production` template:
     ```
     NEXT_PUBLIC_DEV_MODE=false
     NEXT_PUBLIC_CONVEX_URL=https://intent-otter-212.convex.cloud
     CONVEX_DEPLOY_KEY=[from Convex dashboard]
     NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=[from Clerk dashboard]
     CLERK_SECRET_KEY=[from Clerk dashboard]
     NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
     NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
     NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/eagle-overseas
     NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/eagle-overseas
     KAPSO_API_KEY=[from Kapso dashboard]
     KAPSO_API_URL=https://api.kapso.ai/v1
     KAPSO_WEBHOOK_SECRET=[from Kapso dashboard]
     CONVEX_DEPLOYMENT=prod:intent-otter-212
     ```
   - Click "Deploy" to trigger build

4. **Wait for deployment:**
   - Railway builds and deploys automatically
   - Check build logs for errors
   - Deployment typically takes 2-5 minutes

5. **Get production URL:**
   - Railway provides URL like: `my21staff-production.up.railway.app`
   - Copy this URL for smoke testing

### Option B: Render

1. **Create Render account:**
   - Visit https://render.com
   - Sign up with GitHub account

2. **Create new web service:**
   - Click "New +" â†’ "Web Service"
   - Connect GitHub repository: `my21staff`
   - Render auto-detects Next.js

3. **Configure build settings:**
   - Name: `my21staff-production`
   - Branch: `master`
   - Build Command: `npm install && npm run build`
   - Start Command: `npm start`

4. **Configure environment variables:**
   - Scroll to "Environment Variables"
   - Click "Add Environment Variable"
   - Add all 13 variables from `.env.production` template (same as Railway)

5. **Deploy:**
   - Click "Create Web Service"
   - Render builds and deploys automatically
   - Check build logs for errors

6. **Get production URL:**
   - Render provides URL like: `my21staff-production.onrender.com`
   - Copy this URL for smoke testing

### Option C: Fly.io

1. **Install Fly CLI:**
   ```bash
   curl -L https://fly.io/install.sh | sh
   ```

2. **Authenticate:**
   ```bash
   fly auth login
   ```

3. **Initialize app:**
   ```bash
   cd ~/Desktop/21/my21staff
   fly launch
   ```
   - Choose app name: `my21staff-production`
   - Choose region: Singapore (closest to Indonesia)
   - Do NOT deploy yet

4. **Set environment variables:**
   ```bash
   fly secrets set NEXT_PUBLIC_DEV_MODE=false
   fly secrets set NEXT_PUBLIC_CONVEX_URL=https://intent-otter-212.convex.cloud
   # ... (repeat for all 13 variables)
   ```

5. **Deploy:**
   ```bash
   fly deploy
   ```

6. **Get production URL:**
   ```bash
   fly status
   ```
   - URL will be: `https://my21staff-production.fly.dev`

**After deployment (any platform):**

Confirm deployment succeeded:
- Visit production URL in browser
- Should see landing page or redirect to sign-in
- Should show HTTPS (lock icon in browser)
- Should NOT show any build errors

Type "deployed" with the production URL when ready to continue.

Example: "deployed https://my21staff-production.up.railway.app"
  </instructions>
  <resume-signal>
Type: deployed [production-url]

Example: deployed https://my21staff-production.up.railway.app
  </resume-signal>
</task>

</tasks>

<verification>
After deployment:

1. Production URL is accessible (HTTP 200)
2. HTTPS is enforced (no HTTP access)
3. Environment variables are configured (13 total)
4. Auto-deployment from GitHub is configured
5. Build logs show no errors
</verification>

<success_criteria>
1. Application deployed to Railway/Render/Fly.io successfully
2. Production URL accessible via HTTPS
3. All 13 environment variables configured in hosting platform
4. Build completed without errors
5. Landing page or sign-in page loads correctly
6. No "Environment variable not found" errors in logs
</success_criteria>

<output>
After completion, create `.planning/phases/02-production-deployment/02-02-SUMMARY.md` including:
- Chosen platform (Railway/Render/Fly.io)
- Production URL
- Deployment duration
- Any deployment warnings or notes
</output>
