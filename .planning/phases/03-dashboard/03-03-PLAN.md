---
phase: 03-dashboard
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/dashboard/activity-feed.tsx
  - src/components/dashboard/onboarding-checklist.tsx
  - src/app/(dashboard)/[workspace]/dashboard-client.tsx
autonomous: true

must_haves:
  truths:
    - "Activity feed shows recent notes"
    - "Activity items link to contact detail"
    - "Load more button fetches additional items"
    - "Empty workspace shows onboarding checklist"
    - "Onboarding auto-hides when all steps complete"
  artifacts:
    - path: "src/components/dashboard/activity-feed.tsx"
      provides: "Infinite scroll activity list"
      min_lines: 50
    - path: "src/components/dashboard/onboarding-checklist.tsx"
      provides: "First-time user guidance"
      min_lines: 60
  key_links:
    - from: "src/components/dashboard/activity-feed.tsx"
      to: "api.dashboard.listActivity"
      via: "usePaginatedQuery hook"
      pattern: "usePaginatedQuery.*dashboard\\.listActivity"
    - from: "src/components/dashboard/onboarding-checklist.tsx"
      to: "stats.hasKapsoConnected, stats.hasContacts"
      via: "conditional rendering"
      pattern: "hasKapsoConnected.*hasContacts"
---

<objective>
Add activity feed with infinite scroll and onboarding checklist for empty workspaces.

Purpose: Activity feed shows recent workspace activity so users stay informed. Onboarding checklist guides new users through setup steps until their workspace has contacts and conversations.

Output: Activity feed component and onboarding checklist, integrated into dashboard.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-dashboard/03-CONTEXT.md
@.planning/phases/03-dashboard/03-RESEARCH.md
@.planning/phases/03-dashboard/03-01-SUMMARY.md
@.planning/phases/03-dashboard/03-02-SUMMARY.md
@src/app/(dashboard)/[workspace]/dashboard-client.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ActivityFeed component with infinite scroll</name>
  <files>src/components/dashboard/activity-feed.tsx</files>
  <action>
Create activity-feed.tsx following RESEARCH.md pagination pattern:

'use client' directive

Imports:
- usePaginatedQuery from convex/react
- api from convex/_generated/api
- Card, CardContent, CardHeader, CardTitle from @/components/ui/card
- Button from @/components/ui/button
- StickyNote, Loader2 from lucide-react
- formatWIB or date-fns format with Indonesian locale for timestamps
- Link from next/link (for click navigation)
- type Id from convex/_generated/dataModel

Interface ActivityFeedProps:
- workspaceId: Id<'workspaces'>
- workspaceSlug: string

Component implementation:
1. Use usePaginatedQuery for api.dashboard.listActivity:
   - args: { workspace_id: workspaceId as any }
   - options: { initialNumItems: 20 }

2. Extract { results, status, loadMore } from usePaginatedQuery

3. Render Card with "Aktivitas Terbaru" title

4. Map results to activity items:
   - Each item shows: icon (StickyNote for notes), content preview (truncated), contact name, relative timestamp
   - Per CONTEXT.md: Note activity links to contact detail dialog
   - Wrap in Link or use onClick to open contact detail (for now, link to /database?contact=ID)
   - Use formatWIB() for Indonesian locale dates (or formatDistanceToNow from date-fns with { locale: id })

5. Load more button:
   - Show if status === 'CanLoadMore'
   - onClick: () => loadMore(10)
   - Text: "Muat lebih banyak"

6. Empty state:
   - If results.length === 0 and status !== 'LoadingFirstPage'
   - Show "Belum ada aktivitas" message

7. Loading state:
   - If status === 'LoadingFirstPage', show spinner
   - If status === 'LoadingMore', show spinner below list
  </action>
  <verify>
Activity feed renders with real data. Load more button works. Clicking activity navigates correctly.
  </verify>
  <done>
ActivityFeed shows paginated workspace activity with infinite scroll.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create OnboardingChecklist component</name>
  <files>src/components/dashboard/onboarding-checklist.tsx</files>
  <action>
Create onboarding-checklist.tsx following RESEARCH.md pattern:

'use client' directive

Imports:
- Card, CardContent, CardHeader, CardTitle, CardDescription from @/components/ui/card
- CheckCircle2, Circle, ArrowRight from lucide-react
- Link from next/link

Interface OnboardingChecklistProps:
- workspaceSlug: string
- stats: { hasKapsoConnected, hasContacts, hasConversations }

Define steps array:
```typescript
const steps = [
  {
    id: 'connect',
    title: 'Hubungkan WhatsApp',
    description: 'Integrasikan nomor WhatsApp bisnis Anda',
    check: (s: Stats) => s.hasKapsoConnected,
    href: (slug: string) => `/${slug}/team`, // Team page has integration info
  },
  {
    id: 'contacts',
    title: 'Tambah Kontak',
    description: 'Impor atau tambah kontak pertama Anda',
    check: (s: Stats) => s.hasContacts,
    href: (slug: string) => `/${slug}/database`,
  },
  {
    id: 'conversation',
    title: 'Mulai Percakapan',
    description: 'Kirim pesan pertama ke kontak',
    check: (s: Stats) => s.hasConversations,
    href: (slug: string) => `/${slug}/inbox`,
  },
]
```

Component implementation:
1. Calculate completedCount from steps filter
2. Per CONTEXT.md: Auto-hide when all steps complete - return null if allComplete
3. Card with:
   - Title: "Mulai dengan my21staff"
   - Description showing progress (completedCount/steps.length)
4. Map steps to clickable items:
   - Green background + CheckCircle2 if complete
   - Hover state + Circle + ArrowRight if incomplete
   - Link to step.href(workspaceSlug)
  </action>
  <verify>
Onboarding checklist shows correct step states. Completed steps show green. Clicking navigates.
  </verify>
  <done>
OnboardingChecklist guides new users through setup and auto-hides when complete.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate activity feed and onboarding into dashboard</name>
  <files>src/app/(dashboard)/[workspace]/dashboard-client.tsx</files>
  <action>
Update dashboard-client.tsx to include new components:

1. Import ActivityFeed from @/components/dashboard/activity-feed
2. Import OnboardingChecklist from @/components/dashboard/onboarding-checklist

3. Update render logic:
   - Check if workspace is "onboarded": stats.hasContacts && stats.hasConversations && stats.hasKapsoConnected
   - If NOT onboarded: Show OnboardingChecklist prominently (before or instead of activity feed)
   - If onboarded: Show ActivityFeed

4. Layout structure:
```tsx
<div className="p-6 space-y-6">
  {/* Header */}
  <div>
    <h1 className="text-2xl font-bold">Dashboard</h1>
    <p className="text-muted-foreground">Selamat datang di {workspaceSlug}</p>
  </div>

  {/* Stats Cards */}
  <StatsCards stats={stats} timeFilter={timeFilter} onTimeFilterChange={setTimeFilter} />

  {/* Quick Actions */}
  <QuickActions workspaceSlug={workspaceSlug} />

  {/* Onboarding or Activity Feed */}
  {!isOnboarded && (
    <OnboardingChecklist workspaceSlug={workspaceSlug} stats={stats} />
  )}

  {isOnboarded && (
    <ActivityFeed workspaceId={workspaceId} workspaceSlug={workspaceSlug} />
  )}
</div>
```

5. Per CONTEXT.md decision: Onboarding auto-hides when all steps complete (not manually dismissable)
  </action>
  <verify>
Dashboard shows onboarding for empty workspace. Dashboard shows activity feed for active workspace.
  </verify>
  <done>
Dashboard conditionally displays onboarding or activity based on workspace state.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. Dashboard with empty workspace shows onboarding checklist
3. Dashboard with active workspace shows activity feed
4. Activity feed pagination works (load more button)
5. Onboarding steps update as actions are completed
</verification>

<success_criteria>
- Activity feed shows recent notes with contact info
- Load more button fetches additional activity
- Onboarding checklist shows for new workspaces
- Onboarding auto-hides when all steps complete
- UI uses Indonesian labels
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard/03-03-SUMMARY.md`
</output>
