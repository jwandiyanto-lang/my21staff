---
phase: 01-localhost-polish
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "ESLint reports no rules-of-hooks violations"
    - "Production build succeeds without dev mode code leaking"
    - "All /demo pages verified working end-to-end"
  artifacts:
    - path: "npm run lint output"
      provides: "Hooks compliance verification"
    - path: "npm run build output"
      provides: "Production build verification"
  key_links:
    - from: ".env.local"
      to: ".env.production.local"
      via: "NEXT_PUBLIC_DEV_MODE absence"
      pattern: "NEXT_PUBLIC_DEV_MODE should not exist in production env"
---

<objective>
Verify React hooks compliance, production build safety, and complete localhost polish.

Purpose: Ensure all localhost flows work correctly, React hooks follow rules (LOCALHOST-07), and no dev mode code leaks to production (LOCALHOST-06). Final verification checkpoint confirms production-readiness.
Output: Verified, production-ready localhost build with all success criteria met.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-localhost-polish/01-02-SUMMARY.md
@.planning/phases/01-localhost-polish/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: React hooks compliance check</name>
  <files>N/A (verification only)</files>
  <action>
1. Run `npm run lint` to check for ESLint errors
2. Look specifically for `react-hooks/rules-of-hooks` violations
3. If any violations found, fix them by:
   - Moving hook calls to top of component (before any conditionals)
   - Using pattern: `const data = isDevMode ? null : useQuery(...)` instead of conditional hook calls
   - Ensuring hooks are never called inside if/else, loops, or nested functions

Common violation patterns to search for:
```bash
grep -rn "if.*useEffect\|if.*useState\|if.*useQuery\|if.*useMutation" src/
```

If violations exist, fix them. If lint passes, document the result.
  </action>
  <verify>
- `npm run lint` exits with code 0 (no errors)
- No rules-of-hooks violations in output
  </verify>
  <done>ESLint passes with no hooks violations</done>
</task>

<task type="auto">
  <name>Task 2: Production build verification</name>
  <files>N/A (verification only)</files>
  <action>
1. Temporarily rename/backup `.env.local` to ensure production env is used:
   ```bash
   mv .env.local .env.local.backup
   ```

2. Run production build:
   ```bash
   npm run build
   ```

3. Verify build succeeds without errors

4. Check that NEXT_PUBLIC_DEV_MODE is not set in production:
   - Production build should NOT have dev mode enabled
   - Mock data paths should not be reachable

5. Restore development environment:
   ```bash
   mv .env.local.backup .env.local
   ```

6. Verify .env.production.local (if exists) does NOT contain NEXT_PUBLIC_DEV_MODE=true

The build should complete successfully. If it fails, the error indicates production code depends on dev-only paths.
  </action>
  <verify>
- `npm run build` exits with code 0
- Build output shows all pages generated
- No errors about missing dev mode dependencies
- .env.local restored for continued development
  </verify>
  <done>Production build succeeds, dev mode code confirmed not leaking</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Final localhost verification</name>
  <what-built>
- Plan 01: Interactive audit completed, issues documented
- Plan 02: Slots tab added, audit issues fixed
- Plan 03: Hooks compliance verified, production build verified
  </what-built>
  <how-to-verify>
**Final walkthrough of /demo pages:**

1. **Dashboard** (http://localhost:3000/demo)
   - Stats cards showing data
   - Activity feed visible
   - Quick actions working

2. **Inbox** (http://localhost:3000/demo/inbox)
   - Conversation list loads
   - Status filter works
   - AI/Human toggle visible

3. **Database** (http://localhost:3000/demo/database)
   - Contacts table loads
   - Search/filter functional

4. **Your Intern** (http://localhost:3000/demo/knowledge-base)
   - **5 tabs visible**: Persona, Flow, Database, Scoring, Slots
   - Global AI toggle works
   - Each tab loads without errors:
     - Persona: Can edit greeting/persona text
     - Flow: Can view/edit flow configuration
     - Database: Can view knowledge base entries
     - Scoring: Can view lead scoring rules
     - Slots: Can view/add consultation slots

5. **Settings** (http://localhost:3000/demo/settings)
   - Page loads without Clerk errors

6. **Console check**
   - Open DevTools > Console
   - Navigate through all pages
   - Confirm NO red errors or unhandled rejections

**UI Polish Check:**
- Spacing consistent across pages
- Labels readable and correctly positioned
- No visual glitches or overlapping elements
  </how-to-verify>
  <resume-signal>
Confirm all checks pass by saying "approved" or list remaining issues.
  </resume-signal>
</task>

</tasks>

<verification>
- `npm run lint` passes (hooks compliance)
- `npm run build` passes (production safety)
- All /demo pages load without errors
- 5 Your Intern tabs all functional
- User confirms final verification
</verification>

<success_criteria>
- LOCALHOST-03: All /demo pages load without console errors
- LOCALHOST-04: All 5 Your Intern tabs functional
- LOCALHOST-06: Dev mode audit complete, no leaks to production
- LOCALHOST-07: React hooks compliance verified
- LOCALHOST-08: UI polish confirmed
</success_criteria>

<output>
After completion, create `.planning/phases/01-localhost-polish/01-03-SUMMARY.md`
</output>
