---
phase: 04-decision-gate
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [.planning/phases/04-decision-gate/04-DECISION.md, .planning/PROJECT.md]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Decision document exists with performance comparison table"
    - "Webhook reliability assessment documented as known migration task"
    - "Clear written decision recorded in PROJECT.md"
  artifacts:
    - path: ".planning/phases/04-decision-gate/04-DECISION.md"
      provides: "Formal decision document with rationale"
      contains: "Decision: Convex Migration"
    - path: ".planning/PROJECT.md"
      provides: "Key decision log"
      contains: "Convex migration decision"
  key_links:
    - from: "04-DECISION.md"
      to: "Phase 3 verification report"
      via: "reference to benchmark data"
      pattern: "03-convex-spike-VERIFICATION.md"
---

<objective>
Formalize the architecture decision to migrate to Convex based on quantitative performance data from Phases 2 and 3.

Purpose: Create an auditable decision record that justifies the Convex migration effort with data-backed evidence.

Output: Decision document (04-DECISION.md) and updated PROJECT.md Key Decisions table.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-decision-gate/04-CONTEXT.md
@.planning/phases/02-supabase-optimization/02-04-SUMMARY.md
@.planning/phases/10-convex-spike/03-convex-spike-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Create decision document with performance comparison</name>
  <files>.planning/phases/04-decision-gate/04-DECISION.md</files>
  <action>
    Create 04-DECISION.md with the following structure:

    ## Decision: Convex Migration (Supabase Auth + Convex Data)

    ### Executive Summary
    - Date: 2026-01-21
    - Decision: Migrate to Convex for data layer, keep Supabase for auth only
    - Rationale: 25.4x performance improvement at P95

    ### Performance Comparison Table

    | Approach | P50 | P95 | P99 | Target (500ms) | Verdict |
    |----------|-----|-----|-----|----------------|---------|
    | Supabase (Phase 2 optimized) | 504ms | 926ms | 1,446ms | NO (85% over) | Reject |
    | Convex (Phase 3 spike) | 23ms | 37ms | 2,303ms | YES (93% under) | Accept |

    ### Decision Criteria Met
    1. **Performance Target:** Convex P95 (37ms) << 500ms threshold
    2. **Speedup:** 25.4x faster at P95, 96% latency reduction
    3. **Real-time:** Built-in subscriptions (no polling needed)
    4. **Type Safety:** Generated TypeScript types for data access

    ### Webhook Reliability Assessment
    - **Status:** HTTP actions require `npx convex deploy` to be accessible
    - **Phase 3 Finding:** Direct HTTP tests failed (actions not deployed)
    - **Migration Action:** Deploy HTTP actions as part of Phase 5 IMPL-05
    - **Risk Level:** Low (deployment is standard Convex workflow)

    ### Implementation Path
    - **Phase 5 Scope:** IMPL-01 through IMPL-06 (Convex migration)
    - **Rollout Strategy:** Big-bang migration, burn the bridge
    - **Auth:** Keep Supabase for auth only (hybrid architecture validated)
    - **Fallback:** No rollback to Supabase data layer

    ### References
    - Phase 2 Optimization: .planning/phases/02-supabase-optimization/02-04-SUMMARY.md
    - Phase 3 Spike: .planning/phases/10-convex-spike/03-convex-spike-VERIFICATION.md

    Write this content to 04-DECISION.md. Use markdown formatting with tables.
  </action>
  <verify>cat .planning/phases/04-decision-gate/04-DECISION.md | grep -E "(Decision|P50|P95|Performance)"</verify>
  <done>Decision document exists with complete comparison table and rationale</done>
</task>

<task type="auto">
  <name>Record decision in PROJECT.md</name>
  <files>.planning/PROJECT.md</files>
  <action>
    Update .planning/PROJECT.md Key Decisions table with the Convex migration decision.

    Add this entry to the Key Decisions table (after existing rows):
    | Convex migration (hybrid: Supabase auth + Convex data) | 25.4x faster (37ms vs 926ms P95) | Proceed with IMPL-01 through IMPL-06 |

    Also update the "Core Value" section if needed to reflect decision outcome.

    Read existing PROJECT.md first, then write updated content preserving all existing decisions and formatting.
  </action>
  <verify>grep "Convex migration" .planning/PROJECT.md && grep "IMPL-01" .planning/PROJECT.md</verify>
  <done>Decision recorded in PROJECT.md Key Decisions table with reference to implementation path</done>
</task>

</tasks>

<verification>
1. Decision document (04-DECISION.md) exists with performance comparison table
2. PROJECT.md updated with Convex migration decision in Key Decisions
3. All GATE-01, GATE-02, GATE-03 requirements satisfied
4. Decision references Phase 2 and Phase 3 data sources
</verification>

<success_criteria>
1. 04-DECISION.md documents Convex vs Supabase comparison with P50/P95/P99
2. Webhook reliability documented as known migration task (not blocker)
3. Clear written decision: "Proceed with Convex Migration because 25.4x faster at P95"
4. Decision recorded in PROJECT.md for future reference
</success_criteria>

<output>
After completion, create `.planning/phases/04-decision-gate/04-01-SUMMARY.md`
</output>
