---
phase: 01-foundation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false
user_setup:
  - service: kapso
    why: "Kapso API access required for workspace and phone number provisioning"
    env_vars:
      - name: KAPSO_API_KEY
        source: "Kapso Dashboard -> Settings -> API Keys"
---

<objective>
Create new my21staff workspace in Kapso and provision an Indonesian WhatsApp number.

**Purpose:** Establishes the foundation for all WhatsApp messaging. The workspace (customer) owns the phone number, and the phone number is the source of all inbound messages.

**Output:**
- New Kapso customer entity for my21staff
- Connected Indonesian WhatsApp number (+62)
- Phone number ID for subsequent webhook and workflow configuration

</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md

**API endpoints to use:**
- `POST https://api.kapso.ai/platform/v1/customers` - Create workspace
- `POST https://api.kapso.ai/platform/v1/customers/{customer_id}/whatsapp/phone_numbers` - Connect number

**Key patterns from research:**
- Use Kapso's streamlined provisioning for Indonesian numbers (2 min vs 1 hour manual)
- Response includes `display_phone_number`, `status`, `webhook_verified_at`
- Phone number must be CONNECTED before webhook can be configured

</context>

<tasks>

<task type="auto">
  <name>Create Kapso workspace for my21staff</name>
  <files>none</files>
  <action>
    Use Kapso Platform API v1 to create a new customer (workspace):

    ```bash
    curl --request POST \
      --url https://api.kapso.ai/platform/v1/customers \
      --header 'Content-Type: application/json' \
      --header 'X-API-Key: ${KAPSO_API_KEY}' \
      --data '{
        "customer": {
          "name": "my21staff",
          "external_customer_id": "my21staff-v2.0"
        }
      }'
    ```

    Save the returned `customer_id` to a temporary file for subsequent tasks:
    ```bash
    echo "KAPSO_CUSTOMER_ID={customer_id}" > .kapso-customer.env
    ```

    Do NOT commit this file to git â€” it's temporary setup state.
  </action>
  <verify>
    `curl` returns 201 with JSON containing customer id
    `.kapso-customer.env` file exists with KAPSO_CUSTOMER_ID
  </verify>
  <done>
    Kapso customer "my21staff" exists with id stored in .kapso-customer.env
  </done>
</task>

<task type="auto">
  <name>Provision Indonesian WhatsApp number</name>
  <files>none</files>
  <action>
    Use Kapso's streamlined provisioning service to connect an Indonesian WhatsApp number.

    First, read the customer_id:
    ```bash
    source .kapso-customer.env && echo $KAPSO_CUSTOMER_ID
    ```

    Request a new Indonesian number via Kapso provisioning:

    ```bash
    curl --request POST \
      --url "https://api.kapso.ai/platform/v1/customers/${KAPSO_CUSTOMER_ID}/whatsapp/phone_numbers" \
      --header 'Content-Type: application/json' \
      --header 'X-API-Key: ${KAPSO_API_KEY}' \
      --data '{
        "whatsapp_phone_number": {
          "name": "my21staff Indonesia",
          "kind": "production",
          "phone_number_id": "PROVISION_NEW",
          "country_code": "ID",
          "inbound_processing_enabled": true,
          "calls_enabled": false
        }
      }'
    ```

    If the request succeeds, the response includes:
    - `id`: The phone_number_id (save to .kapso-phone.env)
    - `display_phone_number`: The +62 number (save for reference)
    - `status`: Should be CONNECTED or CONNECTING

    Save the phone number ID:
    ```bash
    echo "KAPSO_PHONE_ID={phone_number_id}" >> .kapso-customer.env
    echo "KAPSO_PHONE_NUMBER={display_phone_number}" >> .kapso-customer.env
    ```
  </action>
  <verify>
    `curl` returns 201 with phone number details
    `.kapso-customer.env` contains KAPSO_PHONE_ID
    `display_phone_number` starts with +62
  </verify>
  <done>
    Indonesian WhatsApp number provisioned and connected to my21staff workspace
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify:
- Customer exists in Kapso Dashboard (visible under Customers)
- Phone number shows +62 Indonesia with CONNECTED status
- Phone number ID is available for Plan 02 webhook configuration
</verification>

<success_criteria>
1. [ ] Kapso customer "my21staff" created
2. [ ] Indonesian (+62) WhatsApp number provisioned and connected
3. [ ] Customer ID and Phone Number ID saved for subsequent plans
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`

Summary must include:
- Customer ID generated
- Phone number ID and display number
- Connection status
</output>
---
user_setup_details:
  - step: "Retrieve KAPSO_API_KEY from Kapso Dashboard"
    instruction: "Visit https://dashboard.kapso.ai -> Settings -> API Keys -> Create or copy existing key"
    blocking: true
</objectiv
