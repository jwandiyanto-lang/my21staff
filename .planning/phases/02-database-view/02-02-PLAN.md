---
phase: 02-database-view
plan: 02
type: execute
---

<objective>
Build the lead database table with columns, filters, and status badges.

Purpose: Create the core database view that shows all contacts with filtering capabilities.
Output: Functional DataTable showing contacts with status badges and filter UI.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior summaries:
@.planning/phases/01-foundation/01-03-SUMMARY.md
@.planning/phases/02-database-view/02-01-SUMMARY.md

# Existing files:
@src/types/database.ts
@src/lib/supabase/server.ts

# v1 Reference patterns:
~/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/database/columns.tsx
~/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/database/database-client.tsx
~/Desktop/21/my21staff/src/components/ui/data-table.tsx

**Tech stack available:** Next.js 15, React 19, Shadcn/ui, Tailwind v4, Supabase, TanStack Table
**Established patterns:** Server-side data fetching, client component for interactivity
**Constraining decisions:**
- 01-03: Simplified schema (lead_status: new, hot, warm, cold, converted, lost)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add required Shadcn UI components for table</name>
  <files>src/components/ui/table.tsx, src/components/ui/badge.tsx, src/components/ui/dropdown-menu.tsx, src/components/ui/popover.tsx, src/components/ui/checkbox.tsx, src/components/ui/scroll-area.tsx</files>
  <action>
Install table-related Shadcn components:

```bash
npx shadcn@latest add table badge dropdown-menu popover checkbox scroll-area --yes
```

Also install TanStack Table for data table functionality:
```bash
npm install @tanstack/react-table
```

These components are required for the DataTable implementation.
  </action>
  <verify>All component files exist in src/components/ui/, @tanstack/react-table in package.json</verify>
  <done>Components and TanStack Table installed</done>
</task>

<task type="auto">
  <name>Task 2: Create DataTable component and lead status utilities</name>
  <files>src/components/ui/data-table.tsx, src/lib/lead-status.ts</files>
  <action>
Create two files:

1. `src/components/ui/data-table.tsx` - Generic DataTable component using TanStack Table:
   - Props: columns, data, searchPlaceholder?, onRowClick?
   - Features: Column sorting, global search filter, row click handler
   - Use Shadcn Table primitives
   - Include Input for search
   - Reference v1's data-table.tsx but simplify (no pagination needed for MVP)

2. `src/lib/lead-status.ts` - Lead status configuration:
   ```typescript
   export type LeadStatus = 'new' | 'hot' | 'warm' | 'cold' | 'converted' | 'lost'

   export const LEAD_STATUS_CONFIG: Record<LeadStatus, { label: string; color: string; bgColor: string }> = {
     new: { label: 'New', color: '#6B7280', bgColor: '#F3F4F6' },
     hot: { label: 'Hot', color: '#DC2626', bgColor: '#FEE2E2' },
     warm: { label: 'Warm', color: '#F59E0B', bgColor: '#FEF3C7' },
     cold: { label: 'Cold', color: '#3B82F6', bgColor: '#DBEAFE' },
     converted: { label: 'Converted', color: '#10B981', bgColor: '#D1FAE5' },
     lost: { label: 'Lost', color: '#6B7280', bgColor: '#E5E7EB' },
   }
   ```
  </action>
  <verify>Both files export correctly with TypeScript types</verify>
  <done>DataTable component and lead status config created</done>
</task>

<task type="auto">
  <name>Task 3: Create database page with columns and filters</name>
  <files>src/app/(dashboard)/[workspace]/database/page.tsx, src/app/(dashboard)/[workspace]/database/columns.tsx, src/app/(dashboard)/[workspace]/database/database-client.tsx</files>
  <action>
Create the database view with 3 files:

1. `page.tsx` (Server Component):
   - Fetch workspace by slug
   - Fetch contacts from Supabase ordered by created_at desc
   - Pass to DatabaseClient component

2. `columns.tsx` (Column definitions):
   - Name column (with phone below in muted text)
   - Email column
   - Lead Status column (colored badge)
   - Tags column (show first 2 + "+N more")
   - Lead Score column (progress bar visualization)
   - Created column (relative time using date-fns)
   - Actions column (WhatsApp link, dropdown with Copy phone, Delete)

   Use formatDistanceToNow from date-fns for relative times.
   Install date-fns: `npm install date-fns`

3. `database-client.tsx` (Client Component):
   - Props: workspace, contacts
   - State: statusFilter (LeadStatus[]), selectedContact
   - Render: Header with title + count, filter popover for status, DataTable
   - Filter logic: useMemo to filter contacts by statusFilter
   - Row click: setSelectedContact (detail sheet comes in Plan 03)

Keep it simpler than v1:
- No payment status filter (not in v2 schema)
- No source filter (not in v2 schema)
- No tags filter (keep for later)
- No Add/Import/Export buttons yet
  </action>
  <verify>npm run build passes, /[workspace]/database route renders table</verify>
  <done>Database page shows contacts table with status filter working</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `/[workspace]/database` route renders DataTable
- [ ] Status filter popover shows all 6 statuses
- [ ] Clicking filter checkbox filters the table
- [ ] Lead status badges show correct colors
- [ ] Row click sets selectedContact (console.log to verify)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Database table functional with filtering
</success_criteria>

<output>
After completion, create `.planning/phases/02-database-view/02-02-SUMMARY.md`
</output>
