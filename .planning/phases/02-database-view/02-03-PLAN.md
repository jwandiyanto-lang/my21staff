---
phase: 02-database-view
plan: 03
type: execute
---

<objective>
Create the contact detail sheet that slides out when clicking a row in the database table.

Purpose: Allow users to view full contact details without leaving the database view.
Output: Sheet component showing contact info, form submissions, and message history placeholder.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior summaries:
@.planning/phases/02-database-view/02-01-SUMMARY.md
@.planning/phases/02-database-view/02-02-SUMMARY.md

# Existing files:
@src/types/database.ts
@src/app/(dashboard)/[workspace]/database/database-client.tsx

# v1 Reference:
~/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/database/student-detail-sheet.tsx

**Tech stack available:** Next.js 15, React 19, Shadcn/ui, Tailwind v4, Supabase
**Established patterns:** Client components for interactivity, Sheet for detail views
**Constraining decisions:**
- 01-03: contacts table has metadata JSONB for form responses
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Sheet and Tabs components</name>
  <files>src/components/ui/sheet.tsx, src/components/ui/tabs.tsx, src/components/ui/textarea.tsx</files>
  <action>
Install required Shadcn components:

```bash
npx shadcn@latest add sheet tabs textarea --yes
```

Sheet is for the sliding panel, Tabs for organizing contact info, Textarea for future notes feature.
  </action>
  <verify>All 3 component files exist in src/components/ui/</verify>
  <done>Components installed without errors</done>
</task>

<task type="auto">
  <name>Task 2: Create ContactDetailSheet component</name>
  <files>src/app/(dashboard)/[workspace]/database/contact-detail-sheet.tsx</files>
  <action>
Create ContactDetailSheet component with:

Props:
```typescript
interface ContactDetailSheetProps {
  contact: Contact | null
  workspace: { slug: string }
  open: boolean
  onOpenChange: (open: boolean) => void
}
```

Structure:
1. Sheet from right side, width ~400px
2. SheetHeader with contact name (or phone if no name), avatar with initials
3. Tabs with 3 tabs: "Details", "Messages", "Activity"

Details tab content:
- Contact info section: phone, email, lead status badge, tags
- Lead score with progress bar visualization
- Created date
- Metadata display (if contact.metadata has form responses, show them as key-value pairs)

Messages tab content:
- Placeholder text: "Message history will appear here after Inbox is connected (Phase 3)"
- This is intentional - messages come from Kapso integration

Activity tab content:
- Placeholder text: "Activity timeline coming soon"

Footer: "Open in Inbox" button (links to /[workspace]/inbox?contact=[id])

Keep simpler than v1:
- No notes feature (not in v2 schema)
- No inline status editor (just display)
- No form submission cards (just show metadata)

Use lucide-react icons: Phone, Mail, Calendar, Tag, MessageCircle, ArrowRight
  </action>
  <verify>File exports ContactDetailSheet component with proper types</verify>
  <done>ContactDetailSheet renders contact details in a slide-out sheet</done>
</task>

<task type="auto">
  <name>Task 3: Wire ContactDetailSheet into DatabaseClient</name>
  <files>src/app/(dashboard)/[workspace]/database/database-client.tsx</files>
  <action>
Update DatabaseClient to:
1. Import ContactDetailSheet
2. Add state: isDetailOpen (boolean)
3. Update onRowClick to: setSelectedContact(contact), setIsDetailOpen(true)
4. Render ContactDetailSheet at bottom of component with props:
   - contact={selectedContact}
   - workspace={{ slug: workspace.slug }}
   - open={isDetailOpen}
   - onOpenChange={setIsDetailOpen}
  </action>
  <verify>npm run build passes</verify>
  <done>Clicking a table row opens the detail sheet</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Database View with sidebar, table, filters, and contact detail sheet</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/[your-workspace]/database (replace with actual workspace slug)
    3. Verify: Sidebar shows Database, Inbox, Settings navigation
    4. Verify: Database table loads (may be empty if no contacts in DB)
    5. Test: Click Status filter, select a status, confirm table filters
    6. Test: Click a table row, confirm detail sheet slides in from right
    7. Test: Detail sheet shows contact info with tabs
    8. Test: Mobile view - sidebar collapses, trigger button works
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Sidebar navigation functional
- [ ] DataTable renders with columns
- [ ] Status filter works
- [ ] Contact detail sheet opens on row click
- [ ] Sheet tabs switch correctly
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Phase 2 complete: Database View functional
</success_criteria>

<output>
After completion, create `.planning/phases/02-database-view/02-03-SUMMARY.md` with:
- Summary of entire Phase 2 accomplishments
- All files created/modified across all 3 plans
- Phase 2 complete, ready for Phase 3 (Inbox Core)
</output>
