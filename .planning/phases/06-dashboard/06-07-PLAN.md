---
phase: 06-dashboard
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/leads/lead-columns.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Business Type column header is clickable and toggles sort"
    - "Arrow indicator shows on Business Type column"
    - "Table reorders by Business Type when header clicked"
  artifacts:
    - path: "src/components/leads/lead-columns.tsx"
      provides: "Sortable Business Type column"
      contains: "toggleSorting"
  key_links:
    - from: "Business Type header Button"
      to: "column.toggleSorting"
      via: "onClick handler"
      pattern: "column\\.toggleSorting.*'asc'"
---

<objective>
Fix Business Type column sorting in lead table

Purpose: UAT Test #2 failed because Business Type column uses plain string header instead of sortable Button component. All other columns (Name, Stage, Score, Last Active) are sortable, but Business Type was missed.

Output: Business Type column will sort correctly when header is clicked, matching the pattern of other sortable columns.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-dashboard/06-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make Business Type column sortable</name>
  <files>src/components/leads/lead-columns.tsx</files>
  <action>
    Replace the plain string header on line 96 with the sortable Button pattern.

    Current code (line 94-105):
    ```typescript
    {
      accessorKey: 'businessType',
      header: 'Business Type',  // <-- This is the problem
      cell: ...
    }
    ```

    Replace with:
    ```typescript
    {
      accessorKey: 'businessType',
      header: ({ column }) => {
        return (
          <Button
            variant="ghost"
            onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
            className="hover:bg-transparent p-0 font-bold"
          >
            Business Type
            <ArrowUpDown className="ml-2 h-4 w-4" />
          </Button>
        )
      },
      cell: ({ row }) => {
        const businessType = row.getValue('businessType') as string | undefined
        return (
          <span className="text-sm">
            {businessType || <span className="text-muted-foreground">-</span>}
          </span>
        )
      },
    }
    ```

    Note: Button and ArrowUpDown are already imported at the top of the file.
  </action>
  <verify>
    1. Run `npm run lint` - no errors
    2. Run `npm run dev` and visit http://localhost:3000/demo/leads
    3. Click Business Type column header - table should sort
    4. Click again - sort direction should reverse
    5. Arrow icon should appear on Business Type header
  </verify>
  <done>
    Business Type column is sortable with arrow indicator, matching Name/Stage/Score/Last Active columns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify TanStack Table sorting behavior</name>
  <files>src/components/leads/lead-columns.tsx</files>
  <action>
    Verify the sorting implementation works correctly with TanStack Table:

    1. Inspect the table state after clicking Business Type header:
       - Open browser DevTools, go to React DevTools (Components tab)
       - Find the LeadTable component and check its state
       - Confirm `sorting` state array includes `{ id: 'businessType', desc: true/false }`

    2. Verify visual row reordering:
       - Note the first 3 rows' Business Type values before sorting
       - Click Business Type header (ascending sort)
       - Confirm rows are now ordered alphabetically by businessType (A-Z)
       - Click again (descending sort)
       - Confirm rows are now reverse alphabetical (Z-A)
       - Leads without businessType should sort to bottom in ascending, top in descending

    3. Test sort indicator toggle:
       - Observe ArrowUpDown icon changes to indicate current sort direction
       - First click: ascending (initial click)
       - Second click: descending
       - Third click: no sort (removes sorting)

    This verification ensures column.toggleSorting() actually triggers TanStack Table's reordering mechanism, not just showing a visual indicator.
  </action>
  <verify>
    Verification checklist (all must pass):
    - [ ] React DevTools shows sorting state changes when Business Type header clicked
    - [ ] Table rows physically reorder after clicking header (not just visual indicator)
    - [ ] Mock data with different businessType values (e.g., "Cafe", "Restaurant", "Retail") appear in correct sorted order
    - [ ] Undefined/null businessType values sort consistently (to end in ascending, start in descending)
    - [ ] Sort toggle cycle works: unsorted -> asc -> desc -> unsorted
  </verify>
  <done>
    TanStack Table sorting confirmed working end-to-end: header click triggers state update, state update triggers row reorder, visual indicator reflects current sort state.
  </done>
</task>

</tasks>

<verification>
- [ ] `npm run lint` passes
- [ ] Business Type header shows ArrowUpDown icon
- [ ] Clicking Business Type header sorts table rows (verified via row reordering, not just icon)
- [ ] Sort direction toggles on subsequent clicks (asc -> desc -> unsorted)
- [ ] React DevTools confirms sorting state includes businessType column
- [ ] UAT Test #2 would pass: "Click Name, Stage, Score, Business Type, or Last Active column headers and see table resort accordingly"
</verification>

<success_criteria>
All 5 sortable columns (Name, Stage, Score, Business Type, Last Active) can be sorted by clicking their headers. Arrow indicators show on all sortable headers. Table rows physically reorder when sorted (not just visual feedback).
</success_criteria>

<output>
After completion, create `.planning/phases/06-dashboard/06-07-SUMMARY.md`
</output>
