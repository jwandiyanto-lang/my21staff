---
phase: 06-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/[workspace]/leads/page.tsx
  - src/app/(dashboard)/[workspace]/leads/leads-client.tsx
  - src/components/leads/lead-table.tsx
  - src/components/leads/lead-columns.tsx
  - src/components/leads/stage-badge.tsx
autonomous: true

must_haves:
  truths:
    - "User can see all leads from Convex instantly"
    - "Lead cards show name, phone, stage badge, and last activity"
    - "Leads are sorted by most recent activity first"
  artifacts:
    - path: "src/app/(dashboard)/[workspace]/leads/page.tsx"
      provides: "Server component wrapper for leads page"
      min_lines: 15
    - path: "src/app/(dashboard)/[workspace]/leads/leads-client.tsx"
      provides: "Client component with Convex query and table"
      min_lines: 80
    - path: "src/components/leads/lead-table.tsx"
      provides: "TanStack Table rendering component"
      exports: ["LeadTable"]
      min_lines: 60
    - path: "src/components/leads/lead-columns.tsx"
      provides: "Column definitions for TanStack Table"
      exports: ["columns"]
      min_lines: 50
    - path: "src/components/leads/stage-badge.tsx"
      provides: "Temperature-based stage badge component"
      exports: ["StageBadge"]
      min_lines: 30
  key_links:
    - from: "src/app/(dashboard)/[workspace]/leads/leads-client.tsx"
      to: "api.leads.getLeadsByStatus"
      via: "useQuery hook"
      pattern: "useQuery.*api\\.leads"
    - from: "src/components/leads/lead-table.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable"
      pattern: "useReactTable"
---

<objective>
Build the core Lead List UI with TanStack Table displaying all leads from Convex with real-time updates.

Purpose: Foundation for all lead management UI - enables viewing, sorting, and basic interaction with leads.
Output: Functional /[workspace]/leads page rendering leads from Convex with temperature-based stage badges.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-dashboard/06-CONTEXT.md
@.planning/phases/06-dashboard/06-RESEARCH.md

# Existing Convex queries to use
@convex/leads.ts

# Existing dashboard patterns
@src/components/dashboard/stats-cards.tsx

# Mock data structure (for dev mode reference)
@src/lib/mock-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Lead Page Route and Client Component</name>
  <files>
    src/app/(dashboard)/[workspace]/leads/page.tsx
    src/app/(dashboard)/[workspace]/leads/leads-client.tsx
  </files>
  <action>
    Create the leads page route structure following existing dashboard patterns:

    1. **page.tsx** (server component):
       - Import workspace from params
       - Render LeadsContent client component
       - Follow pattern from inbox/page.tsx

    2. **leads-client.tsx** (client component):
       - Add 'use client' directive
       - Import useQuery from 'convex/react' and api from 'convex/_generated/api'
       - Query leads using api.leads.getLeadsByStatus with workspace_id
       - Handle dev mode check: `const isDevMode = process.env.NEXT_PUBLIC_DEV_MODE === 'true'`
       - In dev mode, return MOCK_LEADS (add to mock-data.ts in Task 3)
       - Handle loading state with skeleton
       - Render LeadTable component with data

    **Dev mode pattern** (from existing components):
    ```tsx
    const isDevMode = process.env.NEXT_PUBLIC_DEV_MODE === 'true'
    const leads = useQuery(
      api.leads.getLeadsByStatus,
      isDevMode ? 'skip' : { workspaceId, limit: 100 }
    )
    const data = isDevMode ? MOCK_LEADS : (leads ?? [])
    ```

    **Layout structure**:
    - Page title "Leads" with count badge
    - Filter bar placeholder (Plan 02)
    - LeadTable component
  </action>
  <verify>
    File exists at src/app/(dashboard)/[workspace]/leads/page.tsx
    File exists at src/app/(dashboard)/[workspace]/leads/leads-client.tsx
    No TypeScript errors: npm run type-check
  </verify>
  <done>
    Leads page route exists and renders client component with Convex query structure
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TanStack Table Components</name>
  <files>
    src/components/leads/lead-table.tsx
    src/components/leads/lead-columns.tsx
    src/components/leads/stage-badge.tsx
  </files>
  <action>
    Create the TanStack Table infrastructure:

    1. **stage-badge.tsx**:
       - Temperature-based badges matching 06-CONTEXT.md decisions:
         - New (blue) - default for new leads
         - Warm (orange) - qualified leads with engagement
         - Hot (red) - high-score leads ready for conversion
         - Converted (green) - completed conversions
       - Use shadcn/ui Badge component with custom variants
       - Include text label AND icon for accessibility (per 06-RESEARCH.md)
       - Colors: hot=red-600, warm=orange-500, new=blue-500, converted=green-600

    2. **lead-columns.tsx**:
       - Define ColumnDef array for TanStack Table
       - Columns:
         - **Name**: accessor 'name', render with phone number below in muted text
         - **Stage**: accessor 'leadTemperature', render StageBadge
         - **Score**: accessor 'leadScore', show as number with /100
         - **Last Active**: accessor 'lastActivityAt', use formatDistanceToNow from date-fns
         - **Actions**: accessor for row actions (view details button, placeholder for now)
       - Export columns array with proper typing

    3. **lead-table.tsx**:
       - Accept data and columns as props
       - Use useReactTable from @tanstack/react-table
       - Enable getCoreRowModel, getSortedRowModel
       - Render using shadcn/ui Table components (Table, TableHeader, TableBody, TableRow, TableCell)
       - Add sorting indicators to headers
       - Handle empty state with "No leads found" message

    **Type definitions** (add to component or types file):
    ```tsx
    type Lead = {
      _id: string
      phone: string
      name: string
      leadStatus: string
      leadScore: number
      leadTemperature: 'hot' | 'warm' | 'lukewarm' | 'cold'
      businessType?: string
      lastActivityAt?: number
      created_at: number
    }
    ```

    **Styling requirements**:
    - Geist Mono for phone numbers (font-mono class)
    - Black/white minimalist per CLAUDE.md
  </action>
  <verify>
    npm run type-check passes
    Components export correctly: LeadTable, columns, StageBadge
  </verify>
  <done>
    TanStack Table renders leads with columns, stage badges, and relative time display
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Mock Lead Data and Wire Up Page</name>
  <files>
    src/lib/mock-data.ts
    src/app/(dashboard)/[workspace]/leads/leads-client.tsx
  </files>
  <action>
    Complete the integration:

    1. **Add MOCK_LEADS to mock-data.ts**:
       - Add 10-15 sample leads matching the Lead type
       - Include variety of stages (new, warm, hot, converted)
       - Include realistic Indonesian names and phone numbers
       - Mix of leadScores (0-100) and temperatures
       - Different lastActivityAt timestamps (some today, some days ago)

       Example:
       ```tsx
       export const MOCK_LEADS = [
         {
           _id: 'lead-001',
           phone: '+62 812-3456-7890',
           name: 'Budi Santoso',
           leadStatus: 'qualified',
           leadScore: 75,
           leadTemperature: 'hot' as const,
           businessType: 'Restaurant',
           lastActivityAt: Date.now() - 2 * 60 * 60 * 1000, // 2 hours ago
           created_at: Date.now() - 7 * 24 * 60 * 60 * 1000, // 7 days ago
         },
         // ... more leads
       ]
       ```

    2. **Update leads-client.tsx**:
       - Import MOCK_LEADS from mock-data.ts
       - Import LeadTable and columns
       - Wire up the table rendering with proper data flow
       - Add loading skeleton using existing DashboardSkeleton pattern or create LeadsSkeleton

    3. **Add leads route to sidebar navigation** (if not already present):
       - Check src/components/sidebar.tsx or similar
       - Add "Leads" link pointing to /[workspace]/leads
       - Use Users or similar icon from lucide-react

    **Testing**:
    - Navigate to http://localhost:3000/demo/leads
    - Verify table renders with mock data
    - Verify stage badges display correctly
    - Verify relative time displays (e.g., "2 hours ago")
  </action>
  <verify>
    Navigate to http://localhost:3000/demo/leads - page loads without errors
    Table displays mock leads with correct formatting
    Stage badges show appropriate colors and labels
    npm run lint passes
  </verify>
  <done>
    Leads page fully functional in dev mode with mock data, ready for production Convex data
  </done>
</task>

</tasks>

<verification>
- Page loads at /[workspace]/leads route
- Table renders with columns: Name, Stage, Score, Last Active, Actions
- Stage badges display with correct colors (hot=red, warm=orange, new=blue, converted=green)
- Relative time displays correctly (e.g., "3 hours ago")
- Dev mode works offline with MOCK_LEADS
- No TypeScript or ESLint errors
</verification>

<success_criteria>
1. /[workspace]/leads page exists and loads
2. Table displays leads from Convex (or mock data in dev mode)
3. Stage badges are accessible (text + color)
4. Sorting works on all columns
5. Empty state handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/06-dashboard/06-01-SUMMARY.md`
</output>
