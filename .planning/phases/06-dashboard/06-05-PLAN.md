---
phase: 06-dashboard
plan: 05
type: execute
wave: 3
depends_on: ["06-01"]
files_modified:
  - src/components/dashboard/stats-cards.tsx
  - src/components/dashboard/lead-stats.tsx
  - src/components/dashboard/trend-indicator.tsx
  - src/app/(dashboard)/[workspace]/dashboard/page.tsx
  - src/app/(dashboard)/[workspace]/dashboard/dashboard-client.tsx
autonomous: true

must_haves:
  truths:
    - "User can see total leads counter on dashboard"
    - "User can see new leads today/week/month with trend indicators"
    - "Dashboard shows conversational stat highlights"
    - "Stats update in real-time from Convex"
  artifacts:
    - path: "src/components/dashboard/lead-stats.tsx"
      provides: "Lead statistics display with trends"
      exports: ["LeadStats"]
      min_lines: 80
    - path: "src/components/dashboard/trend-indicator.tsx"
      provides: "Reusable trend arrow indicator"
      exports: ["TrendIndicator"]
      min_lines: 25
  key_links:
    - from: "src/components/dashboard/lead-stats.tsx"
      to: "api.leads.getLeadStats"
      via: "useQuery hook"
      pattern: "useQuery.*leads\\.getLeadStats"
---

<objective>
Enhance dashboard with lead statistics, trend indicators, and conversational stat highlights.

Purpose: Provide at-a-glance business intelligence on the main dashboard with clear trend visualization.
Output: Dashboard overview showing lead counts, trends, and conversational summaries.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-dashboard/06-CONTEXT.md
@.planning/phases/06-dashboard/06-RESEARCH.md

# Existing dashboard components
@src/components/dashboard/stats-cards.tsx

# Lead stats query
@convex/leads.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Trend Indicator and Lead Stats Components</name>
  <files>
    src/components/dashboard/trend-indicator.tsx
    src/components/dashboard/lead-stats.tsx
  </files>
  <action>
    Create reusable trend indicator and new lead stats component:

    1. **trend-indicator.tsx**:
       - Reusable component for showing up/down trends
       - Accept value (percentage change) and period label
       - Green arrow up for positive, red arrow down for negative
       - Include percentage value and period text

       ```tsx
       import { ArrowUp, ArrowDown, Minus } from 'lucide-react'

       interface TrendIndicatorProps {
         value: number // Percentage change (can be negative)
         period?: string // e.g., "vs last week"
         showValue?: boolean
       }

       export function TrendIndicator({ value, period, showValue = true }: TrendIndicatorProps) {
         const isPositive = value > 0
         const isNeutral = value === 0

         if (isNeutral) {
           return (
             <div className="flex items-center gap-1 text-sm text-muted-foreground">
               <Minus className="h-4 w-4" />
               {showValue && <span>0%</span>}
               {period && <span className="text-muted-foreground">{period}</span>}
             </div>
           )
         }

         return (
           <div className={`flex items-center gap-1 text-sm ${isPositive ? 'text-green-600' : 'text-red-600'}`}>
             {isPositive ? <ArrowUp className="h-4 w-4" /> : <ArrowDown className="h-4 w-4" />}
             {showValue && <span>{Math.abs(value)}%</span>}
             {period && <span className="text-muted-foreground">{period}</span>}
           </div>
         )
       }
       ```

    2. **lead-stats.tsx**:
       - Query lead stats from Convex (or use mock in dev mode)
       - Display 4 stat cards in a grid:
         - Total Leads (all-time)
         - New Today (with trend vs yesterday)
         - New This Week (with trend vs last week)
         - Hot Leads (count of temperature=hot)
       - Include conversational highlight below grid
       - Use existing Card components from shadcn/ui

       ```tsx
       'use client'

       import { useQuery } from 'convex/react'
       import { api } from 'convex/_generated/api'
       import type { Id } from 'convex/_generated/dataModel'
       import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
       import { TrendIndicator } from './trend-indicator'
       import { Users, UserPlus, CalendarDays, Flame } from 'lucide-react'

       const isDevMode = process.env.NEXT_PUBLIC_DEV_MODE === 'true'

       // Mock stats for dev mode
       const MOCK_STATS = {
         total: 127,
         byStatus: { new: 45, qualified: 32, contacted: 28, converted: 15, archived: 7 },
         byTemperature: { hot: 8, warm: 24, lukewarm: 35, cold: 60 },
         newToday: 5,
         newThisWeek: 23,
         newThisMonth: 78,
         avgScore: 42,
       }

       // Mock previous period for trend calculation (would be separate query in production)
       const MOCK_PREVIOUS = {
         newYesterday: 3,
         newLastWeek: 18,
       }

       interface LeadStatsProps {
         workspaceId: Id<'workspaces'>
       }

       export function LeadStats({ workspaceId }: LeadStatsProps) {
         const stats = useQuery(
           api.leads.getLeadStats,
           isDevMode ? 'skip' : { workspaceId }
         )

         const data = isDevMode ? MOCK_STATS : stats
         const previous = MOCK_PREVIOUS // In production, this would be a separate query

         if (!data) {
           return <LeadStatsSkeleton />
         }

         // Calculate trends (simplified - in production, compare to previous period data)
         const todayTrend = previous.newYesterday > 0
           ? Math.round(((data.newToday - previous.newYesterday) / previous.newYesterday) * 100)
           : 0
         const weekTrend = previous.newLastWeek > 0
           ? Math.round(((data.newThisWeek - previous.newLastWeek) / previous.newLastWeek) * 100)
           : 0

         // Generate conversational highlight
         const highlight = generateHighlight(data, todayTrend, weekTrend)

         return (
           <div className="space-y-4">
             {/* Stats grid */}
             <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
               <StatCard
                 title="Total Leads"
                 value={data.total}
                 icon={<Users className="h-4 w-4 text-muted-foreground" />}
               />
               <StatCard
                 title="New Today"
                 value={data.newToday}
                 icon={<UserPlus className="h-4 w-4 text-blue-500" />}
                 trend={todayTrend}
                 trendPeriod="vs yesterday"
               />
               <StatCard
                 title="New This Week"
                 value={data.newThisWeek}
                 icon={<CalendarDays className="h-4 w-4 text-green-500" />}
                 trend={weekTrend}
                 trendPeriod="vs last week"
               />
               <StatCard
                 title="Hot Leads"
                 value={data.byTemperature?.hot || 0}
                 icon={<Flame className="h-4 w-4 text-red-500" />}
                 valueClassName="text-red-600"
               />
             </div>

             {/* Conversational highlight */}
             <Card className="bg-muted/50">
               <CardContent className="py-3">
                 <p className="text-sm text-muted-foreground">{highlight}</p>
               </CardContent>
             </Card>
           </div>
         )
       }

       interface StatCardProps {
         title: string
         value: number
         icon: React.ReactNode
         trend?: number
         trendPeriod?: string
         valueClassName?: string
       }

       function StatCard({ title, value, icon, trend, trendPeriod, valueClassName }: StatCardProps) {
         return (
           <Card>
             <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
               <CardTitle className="text-sm font-medium">{title}</CardTitle>
               {icon}
             </CardHeader>
             <CardContent>
               <div className={`text-2xl font-bold ${valueClassName || ''}`}>
                 {value.toLocaleString('id-ID')}
               </div>
               {trend !== undefined && (
                 <TrendIndicator value={trend} period={trendPeriod} />
               )}
             </CardContent>
           </Card>
         )
       }

       function generateHighlight(data: typeof MOCK_STATS, todayTrend: number, weekTrend: number): string {
         const parts: string[] = []

         if (data.newToday > 0) {
           parts.push(`${data.newToday} new lead${data.newToday > 1 ? 's' : ''} today`)
         }

         if (weekTrend > 0) {
           parts.push(`up ${weekTrend}% from last week`)
         } else if (weekTrend < 0) {
           parts.push(`down ${Math.abs(weekTrend)}% from last week`)
         }

         if (data.byTemperature?.hot > 0) {
           parts.push(`${data.byTemperature.hot} hot lead${data.byTemperature.hot > 1 ? 's' : ''} ready for follow-up`)
         }

         if (parts.length === 0) {
           return "No new activity today. Check back later!"
         }

         return parts.join(' - ') + '.'
       }

       function LeadStatsSkeleton() {
         return (
           <div className="space-y-4">
             <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
               {[1, 2, 3, 4].map((i) => (
                 <Card key={i}>
                   <CardHeader className="pb-2">
                     <div className="h-4 w-20 bg-muted animate-pulse rounded" />
                   </CardHeader>
                   <CardContent>
                     <div className="h-8 w-16 bg-muted animate-pulse rounded" />
                   </CardContent>
                 </Card>
               ))}
             </div>
             <Card className="bg-muted/50">
               <CardContent className="py-3">
                 <div className="h-4 w-64 bg-muted animate-pulse rounded" />
               </CardContent>
             </Card>
           </div>
         )
       }
       ```
  </action>
  <verify>
    npm run type-check passes
    TrendIndicator and LeadStats export correctly
  </verify>
  <done>
    Trend indicator and lead stats components created with conversational highlights
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate Lead Stats into Dashboard Page</name>
  <files>
    src/app/(dashboard)/[workspace]/dashboard/page.tsx
    src/app/(dashboard)/[workspace]/dashboard/dashboard-client.tsx
  </files>
  <action>
    Create or update the dashboard page to include lead stats:

    1. **Check existing dashboard structure**:
       - Look for existing dashboard route
       - If exists, update to include LeadStats
       - If not, create new dashboard page

    2. **page.tsx** (if creating new):
       ```tsx
       import { DashboardContent } from './dashboard-client'

       interface Props {
         params: Promise<{ workspace: string }>
       }

       export default async function DashboardPage({ params }: Props) {
         const { workspace } = await params
         return <DashboardContent workspaceSlug={workspace} />
       }
       ```

    3. **dashboard-client.tsx** (if creating new or updating):
       - Import LeadStats component
       - Place at top of dashboard (hero position)
       - Include existing components below (activity feed, quick actions, etc.)

       ```tsx
       'use client'

       import { LeadStats } from '@/components/dashboard/lead-stats'
       import { ActivityFeed } from '@/components/dashboard/activity-feed'
       import { QuickActions } from '@/components/dashboard/quick-actions'
       import type { Id } from 'convex/_generated/dataModel'

       interface DashboardContentProps {
         workspaceSlug: string
       }

       export function DashboardContent({ workspaceSlug }: DashboardContentProps) {
         // In production, resolve workspace ID from slug
         const workspaceId = 'demo' as Id<'workspaces'>

         return (
           <div className="p-6 space-y-6">
             <div className="flex items-center justify-between">
               <h1 className="text-2xl font-bold">Dashboard</h1>
             </div>

             {/* Lead Stats - Hero position */}
             <LeadStats workspaceId={workspaceId} />

             {/* Two column layout for secondary content */}
             <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
               <ActivityFeed workspaceId={workspaceId} />
               <QuickActions />
             </div>
           </div>
         )
       }
       ```

    4. **Update existing stats-cards.tsx if needed**:
       - Check if current StatsCards conflicts with new LeadStats
       - If so, either deprecate or integrate patterns from LeadStats
       - Prefer keeping LeadStats as the primary lead-focused stats component

    **Note**: If dashboard route already exists with different structure, integrate LeadStats at the top of the existing layout rather than replacing everything.
  </action>
  <verify>
    Navigate to http://localhost:3000/demo/dashboard (or /demo if that's the default)
    Lead stats cards display at top of dashboard
    Trend indicators show up/down arrows with percentages
    Conversational highlight displays below stats grid
    Mock data renders correctly in dev mode
    npm run lint passes
  </verify>
  <done>
    Dashboard page displays lead stats with trends and conversational highlights
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Time Period Toggle and Responsiveness</name>
  <files>
    src/components/dashboard/lead-stats.tsx
  </files>
  <action>
    Enhance lead stats with time period selection:

    1. **Add time period toggle**:
       - Tabs or segmented control: Today | This Week | This Month
       - Default to "This Week" for best overview
       - Adjusts which stat cards show trends

       ```tsx
       import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs'

       // In LeadStats component:
       const [period, setPeriod] = useState<'today' | 'week' | 'month'>('week')

       // Header with time toggle
       <div className="flex items-center justify-between mb-4">
         <h2 className="text-lg font-medium">Lead Overview</h2>
         <Tabs value={period} onValueChange={(v) => setPeriod(v as any)}>
           <TabsList>
             <TabsTrigger value="today">Today</TabsTrigger>
             <TabsTrigger value="week">Week</TabsTrigger>
             <TabsTrigger value="month">Month</TabsTrigger>
           </TabsList>
         </Tabs>
       </div>
       ```

    2. **Adjust stats display based on period**:
       - "Today" period: Show newToday prominently, compare to yesterday
       - "Week" period: Show newThisWeek prominently, compare to last week
       - "Month" period: Show newThisMonth prominently, compare to last month

    3. **Update conversational highlight based on period**:
       - Tailor the message to the selected time period
       - E.g., "This week: 23 new leads, up 28% from last week"

    4. **Ensure mobile responsiveness**:
       - Grid collapses to 2 columns on tablet, 1 column on mobile
       - Time toggle stacks below title on mobile
       - Use responsive Tailwind classes (already in place: md:grid-cols-2 lg:grid-cols-4)

    5. **Test breakpoints**:
       - Desktop (1024px+): 4 columns
       - Tablet (768px): 2 columns
       - Mobile (<768px): 1 column with stacked toggle
  </action>
  <verify>
    Time period toggle displays and functions
    Switching periods updates stats and trends
    Conversational highlight updates based on period
    Responsive layout works at all breakpoints
    No layout shifts during loading
    npm run lint passes
  </verify>
  <done>
    Lead stats with time period toggle and responsive design complete
  </done>
</task>

</tasks>

<verification>
- Dashboard displays lead stats in hero position
- Four stat cards: Total Leads, New Today/Week/Month, Hot Leads
- Trend indicators show percentage change with colored arrows
- Conversational highlight provides context below stats
- Time period toggle switches between Today/Week/Month views
- Responsive grid works on all screen sizes
- Dev mode renders mock data correctly
</verification>

<success_criteria>
1. Lead stats display prominently on dashboard
2. Trend indicators show up/down arrows with percentages
3. Conversational highlight is contextual and readable
4. Time period toggle functions correctly
5. Responsive design works on mobile/tablet/desktop
</success_criteria>

<output>
After completion, create `.planning/phases/06-dashboard/06-05-SUMMARY.md`
</output>
