---
phase: 05-website-manager
plan: 03
type: execute
---

<objective>
Implement article CRUD and public article pages.

Purpose: Allow admins to create/edit articles, and make published articles publicly viewable.
Output: Article create/edit form, public article page at /articles/{workspace}/{slug}.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-website-manager/05-02-SUMMARY.md
@src/app/(dashboard)/[workspace]/website/website-client.tsx
@src/lib/mock-data.ts
@src/types/database.ts
@src/middleware.ts

**Public routes pattern:** Middleware allows /forms. Add /articles for public article pages.
**Form pattern:** Use Sheet component for create/edit forms (like contact detail sheet).
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add article create/edit sheet</name>
  <files>
    src/app/(dashboard)/[workspace]/website/article-form-sheet.tsx,
    src/app/(dashboard)/[workspace]/website/website-client.tsx
  </files>
  <action>
Create ArticleFormSheet component for creating and editing articles:

**article-form-sheet.tsx:**
- Sheet that opens from right side (like contact detail sheet)
- Form fields:
  - Title (Input, required)
  - Slug (Input, auto-generated from title but editable)
  - Excerpt (Textarea, optional)
  - Content (Textarea, markdown, optional for now - rich editor is future)
  - Cover Image URL (Input, optional)
  - Status (Select: draft/published)
- Save button calls API route
- If editing existing article, pre-populate fields
- Toast notification on save success/error

**Update website-client.tsx:**
- Add state for selectedArticle and isArticleSheetOpen
- "Create Article" button opens sheet with null article
- Card click opens sheet with existing article
- Refresh article list after save

Dev mode: In dev mode, just update local state (no API call). Show toast "Saved (dev mode)".
  </action>
  <verify>Click Create Article, fill form, submit shows toast; click existing article opens with data</verify>
  <done>Article form sheet opens, saves (or simulates in dev mode), list updates</done>
</task>

<task type="auto">
  <name>Task 2: Create article API routes</name>
  <files>
    src/app/api/articles/route.ts,
    src/app/api/articles/[id]/route.ts
  </files>
  <action>
Create API routes for article CRUD:

**/api/articles (route.ts):**
- GET: List articles for workspace (requires workspace_id query param)
- POST: Create new article
  - Validate required fields (title, slug, workspace_id)
  - Generate slug from title if not provided (slugify: lowercase, replace spaces with hyphens, remove special chars)
  - Set published_at to now if status is 'published'
  - Return created article

**/api/articles/[id] (route.ts):**
- GET: Get single article by ID
- PUT: Update article
  - If status changing to 'published' and published_at is null, set to now
- DELETE: Delete article

All routes require authentication (check session).
Return proper error responses (401, 404, 400).

Dev mode bypass: If SUPABASE_ENV=dev, return mock success response.
  </action>
  <verify>Test API routes with curl or in article form sheet</verify>
  <done>API routes handle GET/POST/PUT/DELETE, auth checked, errors handled</done>
</task>

<task type="auto">
  <name>Task 3: Create public article page</name>
  <files>
    src/app/articles/[workspace]/[slug]/page.tsx,
    src/middleware.ts
  </files>
  <action>
Create public article page accessible without authentication:

**Update middleware.ts:**
Add '/articles' to publicRoutes array so article pages don't require auth.

**page.tsx (server component):**
- Fetch article by workspace slug and article slug
- Only show if status === 'published'
- If not found or not published, return 404 (notFound())
- Render:
  - Cover image (if exists)
  - Title (h1)
  - Published date
  - Excerpt (if exists)
  - Content (render markdown as HTML - use simple replacement for now: # → h1, ## → h2, \n\n → <p>)
- Simple, clean layout with max-w-2xl centered

Dev mode: In dev mode, lookup from mockArticles.
  </action>
  <verify>Navigate to /articles/{workspace}/{slug}, published article displays, draft shows 404</verify>
  <done>Public article page renders published articles, 404 for drafts/missing</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Article CRUD and public page</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Navigate to /{workspace}/website
    3. Click "Create Article" - form sheet opens
    4. Fill in title "Test Article", leave slug auto-generated, add some content
    5. Save - toast shows success
    6. Article appears in list with Draft status
    7. Edit article, change status to Published
    8. Open new tab: /articles/{workspace}/test-article
    9. Article displays with title and content
    10. Try accessing draft article slug - should 404
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Article form sheet opens and saves
- [ ] API routes work (or dev mode bypassed)
- [ ] Public article page renders published content
- [ ] Drafts return 404 on public page
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>

- Articles can be created and edited via form sheet
- API routes handle CRUD operations
- Public articles accessible at /articles/{workspace}/{slug}
- Draft articles not publicly visible
- All new code compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-website-manager/05-03-SUMMARY.md`
</output>
