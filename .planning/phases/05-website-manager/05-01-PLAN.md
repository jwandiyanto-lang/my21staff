---
phase: 05-website-manager
plan: 01
type: execute
---

<objective>
Add database schema for articles, webinars, and webinar registrations.

Purpose: Establish data model for content management and lead generation via webinar registrations.
Output: SQL schema file with tables + RLS policies, updated TypeScript types.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@supabase/schema.sql
@src/types/database.ts

**From Phase 1:** Supabase patterns (RLS, workspace-scoped queries) established.
**Relevant prior summary:** 01-03-SUMMARY.md (database schema patterns).
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create content schema SQL file</name>
  <files>supabase/migrations/05_website_content.sql</files>
  <action>
Create SQL migration for Website Manager content:

**articles table:**
- id UUID PRIMARY KEY
- workspace_id UUID NOT NULL REFERENCES workspaces(id)
- title VARCHAR(255) NOT NULL
- slug VARCHAR(100) NOT NULL (UNIQUE per workspace)
- excerpt TEXT (short summary)
- content TEXT (markdown body)
- cover_image_url TEXT
- status VARCHAR(20) DEFAULT 'draft' ('draft', 'published')
- published_at TIMESTAMPTZ
- created_at, updated_at TIMESTAMPTZ

**webinars table:**
- id UUID PRIMARY KEY
- workspace_id UUID NOT NULL REFERENCES workspaces(id)
- title VARCHAR(255) NOT NULL
- slug VARCHAR(100) NOT NULL (UNIQUE per workspace)
- description TEXT
- cover_image_url TEXT
- scheduled_at TIMESTAMPTZ NOT NULL (when webinar happens)
- duration_minutes INTEGER DEFAULT 60
- meeting_url TEXT (Zoom/Google Meet link)
- max_registrations INTEGER (NULL = unlimited)
- status VARCHAR(20) DEFAULT 'draft' ('draft', 'published', 'completed', 'cancelled')
- published_at TIMESTAMPTZ
- created_at, updated_at TIMESTAMPTZ

**webinar_registrations table:**
- id UUID PRIMARY KEY
- webinar_id UUID NOT NULL REFERENCES webinars(id)
- contact_id UUID NOT NULL REFERENCES contacts(id)
- workspace_id UUID NOT NULL REFERENCES workspaces(id)
- registered_at TIMESTAMPTZ DEFAULT NOW()
- attended BOOLEAN DEFAULT false
- UNIQUE(webinar_id, contact_id)

Add indexes: workspace_id, slug, status, scheduled_at for webinars.

Enable RLS on all tables. Create policies:
- SELECT: workspace members can view
- INSERT/UPDATE/DELETE: workspace admins/owners can modify
- PUBLIC SELECT for published articles/webinars (using is_published check, no auth required)

Add updated_at triggers for articles and webinars.
  </action>
  <verify>SQL file exists with all tables, indexes, RLS policies, triggers</verify>
  <done>Schema file ready for manual Supabase execution, no syntax errors</done>
</task>

<task type="auto">
  <name>Task 2: Update TypeScript database types</name>
  <files>src/types/database.ts</files>
  <action>
Add TypeScript interfaces matching the new tables:

```typescript
export interface Article {
  id: string
  workspace_id: string
  title: string
  slug: string
  excerpt: string | null
  content: string | null
  cover_image_url: string | null
  status: 'draft' | 'published'
  published_at: string | null
  created_at: string
  updated_at: string
}

export interface Webinar {
  id: string
  workspace_id: string
  title: string
  slug: string
  description: string | null
  cover_image_url: string | null
  scheduled_at: string
  duration_minutes: number
  meeting_url: string | null
  max_registrations: number | null
  status: 'draft' | 'published' | 'completed' | 'cancelled'
  published_at: string | null
  created_at: string
  updated_at: string
}

export interface WebinarRegistration {
  id: string
  webinar_id: string
  contact_id: string
  workspace_id: string
  registered_at: string
  attended: boolean
}

// Joined type for displaying registrations with contact info
export interface WebinarRegistrationWithContact extends WebinarRegistration {
  contact: Contact
}
```

Keep existing types intact. Add new types at the end of file.
  </action>
  <verify>TypeScript compiles without errors: npx tsc --noEmit</verify>
  <done>All new types added, existing types unchanged, no TS errors</done>
</task>

<task type="auto">
  <name>Task 3: Add mock data for dev mode</name>
  <files>src/lib/mock-data.ts</files>
  <action>
Add mock articles and webinars for dev mode testing:

```typescript
export const mockArticles: Article[] = [
  {
    id: 'article-1',
    workspace_id: 'demo-workspace',
    title: 'How to Choose the Right University',
    slug: 'how-to-choose-university',
    excerpt: 'A comprehensive guide to selecting the perfect university for your education abroad journey.',
    content: '# How to Choose the Right University\n\nChoosing where to study is one of the most important decisions...',
    cover_image_url: null,
    status: 'published',
    published_at: '2026-01-10T10:00:00Z',
    created_at: '2026-01-08T10:00:00Z',
    updated_at: '2026-01-10T10:00:00Z',
  },
  {
    id: 'article-2',
    workspace_id: 'demo-workspace',
    title: 'Visa Application Tips for Indonesian Students',
    slug: 'visa-tips-indonesian',
    excerpt: 'Essential tips to make your student visa application process smooth and successful.',
    content: null,
    cover_image_url: null,
    status: 'draft',
    published_at: null,
    created_at: '2026-01-12T10:00:00Z',
    updated_at: '2026-01-12T10:00:00Z',
  },
]

export const mockWebinars: Webinar[] = [
  {
    id: 'webinar-1',
    workspace_id: 'demo-workspace',
    title: 'Study in Australia Info Session',
    slug: 'study-australia-info',
    description: 'Learn about studying in Australia, visa requirements, and scholarship opportunities.',
    cover_image_url: null,
    scheduled_at: '2026-01-25T14:00:00Z',
    duration_minutes: 60,
    meeting_url: 'https://zoom.us/j/example',
    max_registrations: 100,
    status: 'published',
    published_at: '2026-01-14T10:00:00Z',
    created_at: '2026-01-13T10:00:00Z',
    updated_at: '2026-01-14T10:00:00Z',
  },
  {
    id: 'webinar-2',
    workspace_id: 'demo-workspace',
    title: 'UK University Application Workshop',
    slug: 'uk-application-workshop',
    description: 'Hands-on workshop for applying to UK universities through UCAS.',
    cover_image_url: null,
    scheduled_at: '2026-02-01T15:00:00Z',
    duration_minutes: 90,
    meeting_url: null,
    max_registrations: 50,
    status: 'draft',
    published_at: null,
    created_at: '2026-01-14T10:00:00Z',
    updated_at: '2026-01-14T10:00:00Z',
  },
]
```

Import Article and Webinar types at top of file.
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>Mock articles and webinars added matching type definitions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] SQL migration file exists with valid syntax
- [ ] TypeScript types compile without errors
- [ ] Mock data matches type definitions
- [ ] No changes to existing functionality
</verification>

<success_criteria>

- Schema SQL ready for Supabase execution
- TypeScript types defined for articles, webinars, registrations
- Mock data available for dev mode testing
- All new code compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-website-manager/05-01-SUMMARY.md`
</output>
