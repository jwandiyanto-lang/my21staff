---
phase: 07-cleanup-verification
plan: 07
type: execute
wave: 3
depends_on: ["07-06"]
files_modified:
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - src/lib/supabase/config.ts
  - src/types/database.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Supabase lib files deleted"
    - "Supabase types file deleted or repurposed"
    - "@supabase packages removed from package.json"
    - "No code imports from @/lib/supabase"
    - "Build passes with Supabase fully removed"
  artifacts:
    - path: "package.json"
      provides: "Clean dependencies without @supabase"
      not_contains: "@supabase"
  key_links:
    - from: "None"
      to: "None"
      via: "Supabase completely removed"
      pattern: "no supabase imports in codebase"

user_setup:
  - service: vercel
    why: "Remove Supabase environment variables"
    dashboard_config:
      - task: "Remove or comment out Supabase env vars"
        location: "Vercel Dashboard -> Project -> Settings -> Environment Variables"
        env_vars_to_remove:
          - NEXT_PUBLIC_SUPABASE_URL
          - NEXT_PUBLIC_SUPABASE_ANON_KEY
          - SUPABASE_SERVICE_ROLE_KEY
          - SUPABASE_ENV
          - NEXT_PUBLIC_LOCAL_SUPABASE_URL
          - NEXT_PUBLIC_LOCAL_SUPABASE_ANON_KEY
          - LOCAL_SUPABASE_SERVICE_ROLE_KEY
          - NEXT_PUBLIC_TEST_SUPABASE_URL
          - NEXT_PUBLIC_TEST_SUPABASE_ANON_KEY
          - TEST_SUPABASE_SERVICE_ROLE_KEY
---

<objective>
Remove all Supabase code, packages, and configuration from the codebase.

Purpose: Final cleanup - delete Supabase library files, remove packages, clean up types.
Output: Codebase has zero Supabase dependencies
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-cleanup-verification/07-01a-SUMMARY.md
@.planning/phases/07-cleanup-verification/07-01b-SUMMARY.md
@.planning/phases/07-cleanup-verification/07-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete Supabase library files and clean up types</name>
  <files>
    src/lib/supabase/client.ts
    src/lib/supabase/server.ts
    src/lib/supabase/config.ts
    src/types/database.ts
  </files>
  <action>
1. Delete the entire Supabase lib directory:
```bash
rm -rf src/lib/supabase/
```

2. Handle src/types/database.ts:
   - If this file ONLY contains Supabase types (Database, Tables, etc.), delete it
   - If it contains types used elsewhere, keep only the non-Supabase types

Check what's in database.ts first:
```bash
cat src/types/database.ts | head -50
```

If it's just Supabase generated types (export type Database = {...}), delete it:
```bash
rm src/types/database.ts
```

3. Search for any remaining imports and fix them:
```bash
grep -r "from '@/lib/supabase" src/ --include="*.ts" --include="*.tsx"
grep -r "from '@/types/database" src/ --include="*.ts" --include="*.tsx"
```

Any remaining imports should have been migrated in plans 01-06. If any exist, they indicate incomplete migration - fix them.
  </action>
  <verify>
- `ls src/lib/supabase/` returns "No such file or directory"
- `grep "@/lib/supabase" src/ -r` returns nothing
  </verify>
  <done>
Supabase lib files deleted, no imports remain
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove Supabase packages from package.json</name>
  <files>package.json</files>
  <action>
1. Remove Supabase packages from package.json:
```bash
npm uninstall @supabase/ssr @supabase/supabase-js
```

2. Verify package.json no longer contains Supabase:
```bash
grep -i supabase package.json
```

Should return nothing.

3. Clean up node_modules and reinstall:
```bash
npm install
```

4. Run build to verify nothing is broken:
```bash
npm run build
```

If build fails, it indicates incomplete migration somewhere. Fix those files.
  </action>
  <verify>
- `grep "supabase" package.json` returns nothing
- `npm run build` passes
- `npm run dev` starts without errors
  </verify>
  <done>
@supabase packages removed, build passes
  </done>
</task>

<task type="checkpoint:human-action" gate="optional">
  <action>Remove Supabase environment variables from Vercel (optional - can defer)</action>
  <instructions>
Go to Vercel Dashboard -> my21staff -> Settings -> Environment Variables

Remove or comment out (prefix with OLD_) these variables:
- NEXT_PUBLIC_SUPABASE_URL
- NEXT_PUBLIC_SUPABASE_ANON_KEY
- SUPABASE_SERVICE_ROLE_KEY
- SUPABASE_ENV
- NEXT_PUBLIC_LOCAL_SUPABASE_URL (if exists)
- NEXT_PUBLIC_LOCAL_SUPABASE_ANON_KEY (if exists)
- LOCAL_SUPABASE_SERVICE_ROLE_KEY (if exists)
- NEXT_PUBLIC_TEST_SUPABASE_URL (if exists)
- NEXT_PUBLIC_TEST_SUPABASE_ANON_KEY (if exists)
- TEST_SUPABASE_SERVICE_ROLE_KEY (if exists)

**Recommendation:** Prefix with OLD_ instead of deleting, in case rollback needed:
- OLD_NEXT_PUBLIC_SUPABASE_URL
- etc.

This is optional and can be done after merge - the app will work fine with unused env vars present.
  </instructions>
  <resume-signal>Type "done" when env vars handled, or "later" to defer to post-merge</resume-signal>
</task>

</tasks>

<verification>
Final verification:
```bash
# No Supabase in package.json
grep -i supabase package.json && echo "FAIL: Supabase in package.json" || echo "PASS"

# No Supabase imports in source
grep -r "supabase" src/ --include="*.ts" --include="*.tsx" 2>/dev/null && echo "FAIL: Supabase in source" || echo "PASS"

# No Supabase lib directory
ls src/lib/supabase/ 2>/dev/null && echo "FAIL: Supabase dir exists" || echo "PASS"

# Build passes
npm run build && echo "PASS: Build successful" || echo "FAIL: Build broken"
```
</verification>

<success_criteria>
1. src/lib/supabase/ directory deleted
2. src/types/database.ts deleted (if Supabase-only)
3. @supabase packages removed from package.json
4. No imports from @/lib/supabase anywhere
5. `npm run build` passes
6. Vercel env vars handled or deferred (optional)
</success_criteria>

<output>
After completion, create `.planning/phases/07-cleanup-verification/07-07-SUMMARY.md`
</output>
