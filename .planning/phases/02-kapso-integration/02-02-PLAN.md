---
phase: 02-kapso-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/ari.ts
autonomous: true

must_haves:
  truths:
    - "Eagle workspace has ARI configuration record"
    - "ARI bot name is 'Ari' for Eagle Overseas Education"
    - "ARI greeting style and language are configured for Indonesian market"
  artifacts:
    - path: "convex/ari.ts"
      provides: "upsertAriConfig mutation (already exists)"
      exports: ["upsertAriConfig", "getAriConfig"]
  key_links:
    - from: "convex/kapso.ts"
      to: "ariConfig table"
      via: "by_workspace index query"
      pattern: 'query\\("ariConfig"\\)'
---

<objective>
Create ARI configuration for Eagle Overseas Education workspace.

Purpose: Without an ariConfig record, the processARI function skips AI response generation. The bot will receive messages but never reply.

Output: Eagle workspace has ARI configured with appropriate bot personality for education consultancy.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@planning/PROJECT.md
@planning/ROADMAP.md
@planning/phases/02-kapso-integration/02-RESEARCH.md
@convex/schema.ts
@convex/kapso.ts
@convex/ari.ts
@business/bots/ARI.md (if exists)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Check existing ARI config functions in convex/ari.ts</name>
  <files>convex/ari.ts</files>
  <action>
Verify convex/ari.ts already has the necessary functions (it does):

1. `getAriConfig` query (line 21) - Get ariConfig by workspace_id
2. `hasAriConfig` query (line 44) - Check if workspace has ARI enabled
3. `upsertAriConfig` mutation (line 61) - Create or update ariConfig record

These functions already exist and match the schema. No new file creation needed.

Review the upsertAriConfig mutation to confirm it accepts:
- workspace_id (string)
- bot_name (string)
- greeting_style (string)
- language (string)
- tone (optional any)
- community_link (optional string)

If any issues are found with these existing functions, document them.
  </action>
  <verify>
Read convex/ari.ts and confirm upsertAriConfig mutation exists and compiles.
Run: `npx convex dev --once` to verify TypeScript compiles.
  </verify>
  <done>convex/ari.ts has all necessary ARI config functions.</done>
</task>

<task type="auto">
  <name>Task 2: Create Eagle ARI config record</name>
  <files>N/A (data operation)</files>
  <action>
Create ARI config for Eagle workspace using the existing upsertAriConfig mutation:

1. First get Eagle workspace_id:
```bash
npx convex run workspaces:getBySlug '{"slug": "eagle-overseas"}'
```

2. Check if ariConfig already exists:
```bash
npx convex run ari:getAriConfig '{"workspace_id": "WORKSPACE_ID"}'
```

3. If not exists (or needs update), create using upsertAriConfig:
```bash
npx convex run ari:upsertAriConfig '{
  "workspace_id": "WORKSPACE_ID",
  "bot_name": "Ari",
  "greeting_style": "friendly",
  "language": "id",
  "tone": {"supportive": true, "clear": true, "encouraging": true}
}'
```

Eagle Overseas Education config values:
- bot_name: "Ari" (their AI assistant for education consultancy)
- greeting_style: "friendly" (education consultancy = approachable, not corporate)
- language: "id" (Indonesian primary, English secondary)
- tone: { supportive, clear, encouraging } - helpful for students exploring options
- community_link: null (to be set later if needed)
  </action>
  <verify>
Run: `npx convex run ari:getAriConfig '{"workspace_id": "WORKSPACE_ID"}'`
Confirm ariConfig record exists with bot_name "Ari".
  </verify>
  <done>Eagle workspace has ARI configuration with bot_name "Ari", greeting_style "friendly", language "id".</done>
</task>

</tasks>

<verification>
1. convex/ari.ts has getAriConfig and upsertAriConfig functions (confirmed)
2. Eagle workspace has ariConfig record with bot_name "Ari"
3. No TypeScript errors
</verification>

<success_criteria>
- ARI config functions available in convex/ari.ts (existing)
- Eagle workspace has ARI configuration record created
- Bot personality configured for Indonesian education consultancy market
</success_criteria>

<output>
After completion, create `planning/phases/02-kapso-integration/02-02-SUMMARY.md`
</output>
