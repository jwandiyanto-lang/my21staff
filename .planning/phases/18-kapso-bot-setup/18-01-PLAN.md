---
phase: 18-kapso-bot-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/18-kapso-bot-setup/18-VERIFICATION-CHECKLIST.md
autonomous: false

must_haves:
  truths:
    - "Inbound WhatsApp messages appear in CRM inbox within 30 seconds"
    - "AI responds to inbound messages in Bahasa Indonesia within 10 seconds"
    - "Outbound messages sent from CRM are delivered to WhatsApp"
    - "AI handover toggle stops AI from responding when paused"
    - "AI handover toggle resumes AI responses when re-enabled"
  artifacts:
    - path: ".planning/phases/18-kapso-bot-setup/18-VERIFICATION-CHECKLIST.md"
      provides: "Complete verification results with test evidence"
      contains: "status: verified"
  key_links:
    - from: "WhatsApp (customer)"
      to: "/api/webhook/kapso"
      via: "Kapso webhook"
      pattern: "Vercel logs show POST /api/webhook/kapso"
    - from: "Kapso AI workflow"
      to: "WhatsApp (customer)"
      via: "Sea Lion function"
      pattern: "AI response received on WhatsApp"
    - from: "CRM inbox"
      to: "WhatsApp (customer)"
      via: "/api/messages/send"
      pattern: "Message delivered to WhatsApp"
---

<objective>
Systematically verify Kapso integration is working end-to-end in production.

Purpose: Validate that the WhatsApp CRM infrastructure built in Phases 6, 8, and 13 functions correctly. This is verification, not implementation.

Output: Verification checklist with pass/fail status for each test case, plus any issues documented for future phases.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-kapso-bot-setup/18-RESEARCH.md

Prior implementation:
@.planning/phases/06-kapso-live/06-01-SUMMARY.md
@.planning/phases/08-sealion-kapso/08-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create verification checklist and gather deployment info</name>
  <files>.planning/phases/18-kapso-bot-setup/18-VERIFICATION-CHECKLIST.md</files>
  <action>
Create the verification checklist file with these sections:

1. **Deployment Info** - Gather and record:
   - Production URL (from vercel.json or Vercel dashboard)
   - Kapso project URL: https://app.kapso.ai/projects/2bdca4dd-e230-4a1a-8639-68f8595defa8
   - Test phone numbers (user's personal WhatsApp)

2. **Verification Tests** - Create checklist with status column:

   | # | Test | Steps | Expected | Status |
   |---|------|-------|----------|--------|
   | 1 | Webhook GET verification | curl {url}/api/webhook/kapso?hub.challenge=test123 | Returns "test123" | pending |
   | 2 | Inbound message â†’ CRM | Send WhatsApp message to business number | Message appears in CRM inbox | pending |
   | 3 | AI auto-reply | Send message, wait 10s | AI responds in Bahasa Indonesia | pending |
   | 4 | Outbound from CRM | Send message from inbox | Delivered to WhatsApp | pending |
   | 5 | AI handover - pause | Toggle "AI Nonaktif", send message | NO AI response | pending |
   | 6 | AI handover - resume | Toggle "AI Aktif", send message | AI responds again | pending |
   | 7 | Media message | Send image via WhatsApp | Shows [Image] in CRM | pending |
   | 8 | Duplicate prevention | Webhook retry simulation | No duplicate messages | pending |

3. **Issues Found** - Empty section for documenting any failures

Run the webhook GET verification test:
```bash
curl -s "https://{production-url}/api/webhook/kapso?hub.challenge=test123"
```

Record result in checklist.
  </action>
  <verify>
- 18-VERIFICATION-CHECKLIST.md exists with all sections
- Webhook GET test result recorded
  </verify>
  <done>Verification checklist created with deployment info and webhook GET test completed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: User performs WhatsApp verification tests</name>
  <what-built>
Verification checklist created. Now user needs to perform actual WhatsApp tests that require:
- Access to personal WhatsApp (test sender)
- Access to CRM inbox (to see messages)
- Access to Kapso dashboard (to check logs if issues)
  </what-built>
  <how-to-verify>
**Perform these tests in order, updating the checklist after each:**

1. **Inbound Message Test**
   - Send a test message from your personal WhatsApp to the business number
   - Open CRM inbox at https://{production-url}/{workspace}/inbox
   - Verify: Message appears within 30 seconds
   - Record: PASS or FAIL with timestamp

2. **AI Auto-Reply Test**
   - After sending inbound message, wait 10 seconds
   - Check your WhatsApp for AI response
   - Verify: Response is in Bahasa Indonesia, contextually relevant
   - Record: PASS or FAIL with response content

3. **Outbound Message Test**
   - In CRM inbox, select the conversation
   - Type and send a message from the input field
   - Check your WhatsApp for the message
   - Verify: Message delivered within 10 seconds
   - Record: PASS or FAIL

4. **AI Handover Tests**
   - Click "AI Nonaktif" toggle in conversation header
   - Send another message from WhatsApp
   - Wait 15 seconds - should receive NO AI response
   - Click "AI Aktif" toggle
   - Send another message from WhatsApp
   - Wait 10 seconds - should receive AI response
   - Record: PASS or FAIL for each

5. **Media Message Test**
   - Send an image from WhatsApp
   - Check CRM inbox
   - Verify: Shows "[Image]" or "[Image: caption]"
   - Record: PASS or FAIL

**If any test fails:**
- Check Vercel logs: `vercel logs --follow`
- Check Kapso dashboard for webhook errors
- Document the error in Issues Found section
  </how-to-verify>
  <resume-signal>
After completing all tests, respond with:
- "all pass" - if all tests passed
- "partial" - with details of which tests failed
- "blocked" - if unable to test (e.g., no WhatsApp access)
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Finalize verification checklist with results</name>
  <files>.planning/phases/18-kapso-bot-setup/18-VERIFICATION-CHECKLIST.md</files>
  <action>
Based on user's test results, update the verification checklist:

1. Update all test statuses to PASS or FAIL
2. Add timestamps for completed tests
3. Document any issues found in Issues Found section
4. Add summary section:

```markdown
## Summary

**Overall Status:** [VERIFIED | PARTIAL | FAILED]
**Tests Passed:** X/8
**Tests Failed:** X/8
**Date:** YYYY-MM-DD

### Issues to Address (Future Phase)
- [List any issues that need fixing]

### Recommendations
- [Any configuration changes or improvements suggested]
```

If all tests passed, mark status as "verified".
If some tests failed but core functionality works, mark as "partial" with details.
If critical tests failed (inbound messages not arriving), mark as "failed" with root cause analysis.
  </action>
  <verify>
- Checklist updated with all test results
- Summary section added with overall status
- Any issues documented
  </verify>
  <done>Verification complete with documented results and status</done>
</task>

</tasks>

<verification>
Phase verification complete when:
- All 8 verification tests have been executed
- Results documented in 18-VERIFICATION-CHECKLIST.md
- Overall status determined (verified/partial/failed)
- Any issues documented for future resolution
</verification>

<success_criteria>
- Verification checklist exists with all test results
- At minimum, core tests pass: inbound messages, AI response, outbound messages
- Handover toggle functionality verified
- Any failures are documented with root cause
</success_criteria>

<output>
After completion, create `.planning/phases/18-kapso-bot-setup/18-01-SUMMARY.md`
</output>
