---
phase: 04-lead-database
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/schema.ts
autonomous: true

must_haves:
  truths:
    - "Contacts table includes all Sarah extraction fields"
    - "Lead status enum supports full workflow (new -> qualified -> contacted -> converted -> archived)"
    - "Notes array allows bot and human annotations"
    - "Timestamp fields track all activity types"
  artifacts:
    - path: "convex/schema.ts"
      provides: "Extended contacts schema with Sarah fields, status, notes, timestamps"
      contains: "businessType"
  key_links:
    - from: "convex/schema.ts"
      to: "contacts table"
      via: "schema definition"
      pattern: "leadStatus"
---

<objective>
Extend Convex contacts schema with Sarah extraction fields, lead status workflow, notes timeline, and timestamp tracking.

Purpose: Create the data structure to store all lead information from Sarah conversations, enabling dashboard display and lead management.
Output: Updated schema.ts with extended contacts table fields and indexes.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-lead-database/04-CONTEXT.md
@.planning/phases/04-lead-database/04-RESEARCH.md
@convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend contacts schema with Sarah fields and lead workflow</name>
  <files>convex/schema.ts</files>
  <action>
Add the following fields to the existing `contacts` table definition. All new fields must be `v.optional()` to avoid breaking existing contacts.

**Sarah Phase 1 (Gathering) fields:**
```typescript
businessType: v.optional(v.string()),
domisili: v.optional(v.string()),
businessDuration: v.optional(v.string()),
story: v.optional(v.string()),
sarahLanguage: v.optional(v.string()), // 'id' | 'en' - renamed to avoid conflict
```

**Sarah Phase 2 (Interest) fields:**
```typescript
painPoints: v.optional(v.array(v.string())),
interestMotivation: v.optional(v.string()),
priority: v.optional(v.string()),
urgencyLevel: v.optional(v.string()),
```

**Sarah Phase 3 (Closing) fields:**
```typescript
leadScore: v.optional(v.number()), // 0-100, separate from existing lead_score for Sarah-specific
leadTemperature: v.optional(v.union(
  v.literal("hot"),
  v.literal("warm"),
  v.literal("lukewarm"),
  v.literal("cold")
)),
closingTechnique: v.optional(v.string()),
objectionRaised: v.optional(v.string()),
```

**Status workflow fields:**
```typescript
leadStatus: v.optional(v.union(
  v.literal("new"),
  v.literal("qualified"),
  v.literal("contacted"),
  v.literal("converted"),
  v.literal("archived")
)),
statusChangedAt: v.optional(v.number()),
statusChangedBy: v.optional(v.string()), // "sarah-bot" | "grok-bot" | user email
```

**Notes timeline array:**
```typescript
notes: v.optional(v.array(v.object({
  content: v.string(),
  addedBy: v.string(), // "sarah-bot" | "grok-bot" | user email
  addedAt: v.number(),
}))),
```

**Timestamp fields:**
```typescript
lastContactAt: v.optional(v.number()), // Last human outreach (outbound)
lastActivityAt: v.optional(v.number()), // Any interaction (message, status, note)
```

**Add new indexes for analytics queries:**
```typescript
.index("by_workspace_status", ["workspace_id", "leadStatus"])
.index("by_workspace_temperature", ["workspace_id", "leadTemperature"])
```

Do NOT remove or modify existing fields. Only ADD new fields.
  </action>
  <verify>
1. Run `npx convex dev --once` to validate schema changes - should complete without errors
2. Grep convex/schema.ts for "businessType" - should find 1 match
3. Grep convex/schema.ts for "leadStatus" - should find 1+ matches (field + index)
4. Grep convex/schema.ts for "by_workspace_status" - should find 1 match (index)
  </verify>
  <done>
Contacts table in schema.ts includes all 16 new fields (Sarah extraction, status, notes, timestamps) and 2 new indexes. All fields are optional. No existing fields modified.
  </done>
</task>

</tasks>

<verification>
1. `npx convex dev --once` completes without errors
2. Schema shows 16 new fields on contacts table
3. 2 new indexes added (by_workspace_status, by_workspace_temperature)
4. All new fields are v.optional()
</verification>

<success_criteria>
- Contacts schema extended with all Sarah fields
- Lead status enum with full workflow support
- Notes timeline array defined
- All fields are optional (existing contacts unaffected)
- New indexes created for dashboard queries
</success_criteria>

<output>
After completion, create `.planning/phases/04-lead-database/04-01-SUMMARY.md`
</output>
