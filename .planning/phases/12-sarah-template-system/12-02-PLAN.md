---
phase: 12-sarah-template-system
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/app/(dashboard)/[workspace]/team/page.tsx
  - src/components/team/sarah-config-card.tsx
  - src/lib/mock-data.ts
  - src/components/workspace/sidebar.tsx
  - src/app/(dashboard)/[workspace]/settings/settings-client.tsx
autonomous: true

must_haves:
  truths:
    - "User can see Sarah configuration form on team page"
    - "User can edit and save 4 settings (bot name, language, pronoun, trial link)"
    - "Form shows success toast on save"
    - "Demo mode shows disabled form with mock data"
    - "Insights link hidden from sidebar navigation"
    - "Brain settings hidden from Settings page"
  artifacts:
    - path: "src/components/team/sarah-config-card.tsx"
      provides: "Sarah configuration form UI"
      min_lines: 80
    - path: "src/app/(dashboard)/[workspace]/team/page.tsx"
      provides: "Team page with Sarah config card"
      contains: "SarahConfigCard"
  key_links:
    - from: "src/components/team/sarah-config-card.tsx"
      to: "convex/sarah/config.ts"
      via: "useQuery and useMutation hooks"
      pattern: "useQuery.*sarah.*getConfig|useMutation.*sarah.*updateConfig"
---

<objective>
Create UI for Sarah bot configuration on the team page.

Purpose: Allow workspace owners to customize Sarah's behavior (bot name, language, pronoun, trial link).
Output: SarahConfigCard component integrated into existing /[workspace]/team page.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-sarah-template-system/12-RESEARCH.md
@.planning/phases/12-sarah-template-system/12-01-SUMMARY.md

# Existing patterns
@src/app/(dashboard)/[workspace]/team/page.tsx
@src/components/settings/sync-status-indicator.tsx
@src/lib/mock-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SarahConfigCard component</name>
  <files>src/components/team/sarah-config-card.tsx</files>
  <action>
Create new file `src/components/team/sarah-config-card.tsx` with the Sarah configuration form.

**Component structure:**
```typescript
"use client"

import { useQuery, useMutation } from "convex/react"
import { api } from "convex/_generated/api"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Button } from "@/components/ui/button"
import { Bot, Save } from "lucide-react"
import { useState, useEffect } from "react"
import { toast } from "sonner"
import { Id } from "convex/_generated/dataModel"

interface SarahConfigCardProps {
  workspaceId: Id<"workspaces">
  isDevMode: boolean
}
```

**Dev mode handling:**
If isDevMode is true, render a static form with:
- Bot Name: "Your Intern (Demo)"
- Language: Indonesian
- Pronoun: Kamu
- Trial Link: https://example.com/trial
- All inputs disabled
- Small note: "Offline mode - settings not saved"

**Production mode:**
1. Use useQuery(api.sarah.config.getConfig, { workspace_id: workspaceId })
2. Use useMutation(api.sarah.config.updateConfig) for save
3. Form fields with controlled inputs:
   - Bot Name (Input, text)
   - Language (Select: Indonesian / English)
   - Pronoun (Select: Kamu / Anda) - show only when language is Indonesian
   - Trial Link (Input, url)
4. Save button that calls mutation
5. Show toast on success: "Sarah configuration saved"
6. Show toast on error: error message from mutation

**Styling (follow existing Card patterns):**
- Card with CardHeader and CardContent
- CardTitle with Bot icon and "Your AI Assistant"
- CardDescription: "Customize Sarah's behavior for your customers"
- Form grid: 2 columns on md, 1 column on mobile
- Space-y-4 between form groups
- Label above each input
- Button at bottom right with Save icon

**State management:**
- Local state for form values (useState)
- Initialize from query data with useEffect
- Track isDirty state (has user made changes?)
- Disable save button when not dirty or saving
  </action>
  <verify>
1. Check file exists: `ls src/components/team/sarah-config-card.tsx`
2. Run `npm run lint` - no errors
3. Run `npm run type-check` - no TypeScript errors
  </verify>
  <done>SarahConfigCard component compiles without errors</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SarahConfigCard into team page</name>
  <files>src/app/(dashboard)/[workspace]/team/page.tsx, src/lib/mock-data.ts</files>
  <action>
**Update team page (page.tsx):**

1. Add import at top:
```typescript
import { SarahConfigCard } from "@/components/team/sarah-config-card"
import { useQuery } from "convex/react"
import { api } from "convex/_generated/api"
```

2. Inside component, after useOrganization hook:
```typescript
const isDevMode = process.env.NEXT_PUBLIC_DEV_MODE === 'true'

// Get workspace ID from organization
// In dev mode, use mock workspace ID
const workspaceQuery = useQuery(
  api.workspaces.getByClerkOrgId,
  isDevMode ? "skip" : organization ? { clerk_org_id: organization.id } : "skip"
)

const workspaceId = isDevMode
  ? MOCK_WORKSPACE_ID
  : workspaceQuery?._id
```

3. Add SarahConfigCard before the Team Members Card:
```tsx
{/* Sarah Config Card - above Team Members */}
{workspaceId && (
  <SarahConfigCard
    workspaceId={workspaceId}
    isDevMode={isDevMode}
  />
)}

{/* Existing Team Members Card */}
<Card>
  <CardHeader>...
```

**Update mock-data.ts:**

Add mock workspace ID constant if not already present:
```typescript
export const MOCK_WORKSPACE_ID = "mock_workspace_123" as Id<"workspaces">
```

Note: The SarahConfigCard handles dev mode internally, so passing isDevMode ensures it shows the static demo form.
  </action>
  <verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000/demo/team
3. Verify SarahConfigCard appears above Team Members card
4. Verify form fields are disabled in demo mode
5. Verify no console errors
  </verify>
  <done>
- SarahConfigCard visible on /demo/team page
- Form shows in disabled state with mock values
- No console errors or hydration mismatches
  </done>
</task>

<task type="auto">
  <name>Task 3: Test production mode integration</name>
  <files>None (testing only)</files>
  <action>
Test the production integration by temporarily enabling online mode:

1. In .env.local, temporarily set: NEXT_PUBLIC_DEV_MODE=false
2. Start dev server: `npm run dev`
3. Navigate to a real workspace (e.g., /eagle-overseas/team)
4. Verify:
   - Form loads with default values or existing config
   - Can edit fields
   - Save button enables when dirty
   - Save shows success toast
   - Reload page - values persist
5. Restore .env.local: NEXT_PUBLIC_DEV_MODE=true

If production test fails due to auth, document the issue but don't block - the UI is working.
  </action>
  <verify>
Visually confirm:
1. Form loads data from Convex
2. Save operation completes
3. Data persists after reload
  </verify>
  <done>
- Production mode loads and saves config correctly
- OR documented why production test couldn't complete (auth issues in local dev)
  </done>
</task>

<task type="auto">
  <name>Task 4: Hide Insights from sidebar navigation</name>
  <files>src/components/workspace/sidebar.tsx</files>
  <action>
Remove the Insights navigation item from the sidebar.

**In sidebar.tsx:**

1. Remove Insights from operationsNav array (lines 67-70):
```typescript
// REMOVE THIS:
  {
    title: 'Insights',
    icon: Sparkles,
    href: '/insights',
  },
```

2. Remove unused Sparkles import from lucide-react (line 15)

**Rationale:** Insights feature is not part of v2.0.1 focus (Sarah + Leads only). Simplify UI by hiding this navigation item.
  </action>
  <verify>
1. Run `npm run dev`
2. Navigate to http://localhost:3000/demo
3. Verify sidebar does NOT show "Insights" link
4. Verify no TypeScript errors
  </verify>
  <done>Insights link removed from sidebar, no compilation errors</done>
</task>

<task type="auto">
  <name>Task 5: Hide Brain settings from Settings page</name>
  <files>src/app/(dashboard)/[workspace]/settings/settings-client.tsx</files>
  <action>
Remove Brain configuration from the Settings page, keeping only the Intern (Sarah) settings which will be moved to Team page.

**In settings-client.tsx:**

1. Remove brainName state (line 27):
```typescript
// REMOVE:
const [brainName, setBrainName] = useState('Grok')
```

2. In loadBotNames function, remove Brain-related lines (lines 37, 46):
```typescript
// REMOVE from dev mode:
setBrainName(settings.brain_name || 'Grok')

// REMOVE from production:
setBrainName(data.brain_name || 'Grok')
```

3. In handleSave function, remove Brain from payload

4. Remove the Brain section from JSX (around lines with Brain icon and brainName Input)

5. Update card title from "Your AI Team" to "Your Intern" or similar

6. Remove Brain import from lucide-react if no longer used

**Note:** Keep Intern settings for now as they may still be referenced, but the primary Sarah config UI is moving to Team page in Task 1-2.
  </action>
  <verify>
1. Run `npm run dev`
2. Navigate to http://localhost:3000/demo/settings
3. Verify Settings page does NOT show Brain configuration
4. Verify no TypeScript/compilation errors
  </verify>
  <done>Brain settings removed from Settings page, no errors</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run lint && npm run type-check` passes
2. /demo/team shows SarahConfigCard in disabled state
3. Form has all 4 fields: Bot Name, Language, Pronoun, Trial Link
4. Styling matches existing Card components on team page
5. Sidebar does NOT show "Insights" link
6. Settings page does NOT show Brain configuration
</verification>

<success_criteria>
- SarahConfigCard component exists and compiles
- Team page displays Sarah config above Team Members
- Dev mode shows disabled form with mock data
- Production mode (if testable) allows editing and saving
- Insights hidden from sidebar navigation
- Brain settings hidden from Settings page
- UI simplified to focus on core v2.0.1 features (Sarah + Leads)
</success_criteria>

<output>
After completion, create `.planning/phases/12-sarah-template-system/12-02-SUMMARY.md`
</output>
