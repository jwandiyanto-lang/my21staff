---
phase: 07-production-launch
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - src/app/(auth)/sign-in/[[...sign-in]]/page.tsx
  - src/app/(auth)/sign-up/[[...sign-up]]/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can sign up with email"
    - "User can sign in after sign-up"
    - "After sign-in, user lands on dashboard"
    - "Dashboard shows real data (not mock/demo)"
  artifacts:
    - path: "src/app/(auth)/sign-in/[[...sign-in]]/page.tsx"
      provides: "Sign-in page with Clerk"
    - path: "src/app/(auth)/sign-up/[[...sign-up]]/page.tsx"
      provides: "Sign-up page with Clerk"
  key_links:
    - from: "Clerk SignIn"
      to: "/[workspace]"
      via: "forceRedirectUrl"
      pattern: "forceRedirectUrl"
    - from: "src/app/(dashboard)/[workspace]/page.tsx"
      to: "Convex queries"
      via: "useQuery"
      pattern: "useQuery.*api\\."
---

<objective>
Verify end-to-end sign-in flow works in production.

Purpose: Confirm users can sign up, sign in, and access the real CRM.
Output: Working authentication flow tested and documented.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-production-launch/07-01-SUMMARY.md
@.planning/phases/07-production-launch/07-02-SUMMARY.md
@src/app/(auth)/sign-in/[[...sign-in]]/page.tsx
@src/app/(auth)/sign-up/[[...sign-up]]/page.tsx
@src/app/providers.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify auth redirect configuration</name>
  <files>src/app/(auth)/sign-in/[[...sign-in]]/page.tsx, src/app/(auth)/sign-up/[[...sign-up]]/page.tsx</files>
  <action>
    1. Read sign-in/page.tsx:
       - Check forceRedirectUrl - should NOT be /demo in production
       - Update if needed to redirect to appropriate workspace
    2. Read sign-up/page.tsx (create if missing):
       - Should match sign-in styling
       - Should redirect to dashboard after sign-up
    3. Check that dev mode redirect is still correct:
       - In dev mode: redirect to /demo (this is correct)
       - In production: show Clerk SignIn/SignUp (no redirect)
    4. The redirect URL should be configurable or go to organization selector
       - Option A: /dashboard (generic)
       - Option B: Keep /demo as temp until multi-tenant routing built
  </action>
  <verify>
    - Sign-in page doesn't hard-code /demo for production
    - Sign-up page exists with proper styling
    - Dev mode check works (isDevMode conditional)
  </verify>
  <done>
    - Auth pages configured for production
    - Redirect logic correct
    - Sign-up page available
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify Clerk-Convex integration</name>
  <files>src/app/providers.tsx</files>
  <action>
    1. Read providers.tsx to understand auth flow:
       - In dev mode: ConvexProvider (no auth)
       - In production: ConvexProviderWithClerk (with auth)
    2. Verify the conditional is correct
    3. Check that Convex queries will work with authenticated user
    4. Document any issues found
  </action>
  <verify>
    - providers.tsx has correct conditional for production mode
    - ConvexProviderWithClerk wraps app in production
  </verify>
  <done>
    - Clerk-Convex integration verified
    - No code changes needed OR changes made
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>End-to-end authentication flow</what-built>
  <how-to-verify>
    **Test in production at www.my21staff.com:**

    1. **Test Sign-Up Flow:**
       - Go to www.my21staff.com/sign-up
       - Create new account with email
       - Complete email verification (if required)
       - Note: Where do you land after sign-up?

    2. **Test Sign-In Flow:**
       - Go to www.my21staff.com/sign-in
       - Sign in with the account you created
       - Note: Where do you land after sign-in?

    3. **Test Dashboard Access:**
       - After sign-in, can you see the dashboard?
       - Does it show real data or mock data?
       - Any errors in browser console?

    4. **Document Results:**
       - Sign-up: working / not working
       - Sign-in: working / not working
       - Dashboard: accessible / error / mock data only
       - Any specific errors or issues?

    **If there are issues:**
    Describe what happened so we can fix it.
  </how-to-verify>
  <resume-signal>
    Type "all working" if sign-up, sign-in, and dashboard work.
    Otherwise, describe what's broken (e.g., "sign-in works but dashboard shows error X")
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Document production state and fix any issues</name>
  <files>none or as needed based on checkpoint feedback</files>
  <action>
    1. Based on checkpoint feedback:
       - If all working: document success
       - If issues found: fix them
    2. Update STATE.md with production status
    3. If fixes made:
       - Commit changes
       - Push to master
       - Wait for deployment
       - Re-verify
  </action>
  <verify>
    - All issues resolved (if any)
    - Production auth flow documented
  </verify>
  <done>
    - Production authentication verified working
    - Any issues fixed and deployed
    - STATE.md updated with production status
  </done>
</task>

</tasks>

<verification>
Production authentication complete:
1. Sign-up flow works
2. Sign-in flow works
3. Dashboard accessible after auth
4. No critical errors
5. User verified the full flow
</verification>

<success_criteria>
- User can sign up at www.my21staff.com/sign-up
- User can sign in at www.my21staff.com/sign-in
- After auth, user sees dashboard (not errors)
- Production environment confirmed working
</success_criteria>

<output>
After completion, create `.planning/phases/07-production-launch/07-03-SUMMARY.md`
</output>
