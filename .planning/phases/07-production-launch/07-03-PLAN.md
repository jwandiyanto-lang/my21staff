---
phase: 07-production-launch
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - src/app/(auth)/sign-in/[[...sign-in]]/page.tsx
  - src/app/(auth)/sign-up/[[...sign-up]]/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can sign up with email"
    - "User can sign in after sign-up"
    - "After sign-in, user lands on dashboard (demo workspace with real auth)"
    - "Auth flow works end-to-end in production"
  artifacts:
    - path: "src/app/(auth)/sign-in/[[...sign-in]]/page.tsx"
      provides: "Sign-in page with Clerk"
    - path: "src/app/(auth)/sign-up/[[...sign-up]]/page.tsx"
      provides: "Sign-up page with Clerk"
  key_links:
    - from: "Clerk SignIn"
      to: "/demo"
      via: "forceRedirectUrl"
      pattern: "forceRedirectUrl"
    - from: "src/app/(dashboard)/[workspace]/page.tsx"
      to: "Convex queries"
      via: "useQuery"
      pattern: "useQuery.*api\\."
---

<objective>
Verify end-to-end sign-in flow works in production.

Purpose: Confirm users can sign up, sign in, and access the CRM dashboard.
Output: Working authentication flow tested and documented.

Note: Post-auth redirect goes to /demo temporarily. Multi-tenant workspace routing
(where users land on their own workspace like /eagle-overseas) is future work.
For Phase 7, we validate the auth flow works and users can access a working dashboard.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-production-launch/07-01-SUMMARY.md
@.planning/phases/07-production-launch/07-02-SUMMARY.md
@src/app/(auth)/sign-in/[[...sign-in]]/page.tsx
@src/app/(auth)/sign-up/[[...sign-up]]/page.tsx
@src/app/providers.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify auth pages configuration</name>
  <files>src/app/(auth)/sign-in/[[...sign-in]]/page.tsx, src/app/(auth)/sign-up/[[...sign-up]]/page.tsx</files>
  <action>
    1. Read sign-in/page.tsx:
       - Verify dev mode redirect works (if isDevMode, redirect to /demo)
       - Note: forceRedirectUrl="/demo" is INTENTIONAL for Phase 7
       - This is temporary until multi-tenant workspace routing is built
       - Do NOT change the redirect URL in this phase
    2. Read sign-up/page.tsx (create if missing):
       - Should match sign-in styling
       - Should have forceRedirectUrl="/demo" (same as sign-in)
       - Should have proper dev mode handling
    3. If sign-up page is missing, create it:
       - Copy sign-in structure
       - Use SignUp component instead of SignIn
       - Match all styling
       - Use signInUrl="/sign-in" instead of signUpUrl
    4. Document current state:
       - Sign-in: exists, redirects to /demo
       - Sign-up: exists/created, redirects to /demo
       - Note: /demo redirect is EXPECTED for Phase 7
  </action>
  <verify>
    - Sign-in page exists with Clerk SignIn component
    - Sign-up page exists with Clerk SignUp component
    - Both have consistent styling
    - forceRedirectUrl="/demo" is present (this is correct for Phase 7)
  </verify>
  <done>
    - Auth pages verified/created
    - Redirect to /demo documented as intentional
    - Sign-up page matches sign-in styling
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify Clerk-Convex integration</name>
  <files>src/app/providers.tsx</files>
  <action>
    1. Read providers.tsx to understand auth flow:
       - In dev mode: ConvexProvider (no auth)
       - In production: ConvexProviderWithClerk (with auth)
    2. Verify the conditional is correct
    3. Check that Convex queries will work with authenticated user
    4. Document any issues found
  </action>
  <verify>
    - providers.tsx has correct conditional for production mode
    - ConvexProviderWithClerk wraps app in production
  </verify>
  <done>
    - Clerk-Convex integration verified
    - No code changes needed OR changes made
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>End-to-end authentication flow</what-built>
  <how-to-verify>
    **Test in production at www.my21staff.com:**

    1. **Test Sign-Up Flow:**
       - Go to www.my21staff.com/sign-up
       - Create new account with email
       - Complete email verification (if required)
       - Note: You should land on /demo after sign-up (this is expected)

    2. **Test Sign-In Flow:**
       - Go to www.my21staff.com/sign-in
       - Sign in with the account you created
       - Note: You should land on /demo after sign-in (this is expected)

    3. **Test Dashboard Access:**
       - After sign-in, you should see the demo dashboard
       - This shows mock data (expected for Phase 7)
       - Check for any errors in browser console
       - Verify basic navigation works

    4. **Document Results:**
       - Sign-up: working / not working
       - Sign-in: working / not working
       - Dashboard: accessible / error
       - Note: Landing on /demo with mock data is EXPECTED for Phase 7

    **What we're validating:**
    - Auth flow works (sign up, sign in, land on dashboard)
    - No crashes or errors
    - Multi-tenant workspace routing is FUTURE work (not Phase 7)
  </how-to-verify>
  <resume-signal>
    Type "all working" if sign-up, sign-in, and dashboard access work.
    Otherwise, describe what's broken (e.g., "sign-in error X", "can't access dashboard")
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Document production state and fix any issues</name>
  <files>none or as needed based on checkpoint feedback</files>
  <action>
    1. Based on checkpoint feedback:
       - If all working: document success
       - If issues found: fix them
    2. Update STATE.md with production status:
       - Production URL: www.my21staff.com
       - Auth: working (sign-up, sign-in)
       - Post-auth redirect: /demo (temporary, multi-tenant routing is future work)
       - Dashboard: accessible via /demo
    3. If fixes made:
       - Commit changes
       - Push to master
       - Wait for deployment
       - Re-verify
  </action>
  <verify>
    - All issues resolved (if any)
    - Production auth flow documented
    - STATE.md updated with production status
  </verify>
  <done>
    - Production authentication verified working
    - Any issues fixed and deployed
    - STATE.md documents:
      - Auth flow works
      - /demo redirect is temporary
      - Multi-tenant workspace routing is future work
  </done>
</task>

</tasks>

<verification>
Production authentication complete:
1. Sign-up flow works
2. Sign-in flow works
3. Dashboard accessible after auth (via /demo)
4. No critical errors
5. User verified the full flow
</verification>

<success_criteria>
- User can sign up at www.my21staff.com/sign-up
- User can sign in at www.my21staff.com/sign-in
- After auth, user lands on /demo dashboard (expected for Phase 7)
- Production environment confirmed working
- Future work documented: multi-tenant workspace routing
</success_criteria>

<output>
After completion, create `.planning/phases/07-production-launch/07-03-SUMMARY.md`
</output>
