---
phase: 07-production-launch
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .env.local
  - src/middleware.ts
autonomous: true
user_setup:
  - service: vercel
    why: "Production deployment"
    dashboard_config:
      - task: "Verify NEXT_PUBLIC_DEV_MODE is set to false in production"
        location: "Vercel Dashboard -> Settings -> Environment Variables"

must_haves:
  truths:
    - "Application deploys to Vercel without build errors"
    - "Production URL is accessible (www.my21staff.com)"
    - "Landing page renders without console errors"
    - "Clerk authentication initializes in production mode"
  artifacts:
    - path: "src/middleware.ts"
      provides: "Route protection for dashboard routes"
      contains: "clerkMiddleware"
  key_links:
    - from: "src/app/providers.tsx"
      to: "Clerk + Convex"
      via: "ClerkProvider + ConvexProviderWithClerk"
      pattern: "ConvexProviderWithClerk"
    - from: "Vercel"
      to: "NEXT_PUBLIC_DEV_MODE"
      via: "Environment variable"
      pattern: "false"
---

<objective>
Deploy application to Vercel production and verify core infrastructure is working.

Purpose: Get the CRM live on production with proper authentication infrastructure ready.
Output: Working deployment at www.my21staff.com with Clerk auth initialized.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/providers.tsx
@src/app/(auth)/sign-in/[[...sign-in]]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify middleware and push to production</name>
  <files>src/middleware.ts</files>
  <action>
    1. Check if middleware.ts exists and has proper Clerk middleware configuration
    2. If missing, create middleware.ts with clerkMiddleware protecting dashboard routes:
       - Public routes: /, /sign-in, /sign-up, /pricing, /security, /keamanan, /api/webhook/(.*)
       - Protected routes: everything under /[workspace]/(.*)
    3. Verify .env.local has DEV_MODE commented explanation
    4. Run `npm run build` to verify no build errors
    5. Push to git (triggers Vercel auto-deploy)
    6. Wait for deployment to complete
  </action>
  <verify>
    - `npm run build` completes without errors
    - `git push origin master` succeeds
    - Vercel deployment completes (check via `vercel ls | head -5`)
  </verify>
  <done>
    - Build passes locally
    - Code pushed to master
    - Vercel deployment triggered
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify production environment</name>
  <files>none (verification only)</files>
  <action>
    1. Check Vercel environment has correct production values:
       - `vercel env ls` shows NEXT_PUBLIC_DEV_MODE for Production
       - Clerk keys present (NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY)
       - Convex URL present (NEXT_PUBLIC_CONVEX_URL)
    2. Verify NEXT_PUBLIC_DEV_MODE is specifically set to "false" (not just exists):
       - `vercel env pull .env.production.local --environment=production`
       - Check contents: `grep DEV_MODE .env.production.local` should show `NEXT_PUBLIC_DEV_MODE=false`
       - If value is not "false", update it: `vercel env rm NEXT_PUBLIC_DEV_MODE production` then `vercel env add NEXT_PUBLIC_DEV_MODE` -> enter "false" -> select Production
    3. Wait for deployment to finish
    4. Verify production URL loads: curl https://www.my21staff.com
  </action>
  <verify>
    - `vercel env ls | grep DEV_MODE` shows Production environment
    - `grep DEV_MODE .env.production.local` shows value is "false" (not empty, not "true")
    - `curl -s -o /dev/null -w "%{http_code}" https://www.my21staff.com` returns 200
  </verify>
  <done>
    - Production environment variables verified
    - NEXT_PUBLIC_DEV_MODE confirmed to be "false"
    - www.my21staff.com returns HTTP 200
    - Landing page content visible
  </done>
</task>

<task type="auto">
  <name>Task 3: Test sign-in page loads in production</name>
  <files>none (verification only)</files>
  <action>
    1. Visit https://www.my21staff.com/sign-in via curl
    2. Verify page returns 200 (not redirect to /demo)
    3. Check that Clerk SignIn component appears (page has clerk-related content)
    4. Document the production state:
       - Landing page: accessible
       - Sign-in page: accessible
       - Clerk initialized: yes/no
  </action>
  <verify>
    - `curl -s -o /dev/null -w "%{http_code}" https://www.my21staff.com/sign-in` returns 200
    - Page content contains Clerk elements (no dev mode redirect)
  </verify>
  <done>
    - Sign-in page accessible in production
    - Clerk auth forms render
    - No unexpected redirects
  </done>
</task>

</tasks>

<verification>
Production infrastructure operational:
1. Landing page loads at www.my21staff.com
2. Sign-in page loads at www.my21staff.com/sign-in
3. No build errors in deployment
4. Environment variables configured for production mode (DEV_MODE=false specifically)
</verification>

<success_criteria>
- www.my21staff.com accessible and showing landing page
- /sign-in shows Clerk authentication form (not dev mode redirect)
- Vercel deployment successful with no build errors
- Production environment has DEV_MODE=false (verified value, not just existence)
</success_criteria>

<output>
After completion, create `.planning/phases/07-production-launch/07-01-SUMMARY.md`
</output>
