---
phase: 04-inbox-ui-filtering
plan: 05
type: execute
wave: 2
depends_on: ["04-04"]
files_modified:
  - src/components/inbox/filter-tabs.tsx
  - src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Filter bar has dedicated section with visual separation"
    - "FilterTabs not cramped with other UI elements"
    - "Filter section follows WhatsApp Web horizontal layout pattern"
  artifacts:
    - path: "src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx"
      provides: "Dedicated filter bar section with border-b separation"
      contains: "border-b.*space-y"
      min_lines: 400
    - path: "src/components/inbox/filter-tabs.tsx"
      provides: "Horizontal scrollable filter tabs"
      contains: "overflow-x-auto"
      min_lines: 50
  key_links:
    - from: "Active/All toggle section"
      to: "FilterTabs section"
      via: "separate divs with vertical spacing"
      pattern: "space-y-3"
    - from: "FilterTabs"
      to: "TagFilterDropdown + Search row"
      via: "vertical stacking"
      pattern: "flex flex-col gap"
---

<objective>
Create dedicated filter bar section in inbox-client with proper visual hierarchy and spacing; ensure FilterTabs scrollable on overflow.

Purpose: Give filter UI breathing room, following WhatsApp Web's clean horizontal layout where filters are primary navigation, not cramped in header.
Output: Filter bar as dedicated section with clear boundaries, FilterTabs with horizontal scroll support, improved visual hierarchy.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/jfransisco/Desktop/21/my21staff/.planning/PROJECT.md
@/home/jfransisco/Desktop/21/my21staff/.planning/ROADMAP.md
@/home/jfransisco/Desktop/21/my21staff/.planning/STATE.md
@/home/jfransisco/Desktop/21/my21staff/.planning/debug/inbox-kapso-design-gap.md

# Updated inbox-client from Plan 04-04
@/home/jfransisco/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx

# FilterTabs to enhance
@/home/jfransisco/Desktop/21/my21staff/src/components/inbox/filter-tabs.tsx
</context>

<tasks>

<task type="auto">
  <name>Add horizontal scroll support to FilterTabs</name>
  <files>src/components/inbox/filter-tabs.tsx</files>
  <action>
Enhance FilterTabs component with horizontal scroll support for many status tabs.

**Current wrapper (line ~20-30):**
```tsx
<div className="flex items-center gap-1.5">
  {LEAD_STATUSES.map(...)}
</div>
```

**Enhanced with scroll:**
```tsx
<div className="overflow-x-auto scrollbar-hide">
  <div className="flex items-center gap-1.5 min-w-max">
    {LEAD_STATUSES.map(...)}
  </div>
</div>
```

**Changes:**
1. Outer div: Add `overflow-x-auto scrollbar-hide` for horizontal scroll with hidden scrollbar
2. Inner div: Add `min-w-max` to prevent wrapping (tabs stay in single row)
3. Keep all existing button styling unchanged
4. Keep all existing logic (onChange, count badges, active state) unchanged

**Why:**
- On narrow viewports or many status tabs, tabs can scroll horizontally
- WhatsApp Web uses this pattern for tab navigation
- Cleaner than wrapping tabs to multiple rows

**DO NOT:**
- Change button styling or badge rendering
- Modify onChange callback or state management
- Touch Convex query or dev mode logic
  </action>
  <verify>
```bash
# Scroll wrapper added
grep -q "overflow-x-auto" src/components/inbox/filter-tabs.tsx

# Inner flex has min-w-max
grep -q "min-w-max" src/components/inbox/filter-tabs.tsx

# Existing flex items-center gap still present
grep -q "flex items-center gap" src/components/inbox/filter-tabs.tsx
```
  </verify>
  <done>FilterTabs component enhanced with overflow-x-auto wrapper and min-w-max inner div for horizontal scrolling when tabs overflow viewport width</done>
</task>

<task type="auto">
  <name>Create dedicated filter bar section in inbox-client</name>
  <files>src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx</files>
  <action>
Restructure filter UI in inbox-client.tsx to use dedicated sections with clear visual hierarchy.

**Current structure (lines ~305-361):**
```tsx
<div className="p-4 border-b space-y-3">
  {/* Active/All toggle */}
  <div className="flex items-center rounded-full bg-muted p-1">...</div>

  {/* FilterTabs */}
  <FilterTabs ... />

  {/* Tag filter + Search */}
  <div className="flex items-center gap-2">
    <TagFilterDropdown ... />
    <Input ... />
  </div>
</div>
```

**Enhanced structure (dedicated sections):**
```tsx
{/* Section 1: View mode toggle */}
<div className="p-4 pb-3 border-b bg-background">
  <div className="flex items-center rounded-full bg-muted p-1">
    {/* Active/All toggle - unchanged */}
  </div>
</div>

{/* Section 2: Status filter (dedicated bar) */}
<div className="px-4 py-2 border-b bg-background">
  <FilterTabs
    value={statusFilter}
    onChange={setStatusFilter}
    workspaceId={workspaceId}
    activeOnly={viewMode === 'active'}
  />
</div>

{/* Section 3: Tag filter + Search */}
<div className="p-4 pt-3 border-b bg-muted/30">
  <div className="flex items-center gap-2">
    <TagFilterDropdown
      value={tagFilter}
      onChange={setTagFilter}
      workspaceId={workspaceId}
    />
    <Input
      placeholder="Search conversations..."
      value={searchQuery}
      onChange={(e) => setSearchQuery(e.target.value)}
      className="flex-1"
    />
  </div>
</div>
```

**Key improvements:**

1. **Visual separation:** Each section gets own border-b for clear boundaries
2. **Dedicated filter bar:** FilterTabs in own section with `px-4 py-2` (horizontal emphasis)
3. **Reduced clutter:** No longer stacking 3 different UI types in single space-y-3 div
4. **Background variation:** Alternate bg-background and bg-muted/30 for subtle hierarchy
5. **Padding optimization:**
   - Section 1: `p-4 pb-3` (normal padding, reduced bottom)
   - Section 2: `px-4 py-2` (horizontal padding, compact vertical)
   - Section 3: `p-4 pt-3` (normal padding, reduced top)

**Why this structure:**
- Follows WhatsApp Web pattern: view toggle at top, status tabs as primary filter, search below
- Each section has visual identity (borders, background)
- FilterTabs no longer cramped (dedicated horizontal bar)
- Still compact overall (total height ~20% less than bloated multi-section designs)

**Reference from debug investigation:**
- Gap: "Dedicated filter bar (separate section below search)" (UAT.md)
- Evidence 7: "Filter Header Layout Is Cramped - All 3 sections stacked vertically in p-4 space" (debug/inbox-kapso-design-gap.md)

**DO NOT:**
- Change component props or state wiring
- Modify ConversationList rendering
- Touch MessageThread or InfoSidebar sections
  </action>
  <verify>
```bash
# Three separate border-b sections
grep -c "border-b.*FilterTabs\|border-b.*Active/All\|border-b.*TagFilterDropdown" src/app/\(dashboard\)/\[workspace\]/inbox/inbox-client.tsx | grep -q "3"

# FilterTabs in dedicated section (not cramped)
grep -A2 -B2 "px-4 py-2.*border-b" src/app/\(dashboard\)/\[workspace\]/inbox/inbox-client.tsx | grep -q "FilterTabs"

# Background variations used
grep -q "bg-muted/30" src/app/\(dashboard\)/\[workspace\]/inbox/inbox-client.tsx
```
  </verify>
  <done>inbox-client.tsx filter sections restructured into three dedicated areas with visual separation (border-b, background variations), FilterTabs in own horizontal bar section, improved spacing and hierarchy</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dedicated filter bar section with horizontal scroll and improved visual hierarchy</what-built>
  <how-to-verify>
1. **Start dev server:**
   ```bash
   npm run dev
   # Visit: http://localhost:3000/demo/inbox
   ```

2. **Verify filter section visual hierarchy:**
   - [ ] Section 1 (top): Active/All toggle in rounded pill, has border-b below
   - [ ] Section 2 (middle): FilterTabs in dedicated horizontal bar, has border-b below
   - [ ] Section 3 (bottom): Tag dropdown + Search in row, has border-b below
   - [ ] Clear visual separation between all three sections
   - [ ] Background colors alternate subtly (background vs muted/30)

3. **Verify FilterTabs dedicated bar:**
   - [ ] FilterTabs has full width horizontal space
   - [ ] Tabs NOT cramped with other UI elements
   - [ ] Padding feels balanced (not too tight, not too loose)
   - [ ] Section looks like primary navigation (not buried in header)

4. **Verify FilterTabs horizontal scroll:**
   - [ ] Resize browser to narrow width (e.g., 800px)
   - [ ] Status tabs overflow viewport width
   - [ ] Can scroll horizontally to see all tabs
   - [ ] Scrollbar hidden (clean appearance)
   - [ ] Tabs stay in single row (no wrapping)

5. **Verify spacing and padding:**
   - [ ] Active/All toggle section: adequate padding (p-4 pb-3)
   - [ ] FilterTabs section: compact vertical, full horizontal (px-4 py-2)
   - [ ] Search section: balanced padding (p-4 pt-3)
   - [ ] Total filter header height feels appropriate (not bloated)

6. **Verify filter functionality still works:**
   - [ ] Click status tab: Conversations filter correctly
   - [ ] Select tag: Tag filter applies
   - [ ] Search input: Filters conversations by name/phone
   - [ ] Active/All toggle: Still works
   - [ ] All filters combine correctly (status + tags + search)

7. **Compare to previous cramped layout:**
   - [ ] Layout now feels spacious (not cramped)
   - [ ] Visual hierarchy clearer (what's primary navigation)
   - [ ] WhatsApp Web aesthetic closer (horizontal emphasis)

8. **Check responsive behavior:**
   - [ ] Mobile width (< 768px): Sections stack properly
   - [ ] FilterTabs scrollable on mobile (many tabs visible with scroll)
   - [ ] Tag dropdown + search row wraps gracefully if needed

9. **Console check:**
   - [ ] No React errors
   - [ ] No style warnings
   - [ ] No Convex query errors

10. **Visual polish check:**
    - [ ] Border-b lines visible between sections
    - [ ] Background color transitions subtle and pleasant
    - [ ] No visual glitches or overlap
  </how-to-verify>
  <resume-signal>Type "approved" if filter bar restructure successful, or describe issues</resume-signal>
</task>

</tasks>

<verification>
After Task 1 and 2 complete:

1. **FilterTabs scroll check:**
```bash
# Verify scroll wrapper
grep -C3 "overflow-x-auto" src/components/inbox/filter-tabs.tsx
```

2. **Section structure check:**
```bash
# Count border-b instances in filter sections
grep -c "border-b" src/app/\(dashboard\)/\[workspace\]/inbox/inbox-client.tsx
```

3. **Visual test (automated):**
```bash
# No TypeScript errors
npx tsc --noEmit --project tsconfig.json 2>&1 | grep -i "filter-tabs\|inbox-client" || echo "No errors"
```

During human verification:
- User confirms filter sections visually separated
- User verifies FilterTabs horizontal scroll works on narrow viewports
- User tests filter functionality (status, tags, search all work)
- User compares to cramped previous layout
- User approves or reports visual/functional issues
</verification>

<success_criteria>
- [ ] FilterTabs component has overflow-x-auto wrapper
- [ ] FilterTabs inner div has min-w-max for single-row layout
- [ ] inbox-client has three dedicated filter sections with border-b
- [ ] Section 1: Active/All toggle (p-4 pb-3, bg-background, border-b)
- [ ] Section 2: FilterTabs dedicated bar (px-4 py-2, bg-background, border-b)
- [ ] Section 3: Tag + Search (p-4 pt-3, bg-muted/30, border-b)
- [ ] Background variations used for subtle hierarchy
- [ ] FilterTabs no longer cramped with other elements
- [ ] Horizontal scroll works when tabs overflow
- [ ] Visual separation clear between sections
- [ ] Filter functionality preserved (status, tags, search all work)
- [ ] Layout feels spacious, follows WhatsApp Web aesthetic
</success_criteria>

<output>
After completion, create `.planning/phases/04-inbox-ui-filtering/04-05-SUMMARY.md`
</output>
