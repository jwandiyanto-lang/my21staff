---
phase: 19-performance-security
plan: 07
type: execute
wave: 3
depends_on: []
files_modified:
  - next.config.ts
autonomous: true

must_haves:
  truths:
    - "Security headers are returned on all responses"
    - "X-Frame-Options prevents clickjacking"
    - "Content-Security-Policy restricts resource loading"
  artifacts:
    - path: "next.config.ts"
      provides: "Security headers configuration"
      contains: "X-Frame-Options"
---

<objective>
Add security headers to all responses

Purpose: Protect against clickjacking, XSS, and other browser-based attacks
Output: All responses include security headers
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Add security headers to Next.js config</name>
  <files>next.config.ts</files>
  <action>
    Add security headers via Next.js config. Read the existing next.config.ts first.

    Add headers configuration:
    ```typescript
    async headers() {
      return [
        {
          source: '/:path*',
          headers: [
            {
              key: 'X-Frame-Options',
              value: 'DENY',
            },
            {
              key: 'X-Content-Type-Options',
              value: 'nosniff',
            },
            {
              key: 'Referrer-Policy',
              value: 'strict-origin-when-cross-origin',
            },
            {
              key: 'X-XSS-Protection',
              value: '1; mode=block',
            },
            {
              key: 'Permissions-Policy',
              value: 'camera=(), microphone=(), geolocation=()',
            },
          ],
        },
      ]
    },
    ```

    Note: Not adding strict CSP yet as it requires auditing all inline scripts/styles.
  </action>
</task>

</tasks>

<verification>
1. grep "X-Frame-Options" next.config.ts
2. npm run build passes
3. npm run dev, then curl -I localhost:3000 to verify headers
</verification>
