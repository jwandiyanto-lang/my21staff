---
phase: 03-inbox-core
plan: 01
type: execute
---

<objective>
Create inbox page shell with conversation list, adapting v1's InboxLayout pattern.

Purpose: Establish the inbox layout structure with working conversation list, selection state, and search - the foundation for message display.
Output: Inbox page at /[workspace]/inbox with conversation list sidebar and placeholder message area.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-inbox-core/03-RESEARCH.md

# Prior phase context (from frontmatter):
@.planning/phases/02-database-view/02-03-SUMMARY.md

# Key files from prior phases:
@src/lib/mock-data.ts
@src/lib/lead-status.ts
@src/types/database.ts
@src/components/workspace/sidebar.tsx
@src/app/(dashboard)/[workspace]/database/page.tsx

# V1 reference (adapt patterns):
@~/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/inbox/inbox-layout.tsx
@~/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/inbox/page.tsx

**Tech stack available:** Shadcn/ui (Avatar, Badge, ScrollArea, Input, Button), date-fns, TanStack Table
**Established patterns:** Dev mode bypass, mock data in src/lib/, Server page â†’ Client component, Sheet for details
**Constraining decisions:**
- 02-03: Dev mode bypass for local testing without Supabase
- 02-02: Status filter only (status-based filtering pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create inbox page with server component data fetching</name>
  <files>src/app/(dashboard)/[workspace]/inbox/page.tsx</files>
  <action>
Create inbox page following the database page pattern. In dev mode, use mock data. Otherwise fetch conversations with contacts from Supabase ordered by last_message_at desc.

Structure:
- Check isDevMode() first
- If dev mode: use MOCK_CONVERSATIONS (to be added in Task 2)
- If production: fetch from Supabase with contact join
- Pass data to InboxClient component

Follow the v1 page.tsx pattern but add dev mode bypass like database/page.tsx.
  </action>
  <verify>File exists, no TypeScript errors: npx tsc --noEmit</verify>
  <done>Inbox page renders with InboxClient component, dev mode returns mock data</done>
</task>

<task type="auto">
  <name>Task 2: Add mock conversations and messages to mock-data.ts</name>
  <files>src/lib/mock-data.ts</files>
  <action>
Add MOCK_CONVERSATIONS and MOCK_MESSAGES arrays to support inbox dev mode testing.

MOCK_CONVERSATIONS:
- 4-5 conversations linked to existing MOCK_CONTACTS by contact_id
- Include unread_count, last_message_preview, last_message_at fields
- Vary the data: some with unread, some without, different timestamps

MOCK_MESSAGES:
- 15-20 messages across conversations
- Include both inbound and outbound directions
- message_type mostly 'text', one or two with 'image' type
- Realistic timestamps within last few days
- Conversations should have 3-5 messages each

Export types: ConversationWithContact (conversation + contact object joined)
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>MOCK_CONVERSATIONS and MOCK_MESSAGES exported, properly typed</done>
</task>

<task type="auto">
  <name>Task 3: Create InboxClient with conversation list sidebar</name>
  <files>
src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx,
src/app/(dashboard)/[workspace]/inbox/conversation-list.tsx
  </files>
  <action>
Adapt v1's inbox-layout.tsx into a cleaner component structure.

InboxClient:
- Accept conversations prop
- useState for selectedConversation (default to first)
- useState for searchQuery
- Two-panel layout: left sidebar (320px), right message area (flex-1)

ConversationList:
- Accept conversations, selectedId, onSelect, searchQuery props
- Filter by searchQuery (name or phone)
- Render each conversation with: Avatar, name/phone, last_message_preview, time ago, unread badge, lead status dot
- Use existing lead-status.ts for colors
- Use ScrollArea for the list
- Highlight selected conversation

Use v1's getInitials function for avatars. Use formatDistanceToNow from date-fns for timestamps.

DO NOT copy v1's full-screen layout - we're inside the workspace sidebar shell already. Just render the two-panel inbox layout.
  </action>
  <verify>npm run dev, navigate to /demo/inbox, conversation list renders with mock data</verify>
  <done>Inbox shows conversation list, clicking selects conversation, search filters list</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] Dev server runs without errors
- [ ] /demo/inbox shows conversation list with mock data
- [ ] Clicking conversation updates selection
- [ ] Search filters conversations
- [ ] Lead status dots show correct colors
</verification>

<success_criteria>

- Inbox page structure complete
- Conversation list with search and selection
- Mock data supports dev mode testing
- Ready for message thread display (03-02)
</success_criteria>

<output>
After completion, create `.planning/phases/03-inbox-core/03-01-SUMMARY.md`
</output>
