---
phase: 03-inbox-core
plan: 02
type: execute
---

<objective>
Display message thread with lazy loading when conversation is selected.

Purpose: Complete the core inbox read functionality - users can view message history for any conversation.
Output: Message thread component showing conversation history with proper bubble styling.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-inbox-core/03-RESEARCH.md
@.planning/phases/03-inbox-core/03-01-SUMMARY.md

# Key files:
@src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
@src/lib/mock-data.ts
@src/types/database.ts

**Tech stack available:** Shadcn/ui (ScrollArea, Avatar, Badge), date-fns
**Established patterns:** Dev mode bypass, lazy loading on selection
**From research - don't hand-roll:**
- Use date-fns format for timestamps
- Use ScrollArea + ref.scrollIntoView for scroll to bottom
- Use lib/lead-status.ts for status colors
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MessageThread component with bubble styling</name>
  <files>src/app/(dashboard)/[workspace]/inbox/message-thread.tsx</files>
  <action>
Create MessageThread component that displays messages for selected conversation.

Props:
- messages: Message[]
- conversationContact: Contact (for header)
- isLoading: boolean

Structure:
- Header: Contact avatar, name/phone, lead status badge, score
- Messages area: ScrollArea with message bubbles
- Scroll to bottom on messages change (useRef + scrollIntoView)

MessageBubble styling (follow research Pattern 3):
- Outbound (direction='outbound'): ml-auto, bg-primary, text-primary-foreground
- Inbound: bg-muted
- Max width 70%, rounded-lg, px-4 py-2
- Show time in small text (format: HH:mm)

Empty state if no messages selected.

NO message input - that's Phase 4 (Inbox Send).
  </action>
  <verify>Component compiles without TypeScript errors</verify>
  <done>MessageThread renders messages with correct bubble styling, scrolls to bottom</done>
</task>

<task type="auto">
  <name>Task 2: Wire message loading into InboxClient</name>
  <files>src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx</files>
  <action>
Add message loading when conversation is selected.

Add state:
- messages: Message[] (initially [])
- isLoadingMessages: boolean

Add loadMessages function:
- In dev mode: filter MOCK_MESSAGES by conversation_id
- In production: query Supabase messages table

useEffect on selectedConversation change:
- If selectedConversation, call loadMessages(conversationId)
- Set messages state with result

Replace the placeholder message area with MessageThread component.
Pass messages, contact, and loading state to MessageThread.

Follow research Pattern 2 for lazy loading structure.
  </action>
  <verify>npm run dev, select conversation, messages appear</verify>
  <done>Selecting conversation loads and displays messages</done>
</task>

<task type="auto">
  <name>Task 3: Add message placeholder input (disabled)</name>
  <files>src/app/(dashboard)/[workspace]/inbox/message-input.tsx</files>
  <action>
Create a placeholder message input component for visual completeness.

Structure:
- Container with border-t, p-4, bg-background
- Input (disabled) with placeholder "Type a message..."
- Button (disabled) labeled "Send"
- Small text below: "Sending messages coming in Phase 4"

This provides visual completeness while clearly indicating send is not yet functional.
Wire it into InboxClient below the MessageThread.
  </action>
  <verify>Input appears below messages, is clearly disabled</verify>
  <done>Disabled message input shown, makes clear sending is not yet available</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] Selecting conversation shows message history
- [ ] Messages styled correctly (inbound left/muted, outbound right/primary)
- [ ] Scrolls to latest message automatically
- [ ] Header shows contact info and lead status
- [ ] Placeholder input visible but disabled
</verification>

<success_criteria>

- Message thread displays with proper styling
- Lazy loading on conversation selection
- Scroll to bottom works
- Ready for status filtering (03-03)
</success_criteria>

<output>
After completion, create `.planning/phases/03-inbox-core/03-02-SUMMARY.md`
</output>
