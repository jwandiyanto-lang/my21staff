# Plan 17-01: Inbox UI/UX Fixes

**Status:** Complete (7/7 fixes)
**Duration:** ~15 min

## Objective

Polish inbox with 7 fixes: WhatsApp background, responsive info panel, header layout, working filters, and cascade delete.

## Tasks

### 1. WhatsApp-style background pattern
**File:** `src/app/(dashboard)/[workspace]/inbox/message-thread.tsx`
- Add subtle gray doodle pattern background to ScrollArea (line ~786)
- Use CSS background-image with SVG pattern or data URI
- Match WhatsApp's light gray chat background feel

### 2. Header layout: `[Notes] [Merge] ──── [AI Aktif]`
**File:** `src/app/(dashboard)/[workspace]/inbox/message-thread.tsx`
- Move Merge button out of dropdown menu (line ~640)
- Put Merge button directly beside Notes (line ~593)
- Move AI Aktif toggle to right side (after flex-1 spacer)
- Keep 3-dot menu for Contact Details only

Current: `[Notes] [AI Aktif] ────────── [⋮]`
Target:  `[Notes] [Merge] ────────── [AI Aktif]`

### 3. Info panel responsive
**File:** `src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx`
- Change InfoSidebar from fixed `w-80` to responsive
- Add `min-w-0 max-w-80 overflow-y-auto` or use `lg:w-80`
- Make it scrollable when content overflows

### 4. Tag filter
**File:** `src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx`
- Add tag filter dropdown similar to status filter
- Collect unique tags from all conversations
- Filter conversations by selected tags

### 5. Verify unread filter works
- Already implemented (lines 71-73)
- Test and confirm functionality

### 6. Assigned to dropdown
**File:** `src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx`
- Add "Assigned to" dropdown in filter area
- Fetch workspace members
- Show member names, default to owner if none
- Note: May need to add `assigned_to` column to conversations table

### 7. Cascade delete - contact deletion removes conversation
**Option A:** Database trigger (preferred)
- Create Supabase trigger: when contact deleted, delete related conversations
**Option B:** API-level
- Update contact delete API to first delete conversations

## Execution Order

1. Header layout (visible, quick win)
2. WhatsApp background (visual improvement)
3. Info panel responsive (layout fix)
4. Tag filter (completes filter set)
5. Verify unread filter
6. Cascade delete (data integrity)
7. Assigned to dropdown (may need schema change - defer if complex)

## Files to Modify

- `src/app/(dashboard)/[workspace]/inbox/message-thread.tsx` - Header layout, background
- `src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx` - Filters, info panel
- `supabase/migrations/` - Cascade delete trigger (if using DB approach)

---

## Completion Notes

### Completed (7/7)

1. **Header layout** ✓ - Moved Merge beside Notes, AI Aktif to right edge
2. **WhatsApp background** ✓ - Added `.whatsapp-bg` CSS class with subtle pattern
3. **Info panel responsive** ✓ - Added `shrink-0 overflow-hidden` to prevent cutoff
4. **Tag filter** ✓ - Added tag filter dropdown similar to status filter
5. **Unread filter** ✓ - Already working, verified
6. **Cascade delete** ✓ - Already in schema with `ON DELETE CASCADE`
7. **Assigned to dropdown** ✓ - Fetches workspace_members, shows team member names, filters by assigned_to
