---
phase: 02-database-view
plan: 01
type: execute
---

<objective>
Add sidebar navigation and workspace layout shell for the CRM dashboard.

Purpose: Establish the navigation structure that all workspace pages will use.
Output: Working sidebar with navigation to Database, Inbox, and Settings pages.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (dependency chain):
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

# Existing files to modify:
@src/app/(dashboard)/[workspace]/layout.tsx
@src/app/(dashboard)/[workspace]/page.tsx

# v1 Reference for sidebar pattern:
~/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/layout.tsx

**Tech stack available:** Next.js 15, React 19, Shadcn/ui (NY style), Tailwind v4, Supabase
**Established patterns:** Multi-env supabase config, workspace routing via [workspace] slug
**Constraining decisions:**
- 01-01: Shadcn/ui New York style with neutral base
- 01-03: Workspace routing via [workspace] slug param
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add required Shadcn UI components</name>
  <files>src/components/ui/sidebar.tsx, src/components/ui/tooltip.tsx, src/components/ui/separator.tsx, src/components/ui/skeleton.tsx, src/components/ui/avatar.tsx</files>
  <action>
Install and add sidebar, tooltip, separator, skeleton, avatar components using npx shadcn@latest add:

```bash
npx shadcn@latest add sidebar tooltip separator skeleton avatar --yes
```

These are required for the workspace sidebar navigation. The sidebar component from Shadcn provides the responsive collapsible sidebar pattern.
  </action>
  <verify>All 5 component files exist in src/components/ui/ and import correctly</verify>
  <done>Components installed without errors</done>
</task>

<task type="auto">
  <name>Task 2: Create workspace sidebar component</name>
  <files>src/components/workspace/sidebar.tsx</files>
  <action>
Create a workspace sidebar component that:
1. Uses Shadcn Sidebar primitives (SidebarProvider, Sidebar, SidebarContent, etc.)
2. Shows workspace name at top
3. Navigation items: Database (Database icon), Inbox (MessageCircle icon), Settings (Settings icon)
4. Uses active link highlighting based on current pathname
5. Collapsible on mobile with SidebarTrigger
6. Keep it simple - no user dropdown, no workspace switcher yet

Props: workspace: { name: string, slug: string }

Reference v1 pattern but simplify - v1 has a complex sidebar we don't need yet. Keep navigation to 3 items only.

Use lucide-react icons: Database, MessageCircle, Settings, ChevronRight
Use next/navigation for usePathname() to detect active route
  </action>
  <verify>File exists with proper TypeScript types and exports</verify>
  <done>WorkspaceSidebar component exports correctly</done>
</task>

<task type="auto">
  <name>Task 3: Update workspace layout to include sidebar</name>
  <files>src/app/(dashboard)/[workspace]/layout.tsx</files>
  <action>
Update the workspace layout to:
1. Wrap children in SidebarProvider
2. Add WorkspaceSidebar component
3. Fetch workspace data from Supabase to pass name and slug to sidebar
4. Use createClient from @/lib/supabase/server
5. Redirect to /login if no user
6. Return notFound() if workspace doesn't exist

The layout should be:
```
SidebarProvider
  WorkspaceSidebar
  SidebarInset (main content area)
    SidebarTrigger (for mobile)
    children
```

Keep the server component pattern - fetch workspace in layout, pass to client components.
  </action>
  <verify>npm run build passes, navigating to /[workspace] shows sidebar</verify>
  <done>Layout renders sidebar with navigation items, main content area shows children</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Sidebar renders with 3 navigation items
- [ ] Navigation links are clickable (routes don't need to exist yet)
- [ ] Mobile: Sidebar collapses, trigger button visible
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Sidebar navigation shell functional
</success_criteria>

<output>
After completion, create `.planning/phases/02-database-view/02-01-SUMMARY.md`
</output>
