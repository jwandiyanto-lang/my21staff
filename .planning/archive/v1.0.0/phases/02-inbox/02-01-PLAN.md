---
phase: 02-inbox
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/[workspace]/inbox/page.tsx
  - src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
  - src/components/inbox/conversation-list.tsx
  - src/components/inbox/conversation-item.tsx
  - src/components/inbox/filter-chips.tsx
autonomous: true

must_haves:
  truths:
    - "User sees list of conversations sorted by recent activity"
    - "User can filter conversations by status chips"
    - "User can filter conversations by tag chips"
    - "Conversations show contact name, last message preview, timestamp, unread badge"
    - "CRM tags visible on conversation items"
  artifacts:
    - path: "src/app/(dashboard)/[workspace]/inbox/page.tsx"
      provides: "Server component with workspace validation"
      min_lines: 15
    - path: "src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx"
      provides: "Client component shell for inbox"
      exports: ["InboxClient"]
    - path: "src/components/inbox/conversation-list.tsx"
      provides: "Conversation list component"
      exports: ["ConversationList"]
    - path: "src/components/inbox/conversation-item.tsx"
      provides: "Single conversation row"
      exports: ["ConversationItem"]
    - path: "src/components/inbox/filter-chips.tsx"
      provides: "Status and tag filter chips"
      exports: ["FilterChips"]
  key_links:
    - from: "src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx"
      to: "convex/conversations.ts"
      via: "useQuery(api.conversations.listWithFilters)"
      pattern: "useQuery.*conversations\\.listWithFilters"
    - from: "src/components/inbox/conversation-list.tsx"
      to: "src/components/inbox/conversation-item.tsx"
      via: "map over conversations"
      pattern: "conversations\\.map.*ConversationItem"
---

<objective>
Build the inbox page structure and conversation list panel with WhatsApp-style layout.

Purpose: Users need to see all their WhatsApp conversations at a glance with CRM context (tags, status). This is the left panel of a two-panel inbox layout.
Output: Working conversation list with filtering, real-time updates via Convex subscriptions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-inbox/02-CONTEXT.md
@.planning/phases/02-inbox/02-RESEARCH.md

# Existing infrastructure
@convex/conversations.ts
@convex/schema.ts
@src/components/skeletons/inbox-skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create inbox page and client shell</name>
  <files>
    src/app/(dashboard)/[workspace]/inbox/page.tsx
    src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
  </files>
  <action>
Create the inbox page structure following existing dashboard page patterns:

1. `page.tsx` - Server component:
   - Get workspace from params
   - Validate workspace exists (redirect to 404 if not)
   - Render InboxClient with workspaceId prop
   - Keep minimal - delegate to client component

2. `inbox-client.tsx` - Client component:
   - Accept workspaceId prop
   - Use `useQuery(api.conversations.listWithFilters)` for real-time data
   - Two-column layout: left panel (conversation list 320px), right panel (message thread - flex-1)
   - Track selectedConversationId state
   - Pass conversations and filters to ConversationList
   - Placeholder for message thread area (will be filled in Plan 02)
   - Show InboxSkeleton while loading

Layout structure:
```
<div className="flex h-[calc(100vh-4rem)]">
  <div className="w-80 border-r flex flex-col">
    {/* Conversation list */}
  </div>
  <div className="flex-1 bg-[#f0f2f5]"> {/* WhatsApp light gray */}
    {/* Message thread or empty state */}
  </div>
</div>
```

Use existing patterns from the codebase for workspace validation and Convex queries.
  </action>
  <verify>
Navigate to /[workspace]/inbox - page loads without errors, shows skeleton then conversations.
  </verify>
  <done>
Inbox page renders with two-panel layout, left panel shows conversations from Convex.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build conversation list and item components</name>
  <files>
    src/components/inbox/conversation-list.tsx
    src/components/inbox/conversation-item.tsx
    src/components/inbox/filter-chips.tsx
  </files>
  <action>
Create the conversation list components with WhatsApp-style aesthetics:

1. `conversation-list.tsx`:
   - Accept props: conversations, selectedId, onSelect, filters, onFiltersChange, tags, members
   - Render FilterChips at top
   - Map over conversations rendering ConversationItem for each
   - Handle empty state when no conversations
   - Scrollable container with overflow-y-auto

2. `conversation-item.tsx`:
   - Accept props: conversation (with nested contact), isSelected, onClick
   - Display: avatar (first letter), contact name (name || kapso_name || phone), last message preview, timestamp
   - Show unread badge when unread_count > 0
   - Show CRM tags (first 2, with +N indicator if more)
   - Highlight selected state with bg-muted
   - Hover state with bg-muted/50
   - Format timestamp relative (using date-fns: formatDistanceToNow or format for older)

3. `filter-chips.tsx`:
   - Accept props: statusFilters, tagFilters, availableTags, onStatusChange, onTagChange
   - Status filter chips: All, New, Hot, Warm, Cold, Converted, Lost
   - Tag filter chips: dynamic from availableTags prop
   - Use Badge components with outline variant for unselected, default for selected
   - Horizontal scroll if too many chips

WhatsApp-style details:
- Light gray background for list area: bg-background (white)
- Conversation items: hover:bg-muted/50, selected: bg-muted
- Avatar: 48px circle with initials
- Truncate long text with text-ellipsis
- Timestamp: text-xs text-muted-foreground

Follow CONTEXT.md: Status filters as quick chips (not dropdown).
  </action>
  <verify>
`npm run build` passes, conversation list renders with items and filter chips.
  </verify>
  <done>
Conversation list displays all conversations with contact info, tags, timestamps, and functional status/tag filters.
  </done>
</task>

</tasks>

<verification>
1. Navigate to /eagle-overseas/inbox
2. Conversation list loads with real data from Convex
3. Filter chips toggle and filter conversations
4. Clicking conversation updates selected state
5. Real-time: open second browser, create new conversation via n8n/webhook, see it appear
</verification>

<success_criteria>
- Inbox page loads without errors
- Conversation list shows conversations sorted by last_message_at desc
- Status filter chips work (New, Hot, Warm, etc.)
- Tag filter chips work (from contact tags)
- Selected conversation highlighted
- Unread badges display correctly
- CRM tags visible on conversation items
</success_criteria>

<output>
After completion, create `.planning/phases/02-inbox/02-01-SUMMARY.md`
</output>
