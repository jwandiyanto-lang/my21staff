---
phase: 03-live-bot-integration
plan: 04
type: execute
wave: 4
depends_on: ["03-03"]
files_modified:
  - .planning/phases/03-live-bot-integration/MONITORING-LOG.md
autonomous: false

must_haves:
  truths:
    - "Bot operates continuously for 24 hours without crashes"
    - "No webhook delivery failures in 24-hour period"
    - "Response time under 10 seconds for all messages"
    - "No signature verification errors"
    - "All AI responses appropriate and on-topic"
  artifacts:
    - path: ".planning/phases/03-live-bot-integration/MONITORING-LOG.md"
      provides: "24-hour stability monitoring log"
      min_lines: 50
  key_links:
    - from: "Production logs"
      to: "Monitoring log"
      via: "Periodic checks every 4 hours"
      pattern: "grep.*webhook.*error"
---

<objective>
Monitor live bot stability for 24 hours to confirm production readiness.

Purpose: Verify the bot can handle real traffic without crashes, errors, or inappropriate responses. This validates production deployment is stable and reliable.

Output: 24-hour monitoring log documenting bot stability, performance, and any issues requiring attention.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-live-bot-integration/03-03-SUMMARY.md

# Monitoring requirements from roadmap
Success Criteria #7: 24-hour monitoring confirms stability (no webhook failures, no integration errors)

# What to monitor
- Webhook delivery rate
- Message processing success rate
- AI response time
- Signature verification success
- Error rates by type
- Bot response quality (manual spot checks)
</context>

<tasks>

<task type="auto">
  <name>Create monitoring log structure</name>
  <files>
    .planning/phases/03-live-bot-integration/MONITORING-LOG.md
  </files>
  <action>
    Create a monitoring log template for tracking 24-hour bot stability:

    ```markdown
    # Phase 3: Live Bot Integration — 24-Hour Monitoring Log

    **Start:** [timestamp]
    **End:** [timestamp]
    **Status:** IN PROGRESS

    ## Monitoring Protocol

    Check production logs every 4 hours for:
    - Webhook delivery (grep "Webhook.*Received")
    - Signature verification (grep "Signature verified")
    - ARI processing (grep "ARI.*Processing")
    - Errors (grep -i "error")
    - Response times (grep "Response sent.*ms")

    ## Checkpoint Log

    ### Hour 0 (Start)
    - **Time:** [timestamp]
    - **Webhook deliveries:** [count]
    - **Messages processed:** [count]
    - **Errors:** [count]
    - **Notes:** Initial baseline established

    ### Hour 4
    - **Time:** [timestamp]
    - **Webhook deliveries:** [count]
    - **Messages processed:** [count]
    - **Signature verifications:** [pass/fail count]
    - **Errors:** [list any errors]
    - **Response time (avg):** [ms]
    - **Notes:** [observations]

    ### Hour 8
    [Same format]

    ### Hour 12
    [Same format]

    ### Hour 16
    [Same format]

    ### Hour 20
    [Same format]

    ### Hour 24 (Final)
    - **Time:** [timestamp]
    - **Total webhook deliveries:** [count]
    - **Total messages processed:** [count]
    - **Success rate:** [%]
    - **Errors:** [list all errors from 24h period]
    - **Response time (avg):** [ms]
    - **Notes:** [final observations]

    ## Metrics Summary

    | Metric | Value | Status |
    |--------|-------|--------|
    | Webhook deliveries | [count] | [✓/✗] |
    | Messages processed | [count] | [✓/✗] |
    | Success rate | [%] | [✓/✗ if >95%] |
    | Signature failures | [count] | [✓/✗ if 0] |
    | Response time (avg) | [ms] | [✓/✗ if <10s] |
    | Error rate | [%] | [✓/✗ if <5%] |

    ## Issues Encountered

    [List any issues, with timestamps and resolution]

    ## Bot Response Quality Checks

    Periodic manual checks of bot responses for appropriateness:

    ### Check 1 (Hour 4)
    - **Conversation:** [contact phone]
    - **User message:** [message]
    - **Bot response:** [response]
    - **Quality:** [appropriate/needs-improvement]
    - **Notes:** [observations]

    ### Check 2 (Hour 12)
    [Same format]

    ### Check 3 (Hour 24)
    [Same format]

    ## Recommendations

    Based on 24-hour monitoring:
    - [Any configuration adjustments needed]
    - [Any performance optimizations needed]
    - [Any error handling improvements needed]

    ## Conclusion

    **Status:** [STABLE / NEEDS ATTENTION]
    **Production Ready:** [YES / NO]
    **Action Items:** [list any follow-ups]
    ```

    Write this template to MONITORING-LOG.md with Hour 0 filled in with current timestamp.
  </action>
  <verify>
    cat .planning/phases/03-live-bot-integration/MONITORING-LOG.md | grep "Hour 0"
  </verify>
  <done>
    MONITORING-LOG.md created with template structure
    Hour 0 baseline timestamp recorded
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <what-to-do>Monitor bot stability for 24 hours with periodic log checks</what-to-do>
  <why>Long-running stability monitoring requires human oversight at intervals - Claude cannot wait 24 hours</why>
  <instructions>
    Follow this monitoring protocol for 24 hours:

    ## Every 4 Hours: Log Check

    1. **Get production logs:**
       ```bash
       vercel logs --production --since 4h > logs-hour-[N].txt
       ```

    2. **Count webhook deliveries:**
       ```bash
       grep -c "Webhook.*Received" logs-hour-[N].txt
       ```

    3. **Count signature verifications:**
       ```bash
       grep -c "Signature verified" logs-hour-[N].txt
       ```

    4. **Count ARI processing:**
       ```bash
       grep -c "ARI.*Processing" logs-hour-[N].txt
       ```

    5. **Check for errors:**
       ```bash
       grep -i "error" logs-hour-[N].txt | head -20
       ```

    6. **Calculate response time:**
       ```bash
       grep "Response sent.*ms" logs-hour-[N].txt | tail -10
       ```

    7. **Update MONITORING-LOG.md:**
       - Fill in checkpoint section for current hour
       - Record all metrics
       - Note any errors or anomalies

    ## Every 8 Hours: Response Quality Check

    1. **Review recent conversations:**
       - Visit https://www.my21staff.com/eagle-overseas/inbox
       - Open 2-3 recent conversations
       - Read bot responses for appropriateness

    2. **Check for issues:**
       - Responses in wrong language
       - Inappropriate or off-topic responses
       - Repetitive responses
       - Failed to answer questions

    3. **Document in MONITORING-LOG.md:**
       - Add conversation sample to "Bot Response Quality Checks"
       - Rate quality (appropriate/needs-improvement)
       - Note any patterns

    ## Red Flags to Watch For

    **CRITICAL (address immediately):**
    - Webhook signature failures (401 errors)
    - Zero webhook deliveries for >1 hour
    - ARI processing errors in logs
    - Bot not responding to messages
    - Inappropriate or harmful responses

    **WARNING (monitor closely):**
    - Response time >10 seconds
    - Error rate >5%
    - Signature verification warnings
    - Off-topic responses
    - Repetitive greeting messages

    ## If Issues Arise

    1. **Document in MONITORING-LOG.md:**
       - Timestamp of issue
       - Full error message or description
       - Impact (messages affected, users affected)

    2. **Check common causes:**
       - GROK_API_KEY expired or rate-limited
       - KAPSO_WEBHOOK_SECRET mismatch
       - Convex deployment issues
       - Network connectivity

    3. **Decide on action:**
       - CRITICAL: Stop monitoring, escalate to debugging
       - WARNING: Continue monitoring, note for follow-up

    4. **Resume monitoring after fix:**
       - Document resolution in log
       - May need to restart 24-hour period if critical issues

    ## After 24 Hours

    1. **Complete MONITORING-LOG.md:**
       - Fill in Hour 24 checkpoint
       - Complete Metrics Summary table
       - Add Recommendations section
       - Write Conclusion

    2. **Analyze results:**
       - Success rate >95%: STABLE
       - Signature failures = 0: SECURE
       - Response time <10s: PERFORMANT
       - No critical errors: PRODUCTION READY

    3. **Signal completion:**
       - Type "monitoring-complete" with summary:
         ```
         DELIVERIES: [count]
         SUCCESS_RATE: [%]
         RESPONSE_TIME: [avg ms]
         ERRORS: [count]
         QUALITY: [stable/issues]
         ```
  </instructions>
  <resume-signal>
    After 24 hours, type "monitoring-complete" with metrics summary, or type "monitoring-stopped" if critical issues require intervention.
  </resume-signal>
</task>

<task type="auto">
  <name>Analyze monitoring results and generate recommendations</name>
  <files>
    .planning/phases/03-live-bot-integration/MONITORING-LOG.md
  </files>
  <action>
    After 24-hour monitoring period, analyze the log and add recommendations:

    1. **Read completed MONITORING-LOG.md:**
       - Review all checkpoint entries
       - Analyze metrics summary
       - Identify patterns in errors or issues

    2. **Calculate final metrics:**
       - Total webhook deliveries (sum all hours)
       - Total messages processed
       - Success rate: (processed / deliveries) * 100
       - Average response time across all checks
       - Error rate: (errors / deliveries) * 100

    3. **Determine production readiness:**
       - STABLE if:
         - Success rate ≥95%
         - Zero signature verification failures
         - Average response time <10s
         - Error rate <5%
         - No critical errors in 24h period
       - NEEDS ATTENTION if any metric fails

    4. **Generate recommendations:**
       - Configuration adjustments (if responses off-topic)
       - Performance optimizations (if response time high)
       - Error handling improvements (if errors recurring)
       - Monitoring enhancements (if blind spots found)

    5. **Update MONITORING-LOG.md Conclusion:**
       - Set Status to STABLE or NEEDS ATTENTION
       - Set Production Ready to YES or NO
       - List action items (if any)

    6. **Document in project state:**
       - If STABLE: Phase 3 complete, ready for Phase 4
       - If NEEDS ATTENTION: List issues blocking completion
  </action>
  <verify>
    grep "Production Ready: YES" .planning/phases/03-live-bot-integration/MONITORING-LOG.md
  </verify>
  <done>
    Monitoring results analyzed
    Recommendations generated based on 24h data
    Production readiness determination documented
  </done>
</task>

</tasks>

<verification>
**Automated checks:**
- MONITORING-LOG.md exists with all checkpoint sections
- Metrics summary table complete
- Conclusion section written

**Manual verification:**
- 24-hour period completed without interruption
- All 6 checkpoints (0, 4, 8, 12, 16, 20, 24) documented
- Quality checks performed at 8-hour intervals
- Issues (if any) documented with timestamps

**Success indicators:**
- Success rate ≥95%
- Zero signature failures
- Response time <10s average
- No critical errors
- Production Ready: YES
</verification>

<success_criteria>
1. Bot operates for 24 hours without crashes
2. No webhook delivery failures
3. Response time under 10 seconds (average)
4. No signature verification errors
5. Bot responses appropriate (manual checks)
6. Error rate under 5%
7. Production readiness determination documented
</success_criteria>

<output>
After completion, create `.planning/phases/03-live-bot-integration/03-04-SUMMARY.md` with:
- 24-hour monitoring summary
- Final metrics (deliveries, success rate, response time, errors)
- Quality check results
- Issues encountered and resolutions
- Production readiness assessment
- Recommendations for ongoing monitoring
</output>
