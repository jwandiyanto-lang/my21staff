---
phase: 02-production-deployment
task: 3
total_tasks: 4
status: in_progress
last_updated: 2026-01-29

---

<current_state>
Working on Kapso webhook and inbox fixes for Phase 3 (Live Bot Integration).

Fixes completed so far:
1. ✅ Webhook configured with all WhatsApp events
2. ✅ Kapso v2 payload support added to convex/kapso.ts
3. ✅ Contact name display updated in conversation-list.tsx (prioritizes kapso_name)
4. ✅ Image caption support added
5. ✅ Media URL fetching added for Kapso v2 images

Current issues:
1. ❌ Kapso history sync failing - workspace lookup returning 404
2. ❌ Chat back/reply not working in inbox
</current_state>

<completed_work>

- Task 1: Fix Kapso webhook v2 payload format - Done
- Task 2: Configure Kapso webhook for all WhatsApp events - Done
- Task 3: Sync Kapso message history to Convex - In progress (blocked by workspace phone ID issue)
- Task 4: Fix chat back/reply in inbox - Not started

</completed_work>

<remaining_work>

- Task 3: Need to fix Eagle Overseas workspace to have kapso_phone_id = 930016923526449 before sync can work
- Task 4: Implement chat back/reply functionality for inbox

</remaining_work>

<decisions_made>

- Decided to skip Kapso API lookups for workspace ID (all returning 404)
- Will update workspace Kapso phone ID directly in database using Convex mutation

</decisions_made>

<blockers>
- Workspace phone ID (kapso_phone_id) is not set to 930016923526449 - causes webhook sync failures
</blockers>

<context>
The issue with Kapso API endpoints returning 404 started happening after the Phase 2.1 completion when the ARI Config API was fixed. The workspace was originally set up with the correct phone number, but it appears to have lost the kapso_phone_id value or it was never properly set.

The Kapso phone number ID should be: 930016923526449
The webhook is already configured to point to the correct Convex endpoint and is receiving Kapso v2 payloads correctly.
</context>

<next_action>
Fix Eagle Overseas workspace kapso_phone_id to 930016923526449, then sync Kapso history
</next_action>
