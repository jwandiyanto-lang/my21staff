---
phase: 02-production-deployment
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All production pages are accessible without 500 errors"
    - "Authentication flow works end-to-end in production"
    - "Production features match localhost capabilities exactly"
    - "Eagle Overseas workspace shows real Convex data, not mock data"
    - "All API routes return expected responses"
  artifacts:
    - path: "Production application at [URL]"
      provides: "Feature-complete production deployment"
      contains: "All v3.4 features working"
  key_links:
    - from: "Production frontend"
      to: "Convex database"
      via: "ConvexProviderWithClerk"
      pattern: "useQuery.*api\\."
    - from: "Production API routes"
      to: "Convex functions"
      via: "fetchMutation/fetchQuery"
      pattern: "/api/.*→.*api\\."
---

<objective>
Verify production deployment matches localhost feature parity through comprehensive smoke testing and feature audit.

Purpose: Ensure all features that worked in localhost `/demo` mode work identically in production with real Convex data and Clerk authentication.

Output: Complete feature parity verification report confirming production readiness.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/jfransisco/Desktop/21/my21staff/.planning/PROJECT.md
@/home/jfransisco/Desktop/21/my21staff/.planning/ROADMAP.md
@/home/jfransisco/Desktop/21/my21staff/.planning/STATE.md
@/home/jfransisco/Desktop/21/my21staff/.planning/phases/01-localhost-polish/PHASE-COMPLETE.md
@/home/jfransisco/Desktop/21/my21staff/docs/PRODUCTION-CHECKLIST.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete production deployment with all v3.4 features (from Phase 1 localhost verification):

**Inbox Features (9 items):**
- Load conversations with filters (status/tags/assignment)
- Mark as read on click
- Toggle AI/Human status per conversation
- Send messages via Kapso
- Real-time conversation updates
- Notification badges
- Right sidebar (hidden by default)
- Phone-based avatar colors
- Activity timeline in sidebar

**Contact Features (8 items):**
- Load activities and notes
- Add notes with due dates
- Edit contact fields
- Change contact status
- Lead score calculation (form-based)
- Phone-based avatar consistency
- Lead created date display
- Collapsible lead score section

**Merge Features (5 items):**
- Search contacts with real-time filtering
- Compare contacts side-by-side
- Select all fields (name, email, phone, status, score, tags, activity)
- Activity count display
- Confirmation dialog before merge

**Database Features (4 items):**
- List all contacts with pagination
- Create new contacts
- Update existing contacts
- Delete contacts with cascade

**Your Intern Features (5 tabs):**
- Persona configuration
- Flow settings
- Database connections
- Scoring rules
- Time slots management

All features verified working in localhost `/demo` mode during Phase 1.
  </what-built>
  <how-to-verify>
**Step 1: Authentication Smoke Test**

1. Open production URL in private/incognito window
2. Should redirect to Clerk sign-in page
3. Sign in with Eagle Overseas account credentials
4. Should redirect to `/eagle-overseas` workspace
5. Verify:
   - No authentication errors
   - User profile shows in top-right
   - Workspace name "Eagle Overseas" appears

**Expected:** Successful authentication, redirect to workspace dashboard

---

**Step 2: Page Accessibility Smoke Test**

Visit each main page and verify no 500 errors:

1. **Dashboard** (`/eagle-overseas`)
   - ✓ Page loads without errors
   - ✓ Stats cards show numbers (not "Error loading")
   - ✓ Activity feed shows items or empty state

2. **Inbox** (`/eagle-overseas/inbox`)
   - ✓ Page loads without errors
   - ✓ Conversations list appears (or empty state)
   - ✓ Filter tabs visible (All/Active, Status, Tags, Assignment)

3. **Database** (`/eagle-overseas/database`)
   - ✓ Page loads without errors
   - ✓ Contact table appears with columns
   - ✓ Search box and "New Contact" button visible

4. **Your Intern** (`/eagle-overseas/your-intern`)
   - ✓ Page loads without errors
   - ✓ All 5 tabs visible (Persona, Flow, Database, Scoring, Slots)
   - ✓ Configuration forms render

5. **Settings** (`/eagle-overseas/settings`)
   - ✓ Page loads without errors
   - ✓ Team management interface visible

**Expected:** All pages return HTTP 200, no 500 errors, no "Failed to load" messages

---

**Step 3: Feature Parity Audit (Inbox)**

**Test: Load Conversations**
1. Go to `/eagle-overseas/inbox`
2. Check if conversations load from Convex (NOT mock data)
3. Verify filter tabs work (Active/All toggle)
4. Click different status filters

**Expected:**
- Real conversations from Eagle Overseas workspace
- Filter tabs update conversation list
- No "MOCK_INBOX_DATA" visible in dev tools

**Test: Mark as Read**
1. Click on an unread conversation
2. Notification badge should disappear
3. Reload page - should stay marked as read

**Expected:**
- Badge clears on click
- State persists after reload (Convex mutation works)

**Test: Toggle AI/Human Status**
1. Select a conversation
2. Click AI toggle switch in conversation header
3. Status should change and persist

**Expected:**
- Toggle switches between "AI" and "Human"
- Status persists after reload

---

**Step 4: Feature Parity Audit (Contact Sidebar)**

**Test: Activity Timeline**
1. Click any conversation to open sidebar
2. Activities section should show notes/messages
3. Should see "Add Note" box at top

**Expected:**
- Real activities from Convex (NOT "3 dummy activities for Budi")
- Add note box functional
- Timeline sorted by date (newest first)

**Test: Add Note**
1. Type note content: "Production test note"
2. Set due date (optional)
3. Click "Add Note"
4. Note should appear in timeline

**Expected:**
- Note saves successfully
- Appears in timeline immediately
- Persists after reload

**Test: Lead Score Display**
1. Check Lead Score section in sidebar
2. Should show breakdown (Basic Info, Qualification, etc.)
3. Total score should match calculation

**Expected:**
- Form score calculated from questionnaire data
- Chat score shows (may be hardcoded 47 - known limitation)
- Total = Form + Chat

---

**Step 5: Feature Parity Audit (Merge Contacts)**

**Test: Search Contacts**
1. Go to `/eagle-overseas/database`
2. Click "Merge Contacts" (if button exists) or use contact menu
3. Search for a contact name
4. Results should filter in real-time

**Expected:**
- Search queries Convex (NOT MOCK_CONTACTS)
- Results update as you type
- Shows real contact data

**Test: Merge Flow**
1. Select two contacts to merge
2. Compare side-by-side view
3. Select fields to keep (name, email, phone, etc.)
4. Confirm merge

**Expected:**
- Comparison shows real field values
- Activity count displays correctly (e.g., "4 activities")
- Confirmation dialog appears
- Merge completes successfully

---

**Step 6: Feature Parity Audit (Your Intern)**

**Test: All 5 Tabs Render**
1. Go to `/eagle-overseas/your-intern`
2. Click through each tab:
   - Persona (bot personality config)
   - Flow (conversation flow settings)
   - Database (contact field mapping)
   - Scoring (lead scoring rules)
   - Slots (consultation time slots)

**Expected:**
- All tabs render without errors
- Configuration forms appear
- Can edit and save settings

---

**Step 7: Console Error Check**

1. Open browser DevTools (F12)
2. Go to Console tab
3. Navigate through all pages (Dashboard, Inbox, Database, Your Intern, Settings)
4. Check for errors

**Expected:**
- No red errors in console
- No "Failed to fetch" messages
- No "undefined is not a function" errors
- No Convex connection errors

---

**Step 8: Network Tab Verification**

1. Open DevTools → Network tab
2. Filter by "Fetch/XHR"
3. Navigate to Inbox page
4. Check network requests

**Expected:**
- Requests to `https://intent-otter-212.convex.cloud`
- No requests to `localhost:3000/api` (dev mode)
- All requests return 200 status
- Response bodies contain real data (not mock)

---

**Step 9: Environment Variable Verification**

1. Open DevTools → Console
2. Type: `console.log(process.env.NEXT_PUBLIC_DEV_MODE)`
3. Check output

**Expected:**
- Output: `undefined` (variable not set in production)
- If shows `"true"`, deployment is using dev mode (FAILURE)

---

**Summary Checklist**

After completing all verification steps, confirm:

- [ ] Authentication works (sign in, redirect, user profile)
- [ ] All 5 pages load without 500 errors
- [ ] Conversations load from Convex (real data, not mock)
- [ ] Mark as read persists
- [ ] AI/Human toggle works
- [ ] Activities show real data (not dummy notes)
- [ ] Add note saves to Convex
- [ ] Lead score calculates correctly
- [ ] Merge search queries Convex
- [ ] Merge flow completes successfully
- [ ] All 5 Your Intern tabs render
- [ ] No console errors on any page
- [ ] Network requests go to Convex (not localhost)
- [ ] NEXT_PUBLIC_DEV_MODE is undefined (not "true")

**Type "approved" if all checks pass**
**Type "issues: [description]" if any checks fail**

Example issues format:
```
issues: Conversations not loading, shows "Failed to fetch" error. Network tab shows 401 from Convex.
```
  </how-to-verify>
  <resume-signal>
Type "approved" if all feature parity checks pass

OR

Type "issues: [description]" with specific failures found
  </resume-signal>
</task>

<task type="auto">
  <name>Generate production verification report</name>
  <files></files>
  <action>
After user confirms feature parity verification, generate comprehensive production verification report.

**Report structure:**

```markdown
# Production Verification Report

**Date:** [current date]
**Production URL:** [from 02-02 summary]
**Platform:** [Railway/Render/Fly.io from 02-02]
**Verified By:** User + Claude

---

## Deployment Summary

- ✅ Build completed successfully
- ✅ All 13 environment variables configured
- ✅ HTTPS enforced
- ✅ Application accessible at production URL

---

## Feature Parity Verification

### Authentication
- ✅ Sign-in flow works
- ✅ Redirect to workspace successful
- ✅ User profile displays correctly

### Page Accessibility (5/5 pages)
- ✅ Dashboard loads without errors
- ✅ Inbox loads without errors
- ✅ Database loads without errors
- ✅ Your Intern loads without errors
- ✅ Settings loads without errors

### Inbox Features (9/9 working)
- ✅ Conversations load from Convex
- ✅ Filters work (status/tags/assignment)
- ✅ Mark as read persists
- ✅ AI/Human toggle works
- ✅ Real-time updates working
- ✅ Notification badges functional
- ✅ Sidebar behavior correct
- ✅ Avatar colors consistent
- ✅ Activity timeline visible

### Contact Features (8/8 working)
- ✅ Activities load from Convex
- ✅ Add notes saves successfully
- ✅ Edit contact works
- ✅ Status changes persist
- ✅ Lead score calculates correctly
- ✅ Form score: [value] pts
- ⚠️ Chat score: 47 pts (hardcoded - known limitation)
- ✅ Total score correct

### Merge Features (5/5 working)
- ✅ Search queries Convex
- ✅ Real-time filtering works
- ✅ Comparison shows all fields
- ✅ Activity count displays
- ✅ Merge completes successfully

### Your Intern Features (5/5 tabs)
- ✅ Persona tab renders
- ✅ Flow tab renders
- ✅ Database tab renders
- ✅ Scoring tab renders
- ✅ Slots tab renders

---

## Technical Verification

- ✅ No console errors on any page
- ✅ All network requests to Convex (not localhost)
- ✅ NEXT_PUBLIC_DEV_MODE is undefined (production mode)
- ✅ All API routes return expected data
- ✅ No mock data visible in production

---

## Known Limitations

1. **Chat Score Hardcoded**
   - Status: ⚠️ Deferred to v3.6
   - Impact: Chat score shows 47 pts regardless of actual conversation
   - Workaround: Form score still calculates correctly (85 pts for Budi)

2. **Convex Auth Check Commented**
   - Status: ⚠️ Intentional
   - Reason: Clerk handles authentication, Convex check is redundant
   - Impact: None (authentication still secure via Clerk)

---

## Production Readiness: ✅ VERIFIED

All 7 deployment requirements met:

- ✅ DEPLOY-01: Environment variables configured (13/13)
- ✅ DEPLOY-02: Clerk JWT template verified (org_id claim present)
- ✅ DEPLOY-03: Production build succeeds (npm run build passes)
- ✅ DEPLOY-04: Deployed to hosting platform ([platform name])
- ✅ DEPLOY-05: Smoke tests pass (5/5 pages accessible, auth works)
- ✅ DEPLOY-06: Feature parity verified (31/31 features working)
- ✅ DEPLOY-07: Eagle workspace accessible with real Convex data

---

## Comparison: Localhost vs Production

| Aspect | Localhost (/demo) | Production |
|--------|-------------------|------------|
| Authentication | Skipped (dev mode) | Clerk (working) |
| Database | MOCK_CONTACTS | Convex (working) |
| Conversations | MOCK_INBOX_DATA | Convex (working) |
| Activities | Dummy data for Budi | Real Convex data |
| Search | Mock filter | Convex query |
| Mark as read | Skipped | Convex mutation |
| Add notes | API (mock success) | Convex mutation |
| Feature count | 31 features | 31 features ✅ |

**Result:** 100% feature parity achieved.

---

## Handoff to Phase 3

**Status:** ✅ Production deployment complete and verified

**Next Phase:** Live Bot Integration
- Kapso webhook connection to production
- ARI responding to real WhatsApp messages
- 24-hour stability monitoring

**Production URL:** [URL from deployment]
**Ready for live traffic:** ✅ Yes

---

*Generated: [timestamp]*
```

Write this report to a new file: `.planning/phases/02-production-deployment/PRODUCTION-VERIFIED.md`

Use actual values from previous tasks:
- Production URL from 02-02 summary
- Platform choice from 02-02 summary
- User verification results from checkpoint
  </action>
  <verify>
Confirm report generated:

```bash
cat .planning/phases/02-production-deployment/PRODUCTION-VERIFIED.md | grep -E "(Production URL|Feature Parity|DEPLOY-)" | head -10
```

Expected output: Report contains production URL, feature verification summary, and requirement checkboxes
  </verify>
  <done>
PRODUCTION-VERIFIED.md report generated with complete feature parity verification, deployment summary, and handoff details for Phase 3.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. User has verified all features in production
2. Production verification report exists
3. All 7 DEPLOY requirements marked complete
4. No feature parity gaps identified
5. Production ready for Phase 3 (Live Bot Integration)

Final check:
```bash
grep -c "✅" .planning/phases/02-production-deployment/PRODUCTION-VERIFIED.md
```

Expected: 30+ checkmarks (31 features + 7 requirements + deployment items)
</verification>

<success_criteria>
1. All production pages accessible without 500 errors
2. Authentication flow works end-to-end
3. All 31 features verified working (9 inbox + 8 contact + 5 merge + 4 database + 5 Your Intern)
4. Production uses real Convex data (not mock data)
5. NEXT_PUBLIC_DEV_MODE is undefined in production
6. No console errors on any page
7. Production verification report generated
8. All 7 DEPLOY requirements complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-production-deployment/02-03-SUMMARY.md` including:
- Feature parity verification results
- Any issues found and resolved
- Production verification report location
- Handoff notes for Phase 3
</output>
