---
phase: 2.1-production-bug-remediation
plan: 03
subsystem: ui
tags: [inbox, filters, react, convex, pagination]

# Dependency graph
requires:
  - phase: 02-02
    provides: Live production application at https://www.my21staff.com
  - phase: 02-03
    provides: Bug verification report identifying Issues #3 and #4
provides:
  - Working inbox filter tabs with correct pagination behavior
  - Persistent InfoSidebar that remains clickable after filter navigation
  - Filter-then-paginate pattern for contact-based conversation queries
  - Z-index hierarchy for overlay components
affects: [inbox-features, conversation-filtering, sidebar-components]

# Tech tracking
tech-stack:
  added: []
  patterns: [filter-then-paginate, z-index-hierarchy, react-key-identity]

key-files:
  created: []
  modified:
    - convex/conversations.ts
    - src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx

key-decisions:
  - "Filter conversations before pagination (not after) to avoid empty results"
  - "InfoSidebar z-index must be above dropdowns (z-60 > z-50)"
  - "React key on InfoSidebar forces remount on contact change"

patterns-established:
  - "Fetch all contacts upfront when filtering by contact properties (lead_status, tags)"
  - "Apply filters before slice() pagination, not after"
  - "Overlay components need z-index above popovers/dropdowns (z-60+)"

# Metrics
duration: 4min
completed: 2026-01-29
---

# Phase 2.1 Plan 03: Inbox Filter Tabs & Activities Summary

**Filter-then-paginate pattern for conversation queries + z-index fix for InfoSidebar overlay persistence**

## Performance

- **Duration:** 4 min
- **Started:** 2026-01-29T07:04:25Z
- **Completed:** 2026-01-29T07:08:10Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- Fixed conversation filters to work correctly (clicking "Hot" now shows hot leads)
- InfoSidebar remains clickable after filter tab navigation
- Filter tabs display accurate conversation counts after filtering
- Z-index hierarchy prevents dropdown overlays from covering sidebar

## Task Commits

Each task was committed atomically:

1. **Task 1: Fix Inbox filter tabs to properly filter conversations** - `e4529f0` (fix)
2. **Task 2: Fix activities sidebar freeze after tab navigation** - `ef280a2` (fix)

**Plan metadata:** Will be committed with SUMMARY.md

## Files Created/Modified

- `convex/conversations.ts` - Fixed pagination logic to filter before slice
- `src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx` - Added InfoSidebar React key and z-index fix

## Decisions Made

**1. Filter before paginate, not after**
- Rationale: Filtering after pagination (slice first, then filter) meant clicking "Hot" would get 50 conversations, filter them, and show 0-50 results depending on distribution
- Solution: Fetch all contacts upfront, filter conversations, THEN paginate
- Trade-off: Fetch more data initially, but ensures filters work correctly

**2. InfoSidebar z-index above dropdowns**
- Rationale: Dropdown menus (z-50) were covering the sidebar (z-10), making activities unclickable after tab navigation
- Solution: Increased sidebar z-index to z-60 to stay above all dropdown overlays
- Z-index hierarchy: Base UI (z-10) < Dropdowns (z-50) < Overlays (z-60)

**3. React key for InfoSidebar identity**
- Rationale: Without a key, React might reuse the same component instance when contact changes, causing stale event handlers
- Solution: Added `key={contactForSidebar.id}` to force proper remount
- Result: Event handlers recreated correctly on contact change

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - root causes identified immediately:
- Filter pagination order was obvious from code inspection
- Z-index conflict discovered from dropdown z-50 vs sidebar z-10

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

**Issues resolved:**
- ✅ Issue #3: Inbox filter tabs now work correctly
- ✅ Issue #4: Activities sidebar remains clickable after tab navigation

**Ready for:**
- Remaining Phase 2.1 bug fixes (2.1-08 final verification)
- Core Inbox functionality fully operational

---
*Phase: 2.1-production-bug-remediation*
*Completed: 2026-01-29*
