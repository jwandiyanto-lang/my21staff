---
phase: 02.1-ui-documentation
plan: 04
type: execute
wave: 2
depends_on: []
files_modified:
  - src/app/(dashboard)/[workspace]/settings/settings-client.tsx
  - convex/quickReplies.ts
  - src/components/inbox/compose-input.tsx
autonomous: true

must_haves:
  truths:
    - "User can save quick replies in Settings and they persist"
    - "Saved quick replies appear in Inbox compose area"
    - "User can select and insert quick replies into messages"
  artifacts:
    - path: "src/app/(dashboard)/[workspace]/settings/settings-client.tsx"
      provides: "Quick replies configuration UI with save functionality"
      contains: "quick reply form, save handler"
    - path: "convex/quickReplies.ts"
      provides: "Database mutations for quick reply CRUD"
      exports: ["create", "update", "list", "delete"]
    - path: "src/components/inbox/compose-input.tsx"
      provides: "Message compose area with quick reply selector"
      contains: "quick reply dropdown, insert handler"
  key_links:
    - from: "settings-client.tsx save handler"
      to: "convex/quickReplies.create"
      via: "Convex mutation"
      pattern: "api\\.quickReplies\\.create"
    - from: "compose-input.tsx"
      to: "convex/quickReplies.list"
      via: "Convex query"
      pattern: "useQuery.*quickReplies\\.list"
---

<objective>
Implement quick replies end-to-end: save in Settings, display in Inbox compose area (Issues #11, #12).

Purpose: Quick replies feature is completely non-functional. Users cannot save quick reply templates in Settings (Issue #11), and even if saved manually, they don't appear in the Inbox compose area (Issue #12). This blocks a core efficiency feature for responding to common customer inquiries.

Output: Working quick replies CRUD in Settings, quick reply selector in Inbox compose area, complete end-to-end flow from configuration to usage.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/jfransisco/Desktop/21/my21staff/.planning/PROJECT.md
@/home/jfransisco/Desktop/21/my21staff/.planning/ROADMAP.md
@/home/jfransisco/Desktop/21/my21staff/.planning/STATE.md
@/home/jfransisco/Desktop/21/my21staff/.planning/phases/02-production-deployment/02-03-SUMMARY.md

# Quick replies files
@/home/jfransisco/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/settings/settings-client.tsx
@/home/jfransisco/Desktop/21/my21staff/convex/quickReplies.ts
@/home/jfransisco/Desktop/21/my21staff/convex/schema.ts
@/home/jfransisco/Desktop/21/my21staff/src/components/inbox/compose-input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix quick reply save functionality in Settings</name>
  <files>
    src/app/(dashboard)/[workspace]/settings/settings-client.tsx
    convex/quickReplies.ts
    convex/schema.ts
  </files>
  <action>
Test quick reply save at https://www.my21staff.com/eagle-overseas/settings:

1. Navigate to Quick Replies section (or tab)
2. Enter shortcut (e.g., "/greeting") and message (e.g., "Hello! How can I help?")
3. Click save
4. Check Network tab for errors
5. Check if success toast appears

If save fails, investigate:
- Does convex/quickReplies.ts exist with create/update mutations?
- Is the schema defined in convex/schema.ts for quickReplies table?
- Is the Settings form calling the correct Convex mutation?
- Are workspace ID and user ID being passed correctly?

**If Convex schema missing:**
Add to convex/schema.ts:
```typescript
quickReplies: defineTable({
  workspaceId: v.string(),
  shortcut: v.string(),      // e.g., "/greeting"
  message: v.string(),        // e.g., "Hello! How can I help?"
  createdBy: v.string(),
  createdAt: v.number(),
  updatedAt: v.number(),
})
  .index("by_workspace", ["workspaceId"])
  .index("by_shortcut", ["workspaceId", "shortcut"])
```

**If mutations missing:**
Add to convex/quickReplies.ts:
```typescript
export const create = mutation({
  args: {
    workspaceId: v.string(),
    shortcut: v.string(),
    message: v.string(),
  },
  handler: async (ctx, args) => {
    const userId = await getAuthUserId(ctx)
    if (!userId) throw new Error("Unauthorized")

    // Check for duplicate shortcut
    const existing = await ctx.db
      .query("quickReplies")
      .withIndex("by_shortcut", q =>
        q.eq("workspaceId", args.workspaceId).eq("shortcut", args.shortcut)
      )
      .first()

    if (existing) throw new Error("Shortcut already exists")

    return await ctx.db.insert("quickReplies", {
      ...args,
      createdBy: userId,
      createdAt: Date.now(),
      updatedAt: Date.now(),
    })
  }
})

export const list = query({
  args: { workspaceId: v.string() },
  handler: async (ctx, args) => {
    return await ctx.db
      .query("quickReplies")
      .withIndex("by_workspace", q => q.eq("workspaceId", args.workspaceId))
      .collect()
  }
})
```

**Update Settings UI:**
- Ensure form submits to convex/quickReplies.create
- Add loading state during save
- Show success toast on success
- Display saved quick replies in list/table
- Add edit and delete functionality

Test locally: `npm run dev`, test at http://localhost:3000/demo/settings
  </action>
  <verify>
At https://www.my21staff.com/eagle-overseas/settings:
1. Add quick reply with shortcut "/test" and message "Test message"
2. Click save - success toast appears
3. Reload page - quick reply appears in list
4. Edit quick reply - changes persist
5. Delete quick reply - removed from list

Quick reply CRUD works end-to-end. Issue #11 resolved.
  </verify>
  <done>
Quick replies can be saved in Settings successfully. CRUD operations (create, read, update, delete) all functional. Data persists across page reloads.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add quick reply selector to Inbox compose area</name>
  <files>
    src/components/inbox/compose-input.tsx
  </files>
  <action>
Quick replies must be accessible in Inbox for users to actually use them.

**Implementation approach:**

1. **Query quick replies in compose-input.tsx:**
```typescript
const quickReplies = useQuery(api.quickReplies.list, {
  workspaceId: workspace.id
})
```

2. **Add quick reply dropdown/button:**
- Add a button/icon next to the send button (e.g., lightning bolt icon ⚡ or "/")
- On click, show dropdown menu with all quick replies
- Display shortcut and first 30 chars of message as preview
- Make dropdown searchable/filterable for large lists

3. **Insert quick reply into textarea:**
```typescript
const insertQuickReply = (message: string) => {
  setMessage(prev => prev + message)
  // or replace entire message: setMessage(message)
  textareaRef.current?.focus()
}
```

4. **Alternative: Slash command autocomplete:**
- Detect "/" character typed in textarea
- Show autocomplete dropdown with matching shortcuts
- Filter as user types (e.g., "/gre" shows "/greeting")
- Insert on selection (replace "/gre" with full message)

Choose UI pattern based on what's more intuitive and matches existing design system.

**WhatsApp-style quick reply UI:**
- Small button next to emoji picker (if exists) or send button
- Click shows modal/popover with quick reply list
- Click quick reply → inserts message → user can edit before sending
- Keyboard shortcut: "/" shows autocomplete

Test locally first with mock data at http://localhost:3000/demo/inbox
  </action>
  <verify>
At https://www.my21staff.com/eagle-overseas/inbox:
1. Open any conversation
2. Click quick reply button/icon in compose area - dropdown appears
3. Dropdown shows all saved quick replies with shortcuts and previews
4. Click a quick reply - message inserted into textarea
5. User can edit inserted message before sending
6. Send message - works normally

Quick reply selector functional and integrated into compose UI.
  </verify>
  <done>
Quick reply selector appears in Inbox compose area. Users can browse, select, and insert quick replies. UI is intuitive and matches existing design patterns.
  </done>
</task>

<task type="auto">
  <name>Task 3: End-to-end verification and UX polish</name>
  <files>
    src/app/(dashboard)/[workspace]/settings/settings-client.tsx
    src/components/inbox/compose-input.tsx
  </files>
  <action>
Test the complete quick replies flow from configuration to usage:

**Configuration flow:**
1. Go to Settings > Quick Replies
2. Add 3 quick replies:
   - "/greeting" → "Hello! How can I help you today?"
   - "/hours" → "Our business hours are Monday-Friday, 9 AM - 5 PM WIB."
   - "/thanks" → "Thank you for contacting us! We'll get back to you soon."
3. Verify all saved successfully

**Usage flow:**
1. Go to Inbox, open a conversation
2. Click quick reply button
3. Select "/greeting" - message appears in textarea
4. Edit message slightly
5. Send message - delivered successfully

**UX polish:**
- Empty state in Settings: "No quick replies yet. Create your first template!"
- Empty state in Inbox dropdown: "No quick replies. Create them in Settings."
- Loading states for both query and mutation operations
- Error handling: Show user-friendly error if save fails
- Duplicate shortcut validation: "Shortcut already exists"
- Character limit hints: "Max 1000 characters"
- Quick reply preview shows formatted message (preserve line breaks)

**Accessibility:**
- Quick reply button has aria-label
- Dropdown is keyboard navigable (arrow keys, Enter to select)
- Focus returns to textarea after selection

If any issues found, fix and re-test until complete flow works smoothly.
  </action>
  <verify>
Complete end-to-end test at https://www.my21staff.com:
1. Settings: Create, edit, delete quick replies - all work
2. Inbox: Insert quick replies into messages - works
3. Message delivery: Messages with inserted quick replies send successfully
4. UX: Empty states, loading states, errors all handled gracefully
5. Accessibility: Keyboard navigation works

Quick replies feature is production-ready and user-friendly.
  </verify>
  <done>
Quick replies work end-to-end: save in Settings (Issue #11 resolved), display and insert in Inbox (Issue #12 resolved). Feature is complete, polished, and accessible.
  </done>
</task>

</tasks>

<verification>
**Settings Save (Issue #11):**
- Visit https://www.my21staff.com/eagle-overseas/settings
- Create quick reply with shortcut and message
- Save successfully, appears in list
- Edit and delete work correctly

**Inbox Display (Issue #12):**
- Visit https://www.my21staff.com/eagle-overseas/inbox
- Quick reply selector visible in compose area
- Click selector, all saved quick replies appear
- Select quick reply, message inserted into textarea
- Send message successfully

**End-to-End:**
- Create quick reply in Settings → Use in Inbox → Send message
- Complete workflow functional from start to finish

**Overall:**
Quick replies feature fully implemented and verified in production.
</verification>

<success_criteria>
**Must be TRUE:**
1. Quick replies can be saved in Settings successfully
2. Quick replies appear in list after save
3. Quick replies persist across page reloads
4. Quick reply selector appears in Inbox compose area
5. Saved quick replies are accessible in selector
6. Selecting quick reply inserts message into textarea
7. Messages with inserted quick replies send successfully
8. Issues #11 and #12 from verification report are resolved
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-ui-documentation/2.1-04-SUMMARY.md` following the template structure with:
- Performance metrics (duration, files modified)
- Accomplishments (quick replies end-to-end implementation)
- Technical approach (Convex schema, mutations, UI integration)
- Verification results (both save and display working)
- UX decisions (dropdown vs autocomplete, keyboard shortcuts)
</output>
