---
phase: 02.1-ui-documentation
plan: 03
type: execute
wave: 2
depends_on: []
files_modified:
  - src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
  - src/components/inbox/conversation-list.tsx
autonomous: true

must_haves:
  truths:
    - "Inbox filter tabs filter conversations correctly (Status, Tags, Assignment)"
    - "Activities sidebar remains clickable after tab navigation"
    - "Only 'All' tab shows all conversations, other tabs filter correctly"
  artifacts:
    - path: "src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx"
      provides: "Filter state management and conversation filtering logic"
      contains: "status filter, tags filter, assignment filter"
    - path: "src/components/inbox/conversation-list.tsx"
      provides: "Conversation list rendering with applied filters"
      contains: "filtered conversations rendering"
  key_links:
    - from: "inbox-client.tsx filter handlers"
      to: "conversation-list.tsx filteredConversations"
      via: "React props"
      pattern: "filteredConversations.*filter.*status|tags"
    - from: "filter tab clicks"
      to: "conversation list state update"
      via: "useState setter"
      pattern: "setSelectedStatus|setSelectedTags"
---

<objective>
Fix Inbox filter tabs and restore activities sidebar clickability after tab navigation (Issues #3, #4).

Purpose: Inbox filtering is completely non-functional except for "All" tab. Users cannot filter conversations by Status, Tags, or Assignment, making it difficult to manage large conversation lists. Additionally, Activities sidebar becomes unclickable after switching between filter tabs, requiring page reload. Both issues degrade core Inbox usability.

Output: Working filter tabs that correctly filter conversations, persistent activities sidebar clickability across tab navigation.
</objective>

<execution_context>
@/home/jfransisco/.claude/get-shit-done/workflows/execute-plan.md
@/home/jfransisco/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/jfransisco/Desktop/21/my21staff/.planning/PROJECT.md
@/home/jfransisco/Desktop/21/my21staff/.planning/ROADMAP.md
@/home/jfransisco/Desktop/21/my21staff/.planning/STATE.md
@/home/jfransisco/Desktop/21/my21staff/.planning/phases/02-production-deployment/02-03-SUMMARY.md
@/home/jfransisco/Desktop/21/my21staff/.planning/phases/02.1-ui-documentation/02.1-CONTEXT.md

# Inbox filter files
@/home/jfransisco/Desktop/21/my21staff/src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
@/home/jfransisco/Desktop/21/my21staff/src/components/inbox/conversation-list.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Investigate filter tab failures</name>
  <files>
    src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
    src/components/inbox/conversation-list.tsx
  </files>
  <action>
Test filter tabs at https://www.my21staff.com/eagle-overseas/inbox:

1. Click "All" tab - note which conversations appear
2. Click Status filter dropdown, select "Hot" - observe if list changes
3. Click Tags filter dropdown, select a tag - observe if list changes
4. Click back to "All" - observe if full list returns

Open browser DevTools Console and React DevTools to check:
- Are filter state changes triggering re-renders?
- Is filteredConversations array being updated correctly?
- Are filter handlers being called when dropdowns change?
- Check for console errors or warnings

Read inbox-client.tsx to identify filtering logic:
- Find where status/tags filters are applied to conversations
- Check if filter logic is correct (e.g., `conversation.status === selectedStatus`)
- Verify filter combinations work (status AND tags)
- Look for empty filter state causing no conversations to show
- Check if "All" tab is clearing filters properly

Read conversation-list.tsx:
- Verify it receives filteredConversations prop correctly
- Check if it's rendering the filtered array or original array
- Look for hardcoded data or stale props
  </action>
  <verify>
Document findings with specific function names and line numbers where filtering logic exists or is broken.
  </verify>
  <done>
Root cause identified: Filter logic missing, incorrect, or not connected to UI state properly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix filter tab functionality</name>
  <files>
    src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
  </files>
  <action>
Based on Task 1 findings, implement correct filtering logic:

**Filter state management:**
- Ensure useState hooks exist for selectedStatus, selectedTags, selectedAssignment
- Ensure filter change handlers update state correctly
- Add "All" tab handler that clears all filters

**Filtering logic (apply in useMemo or useEffect):**
```typescript
const filteredConversations = useMemo(() => {
  let filtered = conversations

  // Status filter
  if (selectedStatus && selectedStatus !== 'all') {
    filtered = filtered.filter(c => c.status === selectedStatus)
  }

  // Tags filter (AND logic - conversation must have ALL selected tags)
  if (selectedTags.length > 0) {
    filtered = filtered.filter(c =>
      selectedTags.every(tag => c.tags?.includes(tag))
    )
  }

  // Assignment filter
  if (selectedAssignment && selectedAssignment !== 'all') {
    filtered = filtered.filter(c => c.assignedTo === selectedAssignment)
  }

  return filtered
}, [conversations, selectedStatus, selectedTags, selectedAssignment])
```

**Pass filteredConversations to conversation-list:**
- Ensure conversation-list.tsx receives `filteredConversations` prop
- Ensure it renders the filtered array, not the original conversations array

**UI feedback:**
- Show conversation count: "Showing 5 of 23 conversations"
- Show active filter badges or indicators
- Clear filters button if filters are active

Test locally first: `npm run dev`, test filtering at http://localhost:3000/demo/inbox
  </action>
  <verify>
At https://www.my21staff.com/eagle-overseas/inbox:
1. "All" tab shows all conversations (no filters)
2. Select Status "Hot" - only shows conversations with status="Hot"
3. Select Tag "eagle" - shows only conversations with that tag
4. Combine Status "Hot" + Tag "eagle" - shows only conversations matching both
5. Click "All" again - filters cleared, all conversations visible

Filter tabs work correctly with proper isolation and combination logic.
  </verify>
  <done>
Inbox filter tabs (Status, Tags, Assignment) filter conversations correctly. "All" tab shows unfiltered list. Issue #3 resolved.
  </done>
</task>

<task type="auto">
  <name>Task 3: Fix activities sidebar freeze after tab navigation</name>
  <files>
    src/app/(dashboard)/[workspace]/inbox/inbox-client.tsx
    src/components/inbox/conversation-list.tsx
  </files>
  <action>
This is Issue #4: Activities sidebar becomes unclickable after switching between filter tabs.

**Root cause will be one of:**
1. **Event handler detachment:** Click handlers removed/replaced during filter state changes
2. **Z-index or pointer-events CSS bug:** Something overlaying the activities area
3. **React key issues:** Component re-mounting incorrectly causing event listeners to break
4. **State update causing unmount:** Filter changes unmounting/remounting sidebar incorrectly

**Investigation steps:**
1. Test at https://www.my21staff.com/eagle-overseas/inbox
2. Switch between "All" and "Hot" filter tabs
3. Try clicking activities in sidebar
4. Use browser DevTools Elements tab to inspect activities sidebar
5. Check if click events are registered (Event Listeners panel)
6. Check computed CSS (pointer-events, z-index, opacity)

**Fix based on root cause:**

**If event handlers detached:**
- Ensure activities sidebar component doesn't unmount on filter changes
- Use stable references for click handlers (useCallback)
- Check if filter state changes are causing full component re-render

**If CSS bug:**
- Check for overlapping elements with higher z-index
- Verify `pointer-events: none` isn't applied
- Check for invisible overlay elements

**If React key issues:**
- Ensure activities sidebar has stable key prop
- Don't use index as key if list can reorder
- Verify parent components aren't unmounting sidebar

**If state causing unmount:**
- Move activities sidebar outside filtered content area
- Ensure sidebar state is independent of filter state
- Use conditional rendering carefully (prefer CSS hiding over unmounting)

**After fix:**
- Test clicking activities BEFORE tab navigation - should work
- Switch between filter tabs multiple times
- Test clicking activities AFTER tab navigation - should still work
- No page reload required to restore functionality
  </action>
  <verify>
At https://www.my21staff.com/eagle-overseas/inbox:
1. Click an activity in sidebar - modal/action opens correctly
2. Switch from "All" tab to "Hot" tab
3. Click same activity again - still works (no freeze)
4. Switch to "Tags" filter, select a tag
5. Click activity again - still works
6. Repeat 10+ tab navigation cycles - activities remain clickable

Activities sidebar never freezes, no page reload needed.
  </verify>
  <done>
Activities sidebar remains clickable across all filter tab navigation. No freeze or detachment after state changes. Issue #4 resolved.
  </done>
</task>

</tasks>

<verification>
**Filter Functionality (Issue #3):**
- Visit https://www.my21staff.com/eagle-overseas/inbox
- Test each filter tab: Status, Tags, Assignment
- Verify filtered results match selected criteria
- Verify "All" tab clears filters
- Verify filter combinations work correctly

**Activities Sidebar (Issue #4):**
- Click activities before filter changes - works
- Navigate between filter tabs 10+ times
- Click activities after filter changes - still works
- No page reload required at any point

**Overall:**
Inbox is fully functional with reliable filtering and persistent sidebar interactivity.
</verification>

<success_criteria>
**Must be TRUE:**
1. Status filter shows only conversations matching selected status
2. Tags filter shows only conversations with selected tags
3. Assignment filter shows only assigned conversations
4. "All" tab clears all filters and shows everything
5. Activities sidebar remains clickable after any number of tab navigations
6. No page reload required to restore functionality
7. Issues #3 and #4 from verification report are resolved
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-ui-documentation/2.1-03-SUMMARY.md` following the template structure with:
- Performance metrics (duration, files modified)
- Accomplishments (Inbox filtering restored, activities sidebar fixed)
- Root cause analysis (why filters failed, why sidebar froze)
- Verification results (both issues resolved)
- Impact (Inbox usability fully restored)
</output>
