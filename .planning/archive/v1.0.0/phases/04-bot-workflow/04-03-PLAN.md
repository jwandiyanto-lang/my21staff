---
phase: 04-bot-workflow
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/ai/context.ts
autonomous: true

must_haves:
  truths:
    - "Bot offers Community link as free option"
    - "Bot offers 1-on-1 Consultation as premium option"
    - "Bot can answer common FAQs about Eagle services"
  artifacts:
    - path: "convex/ai/context.ts"
      provides: "Routing state prompt + FAQ knowledge"
      exports: ["buildMouthSystemPrompt"]
  key_links:
    - from: "context.ts buildRoutingInstructions"
      to: "ariConfig.community_link"
      via: "includes community link in prompt"
      pattern: "community_link"
---

<objective>
Add routing state awareness and Eagle FAQ to Mouth system prompt.

Purpose: Enable bot to offer Community vs Consultation paths and answer common questions
Output: buildRoutingInstructions helper + Eagle FAQ embedded in prompts
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@planning/PROJECT.md
@planning/ROADMAP.md
@planning/phases/04-bot-workflow/04-RESEARCH.md
@convex/ai/context.ts
@business/bots/eagle-studenthub-bot.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add buildRoutingInstructions helper</name>
  <files>convex/ai/context.ts</files>
  <action>
Add helper function for routing state that offers Community vs Consultation:

```typescript
/**
 * Build routing instructions for offering next steps.
 * @param communityLink - From ariConfig.community_link (optional)
 */
function buildRoutingInstructions(
  communityLink: string | undefined,
  isIndonesian: boolean
): string {
  if (isIndonesian) {
    return `## TUGAS SAAT INI: Tawarkan pilihan next step
- PILIHAN 1: Konsultasi 1-on-1 (langsung dengan konsultan, lebih personal)
- PILIHAN 2: Gabung komunitas gratis (update harian, tips kuliah)
${communityLink ? `- Link komunitas: ${communityLink}` : ""}

CARA TAWARKAN:
- Jelaskan kedua opsi dengan singkat
- Biarkan customer pilih
- Kalau pilih konsultasi, bilang "oke saya akan hubungkan dengan tim kami ya kak"
- Kalau pilih komunitas, langsung kasih linknya

CONTOH:
Ari: "oke kak jadi untuk next step, mau langsung konsultasi 1-on-1 atau gabung komunitas dulu? di komunitas ada update tiap hari soal beasiswa dan tips kuliah luar negeri"

User: "komunitas dulu deh"
Ari: "oke kak ini linknya: ${communityLink || '[LINK]'} - join aja langsung ya! nanti kalau mau konsultasi tinggal chat lagi"

User: "mau konsultasi"
Ari: "oke kak, saya hubungkan dengan konsultan kami ya. mereka akan follow up segera!"`;
  }

  return `## CURRENT TASK: Offer next steps
- OPTION 1: 1-on-1 Consultation (personal guidance)
- OPTION 2: Free community (daily updates, tips)
${communityLink ? `- Community link: ${communityLink}` : ""}

Let customer choose, acknowledge their choice.`;
}
```

Update buildMouthSystemPrompt signature to accept communityLink parameter:
```typescript
export function buildMouthSystemPrompt(
  botName: string = "Ari",
  contactName: string = "kakak",
  language: string = "id",
  state: string = "greeting",
  context?: QualificationContext,
  communityLink?: string
): string
```

Add routing case to switch:
```typescript
case "routing":
  stateInstructions = buildRoutingInstructions(communityLink, isIndonesian);
  break;
```
  </action>
  <verify>`npx convex dev --once` compiles without errors</verify>
  <done>buildRoutingInstructions helper exists and offers Community/Consultation paths</done>
</task>

<task type="auto">
  <name>Task 2: Add Eagle FAQ knowledge to system prompt</name>
  <files>convex/ai/context.ts</files>
  <action>
Add buildEagleFAQ helper that embeds common knowledge:

```typescript
/**
 * Build Eagle Overseas FAQ knowledge section.
 * This gives the bot knowledge to answer common questions.
 */
function buildEagleFAQ(isIndonesian: boolean): string {
  if (isIndonesian) {
    return `## FAQ (gunakan untuk jawab pertanyaan)

TENTANG EAGLE:
- Eagle Overseas Indonesia = agen studi luar negeri
- Visa success rate: 98%
- Fokus: karir dan potensi mahasiswa, bukan komisi universitas

LAYANAN:
- Perencanaan studi strategis
- Bimbingan beasiswa
- Review esai motivasi
- Persiapan IELTS/TOEFL
- Pendampingan visa
- Optimasi CV & LinkedIn

NEGARA TUJUAN:
- Australia: Melbourne, UNSW, Monash
- Canada: UBC, UofT, McGill
- UK: Oxford, Cambridge, Imperial
- USA: Harvard, MIT, Stanford

KALAU DITANYA HARGA/BIAYA:
- Bilang: "untuk detail biaya, nanti tim kita yang jelaskan langsung ya kak"
- JANGAN kasih angka spesifik

KALAU DITANYA HAL YANG GA TAU:
- Bilang: "bentar ya saya tanya dulu ke tim, nanti saya kabarin"`;
  }

  return `## FAQ KNOWLEDGE

ABOUT EAGLE:
- Eagle Overseas Indonesia = study abroad agency
- 98% visa success rate
- Focus: student career potential, not university commissions

SERVICES:
- Strategic study planning
- Scholarship guidance
- Essay review
- IELTS/TOEFL prep
- Visa assistance
- CV & LinkedIn optimization

DESTINATIONS: Australia, Canada, UK, USA

IF ASKED ABOUT PRICING:
- Say: "our team will explain the details directly"
- DO NOT give specific numbers

IF UNSURE:
- Say: "let me check with the team and get back to you"`;
}
```

Include FAQ in the system prompt for all states:
```typescript
const faqSection = buildEagleFAQ(isIndonesian);

return `${basePersonaPrompt}

${faqSection}

${stateInstructions}

${collectedDataSection}`;
```
  </action>
  <verify>
1. `npx convex dev --once` compiles
2. `grep -n "Eagle Overseas" convex/ai/context.ts` shows FAQ content
  </verify>
  <done>Eagle FAQ knowledge embedded in all Mouth prompts</done>
</task>

</tasks>

<verification>
- [ ] buildRoutingInstructions helper function exists
- [ ] buildEagleFAQ helper function exists
- [ ] buildMouthSystemPrompt includes FAQ section
- [ ] buildMouthSystemPrompt switch handles "routing" state
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
Bot can offer Community/Consultation paths and answer common Eagle FAQs
</success_criteria>

<output>
After completion, create `planning/phases/04-bot-workflow/04-03-SUMMARY.md`
</output>
