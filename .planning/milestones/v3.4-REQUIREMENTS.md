# Requirements Archive: v3.4 Kapso Inbox Integration

**Archived:** 2026-01-28
**Status:** ✅ SHIPPED

This is the archived requirements specification for v3.4.
For current requirements, see `planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: my21staff v3.4

**Defined:** 2026-01-27
**Core Value:** The system that lets you grow

## v3.4 Requirements

Requirements for Kapso Inbox Integration milestone. Each maps to roadmap phases.

### Inbox UI & Filtering

- [x] **INBOX-01**: User can view conversations in Kapso-styled UI
  - **Outcome:** Implementation complete, integration verified, no formal verification file
- [x] **INBOX-02**: User can view message thread with Kapso-styled components
  - **Outcome:** Implementation complete, WhatsApp-style UI applied
- [x] **INBOX-03**: User can filter conversations by status (hot/warm/cold/new/client/lost)
  - **Outcome:** Implementation complete, FilterTabs with dropdown working
- [x] **INBOX-04**: User sees real-time message updates without refresh
  - **Outcome:** Verified — Convex subscriptions working, real-time sync <2 sec
- [x] **INBOX-05**: User can send messages from Inbox
  - **Outcome:** Implementation complete, optimistic UI working
- [x] **INBOX-06**: User can view media (images, documents) in messages
  - **Outcome:** Implementation complete, message-thread displays media

### Your Intern Configuration

- [x] **INTERN-01**: Your Intern page loads without errors in production
  - **Outcome:** Verified — Error boundaries + dev mode bypass working
- [x] **INTERN-02**: User can configure bot persona in Persona tab
  - **Outcome:** Pre-v3.4 implementation (v2.2) — working, persona-tab.tsx exists
- [x] **INTERN-03**: User can configure conversation flow in Flow tab
  - **Outcome:** Pre-v3.4 implementation (v2.2) — working, flow-tab.tsx exists
- [x] **INTERN-04**: User can configure database fields in Database tab
  - **Outcome:** Pre-v3.4 implementation (v2.2) — working, database-tab.tsx exists
- [x] **INTERN-05**: User can configure lead scoring rules in Scoring tab
  - **Outcome:** Pre-v3.4 implementation (v2.2) — working, scoring-tab.tsx exists
- [x] **INTERN-06**: User can configure consultation slots in Slots tab
  - **Outcome:** Pre-v3.4 implementation (v2.2) — working, slot-manager.tsx exists
- [x] **INTERN-07**: User can toggle AI on/off globally with one button
  - **Outcome:** Verified — AIToggle component wired to webhook gate

### ARI Flow Integration

- [x] **ARI-01**: New leads receive automatic AI response (AI-first)
  - **Outcome:** Verified — processARI schedules Mouth response, webhook gate working
- [x] **ARI-02**: User can toggle AI/Human mode per conversation in Inbox
  - **Outcome:** Verified — Per-conversation status gate, toggle UI complete
- [x] **ARI-03**: Your Intern configuration changes reflect in ARI behavior
  - **Outcome:** Verified — Hot-reload via getAriContext mutation, no caching
- [x] **ARI-04**: Complete flow works (new lead → ARI greeting → qualification → handover)
  - **Outcome:** Verified — All states handled in buildMouthSystemPrompt, E2E flow complete

### Development Workflow

- [x] **DEV-01**: Agent-skills MCP installed and configured
  - **Outcome:** Skills installed, MCP configured (connection failure non-blocking)

## Future Requirements

Deferred to next milestone.

### Advanced Inbox Features

- **INBOX-07**: Template message support (quick replies)
- **INBOX-08**: Interactive button responses
- **INBOX-09**: Broadcast messaging capability

### Development Workflow

- **DEV-02**: MCP commands documented for team use

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| Complete Kapso Inbox replacement | Using Kapso as UI pattern reference, not wholesale replacement |
| WhatsApp Flows (multi-step forms) | Requires Meta approval, complex setup |
| Voice agent integration | Significant complexity, defer to v4.0+ |
| Multi-user chat assignment | Single workspace user model for now |
| Custom bot training UI | Persona/Flow tabs provide sufficient control |

## Traceability

Which phases cover which requirements. Final status at milestone completion.

| Requirement | Phase | Status | Verification |
|-------------|-------|--------|--------------|
| DEV-01 | 1 | Complete | Gaps Found (MCP connection, non-blocking) |
| INBOX-01 | 4 | Complete | Implementation verified, no formal verification |
| INBOX-02 | 4 | Complete | Implementation verified, no formal verification |
| INBOX-03 | 4 | Complete | Implementation verified, no formal verification |
| INBOX-04 | 5 | Complete | Passed |
| INBOX-05 | 4 | Complete | Implementation verified, no formal verification |
| INBOX-06 | 4 | Complete | Implementation verified, no formal verification |
| INTERN-01 | 2 | Complete | Passed |
| INTERN-02 | Pre-v3.4 | Complete | Pre-existing (v2.2) |
| INTERN-03 | Pre-v3.4 | Complete | Pre-existing (v2.2) |
| INTERN-04 | Pre-v3.4 | Complete | Pre-existing (v2.2) |
| INTERN-05 | Pre-v3.4 | Complete | Pre-existing (v2.2) |
| INTERN-06 | Pre-v3.4 | Complete | Pre-existing (v2.2) |
| INTERN-07 | 3 | Complete | Passed |
| ARI-01 | 6 | Complete | Passed |
| ARI-02 | 5 | Complete | Passed |
| ARI-03 | 6 | Complete | Passed |
| ARI-04 | 6 | Complete | Passed |

**Coverage:**
- v3.4 requirements: 18 total
- Mapped to phases: 18 (100%)
- Completed: 18 (100%)
- Unmapped: 0 ✓

---

## Milestone Summary

**Shipped:** 18 of 18 v3.4 requirements (100%)

**Fully Verified:**
- DEV-01: Agent-skills MCP (gaps found but non-blocking)
- INTERN-01: Your Intern page loads without errors
- INTERN-07: Global AI toggle
- INBOX-04: Real-time message updates
- ARI-01: Automatic AI response for new leads
- ARI-02: AI/Human toggle per conversation
- ARI-03: Config changes reflect in ARI behavior
- ARI-04: Complete E2E flow

**Implementation Verified (No Formal Verification File):**
- INBOX-01, 02, 03, 05, 06: Inbox UI & Filtering (Phase 4)
  - UAT performed (04-inbox-ui-filtering-UAT.md)
  - Integration checker confirmed all wiring working
  - Production-ready, formal verification deferred

**Pre-existing from v2.2:**
- INTERN-02 to INTERN-06: Your Intern configuration tabs
  - All 5 tabs (Persona, Flow, Database, Scoring, Slots) working from v2.2
  - v3.4 added global AI toggle (INTERN-07)

**Requirements Scope Changes:**
- None — all requirements shipped as defined

**Requirements Dropped:**
- None — no requirements removed during milestone

**Tech Debt Accepted:**
- Phase 1: MCP connection failure (non-blocking — skills installed, code works)
- Phase 4: Missing formal verification (non-blocking — UAT performed, integration confirmed)

---

*Archived: 2026-01-28 as part of v3.4 milestone completion*
