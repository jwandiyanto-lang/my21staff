# Milestone v3.2: CRM Core Fresh

**Status:** ✅ SHIPPED 2026-01-25
**Phases:** 1, 1.2, 2, 3, 4, 4.1, 4.2, 5
**Total Plans:** 23

## Overview

Delete Supabase entirely and rebuild core CRM features fresh with Convex. Seamless WhatsApp integration via Kapso.

## Phases

### Phase 1: Supabase Deletion + Database Foundation

**Goal**: Remove all Supabase code, DELETE broken page files, rebuild Contact Database fresh with Convex
**Depends on**: v3.1 complete
**Merged scope**: Original Phase 1 (cleanup) + Phase 2 (database) combined per user decision
**Success Criteria** (what must be TRUE):
  1. ✓ Supabase lib files deleted (server.ts, client.ts, middleware.ts)
  2. ✓ @supabase packages removed from package.json
  3. ✓ Broken pages DELETED from codebase (not just hidden)
  4. ✓ App builds and runs
  5. ✓ Contact Database page works
  6. ✓ Contact detail modal with 4 tabs (Profile, Documents, Conversations, Notes)
  7. → n8n sync verification moved to Phase 1.2
  8. ✓ Merge functionality for duplicate contacts
**Plans**: 4/4 complete

Plans:
- [x] 01-01-PLAN.md — Delete Supabase files + update navigation ✓
- [x] 01-02-PLAN.md — Migrate layout and sidebar to Convex ✓
- [x] 01-03-PLAN.md — Contact detail dialog with 4 tabs ✓
- [x] 01-05-PLAN.md — Contact merge functionality ✓

### Phase 1.2: n8n Sync Verification

**Goal**: Verify n8n sync brings all Google Sheets leads into Contact Database
**Depends on**: Phase 1
**Success Criteria** (what must be TRUE):
  1. ⏸ All Google Sheets leads appear in Contact Database (deferred to deployment)
  2. ✓ n8n webhook creates contacts in Convex
  3. ⏸ Incremental sync works (deferred to deployment)
**Plans**: 1/1 complete

Plans:
- [x] 01-04-PLAN.md — Verify n8n sync (webhook verified, count check deferred)

### Phase 2: Inbox (WhatsApp)

**Goal**: WhatsApp messaging via Kapso, seamless real-time
**Depends on**: Phase 1
**Success Criteria** (what must be TRUE):
  1. ✓ Conversation list shows all chats
  2. ✓ Message thread displays history
  3. ✓ Send message works via Kapso
  4. ✓ Real-time updates via Convex subscriptions
  5. ⏸ Human verification deferred (combined with Phase 1 testing later)
**Plans**: 4/4 complete

Plans:
- [x] 02-01-PLAN.md — Conversation list with filters ✓
- [x] 02-02-PLAN.md — Message thread with date separators ✓
- [x] 02-03-PLAN.md — Send message via Kapso ✓
- [x] 02-04-PLAN.md — Human verification checkpoint (deferred)

### Phase 3: Dashboard

**Goal**: Workspace overview with stats, activity feed, and quick actions
**Depends on**: Phase 2
**Success Criteria** (what must be TRUE):
  1. ✓ Dashboard shows contact/conversation counts
  2. ✓ Recent activity feed works
  3. ✓ Quick actions available
  4. ⏸ Human verification deferred (combined with Phase 1-2 testing later)
**Plans**: 4/4 complete

Plans:
- [x] 03-01-PLAN.md — Convex dashboard queries (getStats, listActivity) ✓
- [x] 03-02-PLAN.md — Dashboard page with stats cards and quick actions ✓
- [x] 03-03-PLAN.md — Activity feed and onboarding checklist ✓
- [x] 03-04-PLAN.md — Human verification checkpoint (deferred)

### Phase 4: Settings

**Goal**: Workspace configuration and team management
**Depends on**: Phase 3
**Success Criteria** (what must be TRUE):
  1. ✓ Workspace settings editable
  2. ✓ Team member list works (via Clerk)
  3. ✓ Integration settings accessible
  4. ⏸ Human verification deferred (combined with Phase 1-3 batch testing)
**Plans**: 2/2 complete

Plans:
- [x] 04-01-PLAN.md — Settings page server component + team link ✓
- [x] 04-02-PLAN.md — Human verification checkpoint (deferred)

### Phase 4.1: UI Revert to v2.0 Style

**Goal**: Restore original v2.0 UI designs while keeping Convex backend
**Depends on**: Phase 4
**Decision**: User requested v2.0 UI (2026-01-25)
**Success Criteria** (what must be TRUE):
  1. ✓ Contact detail uses Sheet (slide from right, not Dialog)
  2. ✓ 3 tabs: Details, Messages, Activity (not 4 tabs)
  3. ✓ Inbox filters use Popover with checkboxes (not chips)
  4. ✓ Message thread displays and send works
**Plans**: 4/4 complete

Plans:
- [x] 01-PLAN.md — Contact Detail Sheet structure ✓
- [x] 02-PLAN.md — Inbox filter revert to popover ✓
- [x] 03-PLAN.md — Inbox message thread ✓
- [x] 04-PLAN.md — Contact Messages & Activity tabs ✓

### Phase 4.2: Inbox Rework (INSERTED)

**Goal**: Fully restore inbox filter bar to v2.0 style
**Depends on**: Phase 4.1
**Type**: Gap closure from UAT
**Success Criteria** (what must be TRUE):
  1. ✓ Active/All toggle with count badge
  2. ✓ Status filter as dropdown button
  3. ✓ Tags filter as dropdown button
  4. ✓ All filters wire to Convex query
**Plans**: 1/1 complete

Plans:
- [x] 04.2-01-PLAN.md — Add v2.0 filter bar (Active/All toggle, Status dropdown, Tags dropdown) ✓

### Phase 5: Polish + Deploy

**Goal**: Local verification with ngrok + Kapso webhooks (Vercel deployment blocked - billing freeze)
**Depends on**: Phase 4.2
**Success Criteria** (what must be TRUE):
  1. ⏸ Full round-trip messaging deferred (ngrok static domain issues, will test in production)
  2. ✓ Environment variables documented and cleaned
  3. ✓ Deployment readiness documented (for when billing resolved)
**Plans**: 3/3 complete

Plans:
- [x] 05-01-PLAN.md — Install ngrok + create tunnel script ✓
- [x] 05-02-PLAN.md — Round-trip webhook testing (local verified, ngrok deferred) ✓
- [x] 05-03-PLAN.md — Environment cleanup + deployment readiness docs ✓

---

## Milestone Summary

**Decimal Phases:**
- Phase 4.1: UI Revert to v2.0 Style (inserted after Phase 4 for user-requested UI changes)
- Phase 4.2: Inbox Rework (inserted after Phase 4.1 for gap closure from UAT)

**Key Decisions:**
- Supabase deletion approach: Delete all files and packages, rebuild fresh with Convex
- Contact detail as Dialog initially, then reverted to Sheet (v2.0 style)
- 4-tab to 3-tab layout for contact details
- Inbox filters as chips/badges, then reverted to popover with checkboxes (v2.0 style)
- Webhook testing deferred to production (ngrok connectivity issues)

**Issues Resolved:**
- Supabase completely removed from codebase
- Contact Database rebuilt with real-time updates
- WhatsApp Inbox restored with v2.0 UI patterns
- Dashboard with stats and activity feed working
- Settings with Clerk team management working

**Issues Deferred:**
- Webhook E2E testing (to production deployment)
- n8n sync count verification (to production deployment)

**Technical Debt Incurred:**
- None significant — clean rebuild with established patterns

---

_For current project status, see .planning/ROADMAP.md (will be created for next milestone)_

---
*Archived: 2026-01-25 as part of v3.2 milestone completion*
