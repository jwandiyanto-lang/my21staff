# Requirements Archive: v2.0.1 Workflow Integration & Lead Automation

**Archived:** 2026-02-03
**Status:** ✅ SHIPPED

This is the archived requirements specification for v2.0.1.
For current requirements, see `.planning/REQUIREMENTS.md` (will be created for next milestone).

---

# Requirements: my21staff v2.0.1

**Defined:** 2026-02-01
**Core Value:** The system that lets you grow — lead management, proposal organization, follow-up automation powered by dual-agent AI.

## v2.0.1 Requirements

Requirements for fixing Sarah bot and implementing smart lead automation.

### Sarah Bot Improvements

- [x] **SARAH-01**: Fix persona/response style (conversational tone, message length, emoji usage) — **✓ VALIDATED v2.0.1**
- [x] **SARAH-02**: Improve handoff logic (when to escalate to human, handoff triggers) — **✓ VALIDATED v2.0.1**
- [x] **SARAH-03**: Refine field extraction (what data to collect, validation rules) — **✓ VALIDATED v2.0.1**
- [x] **SARAH-04**: Document current Sarah configuration as reusable template — **✓ VALIDATED v2.0.1**
- [x] **SARAH-05**: Enable bot duplication for new workspaces (clone Sarah config) — **✓ VALIDATED v2.0.1**

### Lead Automation

- [x] **LEAD-01**: Create lead on first message from new contact (webhook-triggered) — **⚠️ DISABLED** (User requested manual entry only)
- [x] **LEAD-02**: Update lead lastActivityAt on subsequent messages (no new lead) — **✓ VALIDATED v2.0.1**
- [x] **LEAD-03**: Deduplicate contacts by normalized phone number (E.164 format) — **✓ VALIDATED v2.0.1**
- [x] **LEAD-04**: Track lead activity timestamps for follow-up prioritization — **✓ VALIDATED v2.0.1**
- [x] **LEAD-05**: Link leads to Kapso conversations via conversation_id — **✓ VALIDATED v2.0.1**

### Data Integrity

- [x] **DATA-01**: Phone number normalization to E.164 before storage — **✓ VALIDATED v2.0.1**
- [x] **DATA-02**: Webhook idempotency tracking to prevent duplicates — **✓ VALIDATED v2.0.1**
- [x] **DATA-03**: Prevent orphaned leads (all leads linked to valid workspace) — **✓ VALIDATED v2.0.1**

### Production Testing

- [x] **TEST-01**: Sarah bot changes testable via live WhatsApp messaging — **✓ VALIDATED v2.0.1**
- [x] **TEST-02**: Lead creation verifiable in dashboard immediately — **⚠️ DISABLED** (Follows from LEAD-01 disabled)
- [x] **TEST-03**: All changes deployable to production incrementally (no big bang) — **✓ VALIDATED v2.0.1**

## Future Requirements

Deferred to v2.1+.

### Workflow Automation

- **AUTO-01**: Daily activity summaries as lead notes
- **AUTO-02**: Automatic lead scoring based on Sarah interactions
- **AUTO-03**: Sync workflow config to Kapso Dashboard (manual copy-paste for now)

### Advanced Lead Management

- **ADV-01**: Lead qualification threshold (ignore spam messages)
- **ADV-02**: Multi-workspace timezone handling for cron jobs
- **ADV-03**: Bulk lead import from CSV

## Out of Scope

Explicitly excluded for v2.0.1.

| Feature | Reason |
|---------|--------|
| Direct Kapso workflow editing via API | Kapso API does not provide workflow editing endpoints |
| Automatic CRM → Kapso sync | Not possible without workflow API access |
| Visual workflow builder | Too complex for SME users, creates analysis paralysis |
| Real-time workflow editing | Risk of breaking active conversations |
| Custom JavaScript in workflows | Security risk, maintainability issues |

## Traceability

Which phases cover which requirements.

| Requirement | Phase | Status |
|-------------|-------|--------|
| SARAH-01 | Phase 10 | ✓ Validated |
| SARAH-02 | Phase 10 | ✓ Validated |
| SARAH-03 | Phase 10 | ✓ Validated |
| SARAH-04 | Phase 12 | ✓ Validated |
| SARAH-05 | Phase 12 | ✓ Validated |
| LEAD-01 | Phase 11 | ⚠️ Disabled (user decision) |
| LEAD-02 | Phase 11 | ✓ Validated |
| LEAD-03 | Phase 11 | ✓ Validated |
| LEAD-04 | Phase 11 | ✓ Validated |
| LEAD-05 | Phase 11 | ✓ Validated |
| DATA-01 | Phase 11 | ✓ Validated |
| DATA-02 | Phase 11 | ✓ Validated |
| DATA-03 | Phase 11 | ✓ Validated |
| TEST-01 | Phase 10 | ✓ Validated |
| TEST-02 | Phase 13 | ⚠️ Disabled (user decision) |
| TEST-03 | Phase 13 | ✓ Validated |

**Coverage:**
- v2.0.1 requirements: 16 total
- Validated: 13 (81%)
- Disabled (user decision): 3 (19%)
- Dropped: 0

---

## Milestone Summary

**Shipped:** 13 of 16 v2.0.1 requirements (81%)

**Validated Requirements:**
All requirements marked ✓ VALIDATED above were successfully implemented, tested, and deployed to production.

**Disabled Requirements:**
- **LEAD-01** (Auto lead creation): User requested manual entry only via "Add Contact" button. Environment flag `DISABLE_AUTO_LEAD_CREATION=true` implemented.
- **TEST-02** (Lead creation verification): Directly depends on LEAD-01, disabled as consequence.

These represent valid product decisions, not technical failures.

**Adjusted During Implementation:**
- **Phase 11.1** (Lead Redo) inserted for quick iterative fixes based on user feedback
- **Phase 12** UI simplified from 4-field to 3-field settings (Bot Name, Persona, Script)
- **Phase 13** Your Team tab removed from UI (backend intact for future use)

**Dropped:** None

**Future Work Deferred:**
- Workflow Automation (AUTO-01, AUTO-02, AUTO-03)
- Advanced Lead Management (ADV-01, ADV-02, ADV-03)

**Tech Debt Carried Forward:**
- Sarah prompt deployment verification (external Kapso service limitation)
- Orphaned SarahConfigCard component (282 lines, consider removing)
- Outdated SARAH-TEMPLATE.md documentation (needs 3-field update)
- Cosmetic Clerk "Forbidden" error flash during onboarding

---

*Archived: 2026-02-03 as part of v2.0.1 milestone completion*
*Requirements defined: 2026-02-01*
*Last updated: 2026-02-03 after milestone completion*
