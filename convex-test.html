<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Convex Performance Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
    }
    .result {
      padding: 20px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .pass { background: #dcfce7; color: #166534; }
    .fail { background: #fee2e2; color: #991b1b; }
    .time { font-family: monospace; font-size: 14px; }
  </style>
</head>
<body>
  <h1>Convex Performance Test</h1>
  <p>Tests Convex HTTP endpoint for contact lookup</p>

  <div id="config">
    <h2>Configuration</h2>
    <label>
      CRM API Key:
      <input type="password" id="apiKey" value="" size="40" />
    </label>
    <br><br>
    <label>
      Workspace ID:
      <input type="text" id="workspaceId" value="25de3c4e-b9ca-4aff-9639-b35668f0a48e" size="40" />
    </label>
    <br><br>
    <label>
      Phone:
      <input type="text" id="phone" value="6281234567890" size="20" />
    </label>
    <br><br>
    <button onclick="runTest()">Run Test</button>
  </div>

  <div id="output"></div>

  <script>
    const API_URL = "https://intent-otter-212.convex.cloud";

    async function runTest() {
      const apiKey = document.getElementById('apiKey').value;
      const workspaceId = document.getElementById('workspaceId').value;
      const phone = document.getElementById('phone').value;
      const output = document.getElementById('output');

      if (!apiKey) {
        output.innerHTML = '<div class="result fail">Error: Please enter API key</div>';
        return;
      }

      output.innerHTML = '<div class="result">Running...</div>';

      const startTime = performance.now();
      try {
        const response = await fetch(`${API_URL}/http/contacts/getByPhone?phone=${phone}&workspace_id=${workspaceId}`, {
          method: 'GET',
          headers: {
            'x-api-key': apiKey
          }
        });

        const data = await response.json();
        const duration = (performance.now() - startTime).toFixed(0);
        const statusClass = data.found === false ? 'fail' : 'pass';

        output.innerHTML = `
          <div class="result ${statusClass}">
            <h3>Result: ${data.found ? 'Contact Found' : 'Not Found'}</h3>
            <p>Status: ${response.status}</p>
            <p>Duration: <span class="time">${duration}ms</span></p>
            ${data.found ? `
              <p>Name: ${data.contact?.name || 'N/A'}</p>
              <p>Status: ${data.contact?.leadStatus || 'N/A'}</p>
              <p>Score: ${data.contact?.leadScore || 'N/A'}</p>
            ` : ''}
          </div>
        `;
      } catch (e) {
        const duration = (performance.now() - startTime).toFixed(0);
        output.innerHTML = `
          <div class="result fail">
            <h3>Error</h3>
            <p>Duration: <span class="time">${duration}ms</span></p>
            <p>${e.message}</p>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
