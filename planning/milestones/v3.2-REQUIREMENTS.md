# Requirements Archive: v3.2 CRM Core Fresh

**Archived:** 2026-01-25
**Status:** ✅ SHIPPED

This is the archived requirements specification for v3.2.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: my21staff v3.1 + v3.2

**Defined:** 2026-01-23
**Completed:** 2026-01-25
**Core Value:** The system that lets you grow

## v3.1 Requirements (All Complete)

Requirements for Full Convex + Clerk migration. Remove Supabase entirely.

### Auth Infrastructure

- [x] **AUTH-01**: Clerk application configured with JWT template for Convex
- [x] **AUTH-02**: Convex auth.config.ts updated for Clerk JWT validation
- [x] **AUTH-03**: ConvexProviderWithClerk replaces Supabase provider
- [x] **AUTH-04**: clerkMiddleware replaces Supabase middleware for route protection

### User Migration

- [x] **USER-01**: Users table in Convex with Clerk ID as primary identifier
- [x] **USER-02**: Clerk webhook syncs user creation/updates to Convex
- [x] **USER-03**: Existing Supabase users imported to Clerk with password hashes
- [x] **USER-04**: User ID mapping preserves data relationships (Supabase UUID → Clerk ID)

### Auth UI

- [x] **UI-01**: Clerk SignIn component replaces custom login form
- [x] **UI-02**: Clerk SignUp component replaces custom signup form
- [x] **UI-03**: Clerk UserButton replaces custom profile menu
- [x] **UI-04**: Password reset works via Clerk (fixes broken Supabase flow)

### Organization/Workspace

- [x] **ORG-01**: Clerk organizations created for existing workspaces
- [x] **ORG-02**: Clerk organization invitations replace custom invitation system
- [x] **ORG-03**: Role-based permissions work with Clerk organization roles

### Data Migration

- [x] **DATA-01**: ARI tables migrated to Convex (7 tables: config, sessions, scores, slots, etc.)
- [x] **DATA-02**: Support ticket tables migrated to Convex
- [x] **DATA-03**: CMS tables migrated to Convex (articles, webinars)
- [x] **DATA-04**: Utility tables migrated to Convex (profiles, appointments)
- [x] **DATA-05**: All API routes updated to use Convex instead of Supabase

### n8n Integration

- [x] **N8N-01**: Convex HTTP action created for n8n lead webhook
- [x] **N8N-02**: n8n workflow updated to use new Convex webhook URL
- [x] **N8N-03**: Eagle Overseas lead flow verified working

### Cleanup (Completed in v3.2)

- [x] **CLEAN-01**: Supabase client code removed — v3.2 Phase 1
- [x] **CLEAN-02**: Supabase environment variables removed — v3.2 Phase 5
- [x] **CLEAN-03**: @supabase packages removed from dependencies — v3.2 Phase 1

## v3.2 Additional Requirements (Implicit)

### CRM Rebuild

- [x] **CRM-01**: Contact Database with real-time updates
- [x] **CRM-02**: Contact merge functionality
- [x] **CRM-03**: WhatsApp Inbox with conversation list
- [x] **CRM-04**: Message thread with send functionality
- [x] **CRM-05**: Dashboard with stats and activity feed
- [x] **CRM-06**: Settings with team management link

### UI Polish

- [x] **UI-05**: Contact detail as Sheet (v2.0 style)
- [x] **UI-06**: 3-tab contact detail (Details, Messages, Activity)
- [x] **UI-07**: Inbox filters as popover with checkboxes (v2.0 style)
- [x] **UI-08**: Filter bar with Active/All toggle, Status dropdown, Tags dropdown

## Future Requirements

Deferred to v4.0 or later.

### Payments

- **PAY-01**: Midtrans payment integration
- **PAY-02**: Subscription management

### AI Enhancement

- **AI-01**: AI model selection UI
- **AI-02**: Custom model configuration per workspace

## Out of Scope

| Feature | Reason |
|---------|--------|
| Clerk custom permissions | Requires B2B SaaS add-on ($100/month) — use role-based checks |
| Multi-organization users | Complex, not needed for current clients |
| Social login (Google, etc.) | Email/password sufficient for Indonesian SME market |
| Supabase data archival | Delete after migration verified, no need to preserve |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| AUTH-01 | v3.1-1 | Complete |
| AUTH-02 | v3.1-1 | Complete |
| AUTH-03 | v3.1-2 | Complete |
| AUTH-04 | v3.1-2 | Complete |
| UI-01 | v3.1-2 | Complete |
| UI-02 | v3.1-2 | Complete |
| UI-03 | v3.1-2 | Complete |
| UI-04 | v3.1-2 | Complete |
| USER-01 | v3.1-3 | Complete |
| USER-02 | v3.1-3 | Complete |
| USER-03 | v3.1-4 | Complete |
| USER-04 | v3.1-4 | Complete |
| ORG-01 | v3.1-4 | Complete |
| ORG-02 | v3.1-4 | Complete |
| ORG-03 | v3.1-4 | Complete |
| DATA-01 | v3.1-5 | Complete |
| DATA-02 | v3.1-5 | Complete |
| DATA-03 | v3.1-5 | Complete |
| DATA-04 | v3.1-5 | Complete |
| DATA-05 | v3.1-5 | Complete |
| N8N-01 | v3.1-6 | Complete |
| N8N-02 | v3.1-6 | Complete |
| N8N-03 | v3.1-6 | Complete |
| CLEAN-01 | v3.2-1 | Complete |
| CLEAN-02 | v3.2-5 | Complete |
| CLEAN-03 | v3.2-1 | Complete |
| CRM-01 | v3.2-1 | Complete |
| CRM-02 | v3.2-1 | Complete |
| CRM-03 | v3.2-2 | Complete |
| CRM-04 | v3.2-2 | Complete |
| CRM-05 | v3.2-3 | Complete |
| CRM-06 | v3.2-4 | Complete |
| UI-05 | v3.2-4.1 | Complete |
| UI-06 | v3.2-4.1 | Complete |
| UI-07 | v3.2-4.1 | Complete |
| UI-08 | v3.2-4.2 | Complete |

**Coverage:**
- v3.1 requirements: 26 total, 26 complete
- v3.2 requirements: 11 total, 11 complete
- Total: 37 requirements shipped

---

## Milestone Summary

**Shipped:** 37 of 37 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-01-25 as part of v3.2 milestone completion*
