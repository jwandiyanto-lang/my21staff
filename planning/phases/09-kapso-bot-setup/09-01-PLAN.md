---
phase: 09-kapso-bot-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Ari bot responds to WhatsApp messages on Eagle's number"
    - "Ari greets known contacts by name from CRM"
    - "Ari uses correct persona (saya/kamu, no emojis, 1-2 sentences)"
    - "Ari mirrors customer language (English/Bahasa)"
    - "Ari hands over on trigger words (harga, booking, kecewa)"
  artifacts:
    - path: "Kapso sea-lion-reply function"
      provides: "AI response logic with CRM integration"
      location: "https://app.kapso.ai/projects/2bdca4dd-e230-4a1a-8639-68f8595defa8/functions"
  key_links:
    - from: "Kapso sea-lion-reply"
      to: "https://www.my21staff.com/api/contacts/by-phone"
      via: "HTTP fetch with X-API-Key header"
      pattern: "CRM_API_URL + CRM_API_KEY + WORKSPACE_ID"
---

<objective>
Deploy Ari persona to Kapso and verify end-to-end WhatsApp bot functionality

Purpose: Complete the final step of Phase 9 â€” getting Ari working on Eagle's WhatsApp so their leads receive AI-powered responses with CRM context.

Output: Working Ari bot responding to WhatsApp messages with personalized greetings, correct persona, and proper handover triggers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-kapso-bot-setup/09-CONTEXT.md
@.planning/phases/09-kapso-bot-setup/SETUP-NOTES.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Deploy sea-lion-reply Function to Kapso</name>
  <action>
    This task requires browser access to Kapso dashboard. Claude cannot perform this.

    **Step 1: Navigate to Kapso Functions**
    - Open: https://app.kapso.ai/projects/2bdca4dd-e230-4a1a-8639-68f8595defa8/functions
    - Click "Edit" on the `sea-lion-reply` function

    **Step 2: Replace Code (Code tab)**
    - Copy the complete JavaScript code from SETUP-NOTES.md section "2. Replace Code"
    - Paste into the function editor, replacing existing code

    **Step 3: Add Secrets (Secrets tab)**
    - Verify `SEALION_API_KEY` exists (should already be there)
    - Add `CRM_API_URL`: `https://www.my21staff.com`
    - Add `CRM_API_KEY`: (value from SETUP-NOTES.md)
    - Add `WORKSPACE_ID`: `25de3c4e-b9ca-4aff-9639-b35668f0a48e`

    **Step 4: Save & Deploy**
    - Click Save/Deploy button
    - Wait for deployment confirmation
  </action>
  <verify>
    - Kapso shows function deployed successfully
    - All 4 secrets are configured (SEALION_API_KEY, CRM_API_URL, CRM_API_KEY, WORKSPACE_ID)
  </verify>
  <done>Function deployed to Kapso with updated code and all secrets configured</done>
  <resume-signal>Type "deployed" when Kapso function is live</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify Ari Bot via WhatsApp</name>
  <what-built>
    Ari bot with CRM integration:
    - Time-appropriate greetings (pagi/siang/sore/malam)
    - Personalized greetings for known CRM contacts
    - Casual persona (saya/kamu, no emojis, 1-2 sentences)
    - Language mirroring (English/Bahasa)
    - Handover triggers for sales/complaints
  </what-built>
  <how-to-verify>
    **Use only Jonathan Fransisco's WhatsApp number for testing.**

    Send messages to Eagle's WhatsApp number and verify responses:

    **1. Basic Response Check**
    - Send: "halo"
    - Expected: Time-appropriate greeting ("pagi/siang/sore/malam kak")
    - Check: Uses saya/kamu pronouns
    - Check: Response is 1-2 sentences
    - Check: NO emojis in response

    **2. CRM Integration Check**
    - If your contact exists in CRM with name:
      - Expected: "pagi kak [your name]"
    - If new contact:
      - Expected: "pagi kak" (generic)

    **3. Language Mirroring Check**
    - Send: "Hi, I want to study abroad"
    - Expected: Ari responds in English
    - Send: "Mau kuliah di luar negeri"
    - Expected: Ari responds in Bahasa

    **4. Handover Trigger Check**
    Test each trigger word:
    - Send: "berapa harga konsultasi?"
    - Expected: Handover response ("saya connect-kan ke tim kita ya")
    - Send: "mau booking jadwal"
    - Expected: Handover response
    - Send: "saya kecewa dengan pelayanan"
    - Expected: Handover response

    **5. Conversation Flow Check**
    - Verify Ari asks questions one at a time
    - Verify flow follows: intro -> documents -> closing
  </how-to-verify>
  <resume-signal>
    Type "verified" if all checks pass.
    If issues found, describe what failed (e.g., "CRM name not showing" or "emoji in response").
  </resume-signal>
</task>

</tasks>

<verification>
All must_haves validated through manual WhatsApp testing:
- Ari responds on Eagle's number
- Known contacts get personalized greeting
- Persona is correct (saya/kamu, no emojis, short)
- Language mirroring works
- Handover triggers function
</verification>

<success_criteria>
Phase 9 complete when:
- Kapso function deployed with all secrets
- All 5 verification checks pass via WhatsApp
- First client (Eagle) has working AI bot
</success_criteria>

<output>
After completion, create `.planning/phases/09-kapso-bot-setup/09-01-SUMMARY.md`
</output>
