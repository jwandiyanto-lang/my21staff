---
phase: 05-polish-deploy
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - .env.example
  - planning/phases/05-polish-deploy/DEPLOYMENT-READY.md
autonomous: true
model: sonnet

must_haves:
  truths:
    - "Environment variables documented and cleaned"
    - "Deployment readiness checklist complete"
    - "v3.2 CRM verified ready for production (when billing resolved)"
  artifacts:
    - path: ".env.example"
      provides: "Clean environment variable template"
      min_lines: 10
    - path: "planning/phases/05-polish-deploy/DEPLOYMENT-READY.md"
      provides: "Deployment readiness documentation"
      min_lines: 30
  key_links: []
---

<objective>
Clean up environment variables and document deployment readiness for v3.2 CRM.

Purpose: Prepare for future production deployment when Vercel billing is resolved.
Output: Clean .env.example, deployment readiness documentation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@planning/phases/05-polish-deploy/05-02-SUMMARY.md (webhook testing results)
@.env.local (current environment variables - DO NOT COMMIT)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and clean environment variables</name>
  <files>.env.example</files>
  <action>
    1. Read .env.local to understand current env vars
    2. Identify which are still needed for v3.2:
       - Convex: NEXT_PUBLIC_CONVEX_URL, CONVEX_DEPLOY_KEY
       - Clerk: NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY
       - Kapso: KAPSO_API_KEY, KAPSO_WEBHOOK_SECRET, NEXT_PUBLIC_KAPSO_PHONE_NUMBER
       - Encryption: ENCRYPTION_KEY
       - Resend: RESEND_API_KEY
       - AI: GROK_API_KEY, OLLAMA_BASE_URL
    3. Identify which can be removed (old Supabase vars):
       - SUPABASE_* vars (if any remain)
       - NEXT_PUBLIC_SUPABASE_* vars
    4. Update .env.example with:
       - Only needed variables
       - Clear comments explaining each
       - Grouped by service (Convex, Clerk, Kapso, etc.)

    DO NOT modify .env.local - only update .env.example as template.
  </action>
  <verify>
    - .env.example has only needed variables
    - Each variable has comment explaining purpose
    - No Supabase-related variables remain in template
  </verify>
  <done>.env.example is clean and documented</done>
</task>

<task type="auto">
  <name>Task 2: Create deployment readiness documentation</name>
  <files>planning/phases/05-polish-deploy/DEPLOYMENT-READY.md</files>
  <action>
    Create a deployment readiness document with:

    ## v3.2 CRM Deployment Readiness

    ### Verification Status
    - [ ] Contact Database - working
    - [ ] Contact Detail Sheet - working
    - [ ] Inbox Conversations - working
    - [ ] Message Thread - working
    - [ ] Send Message - working (verified via ngrok test)
    - [ ] Receive Message - working (verified via ngrok test)
    - [ ] Dashboard Stats - working
    - [ ] Settings Page - working
    - [ ] Inbox Filters - working (v2.0 filter bar)

    ### Blocking Issues
    - Vercel deployment blocked (billing freeze per CLAUDE.md)

    ### When Ready to Deploy
    1. Resolve Vercel billing or create fresh project
    2. Set environment variables in Vercel dashboard
    3. Deploy and verify in production
    4. Update Kapso webhook URL to production

    ### Environment Variables Required
    (List from .env.example)

    ### Post-Deployment Checklist
    1. Verify auth flow (sign in/sign out)
    2. Verify inbox loads conversations
    3. Test send/receive one message
    4. Check Convex dashboard for errors

    Include results from Plan 02 webhook testing.
  </action>
  <verify>
    - File exists with all sections
    - Webhook test results included
    - Blocking issues clearly stated
  </verify>
  <done>Deployment readiness documentation complete</done>
</task>

</tasks>

<verification>
1. .env.example is clean (no Supabase vars, all needed vars documented)
2. DEPLOYMENT-READY.md exists with verification status and blocking issues
3. Phase 5 completes v3.2 CRM milestone (local verification complete)
</verification>

<success_criteria>
- .env.example updated with only needed variables
- Deployment readiness documented
- Clear record of what's blocking deployment
- v3.2 CRM ready for production when billing resolved
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish-deploy/05-03-SUMMARY.md`
</output>
