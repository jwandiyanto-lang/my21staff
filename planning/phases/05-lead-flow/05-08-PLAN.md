---
phase: 05-lead-flow
plan: 08
type: execute
wave: 3
depends_on: ["05-07"]
files_modified: []
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Brain assigns statuses that display correctly in UI"
    - "Custom status configuration persists and affects Brain behavior"
    - "DELETE contact endpoint removes contacts from database"
    - "PATCH contact endpoint updates phone field"
  artifacts: []
  key_links:
    - from: "Brain analysis"
      to: "UI status display"
      via: "workspace status config"
      pattern: "status matches config key"
---

<objective>
Verify the complete status configuration system and deferred CRUD endpoints.

Purpose: Ensure the gap closure is complete - Brain outputs align with UI display, and previously implemented but untested DELETE/PATCH endpoints work correctly.

Output:
- Verified status mismatch is resolved
- Verified DELETE and PATCH endpoints work in UI
- Human confirmation of functionality
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@planning/PROJECT.md
@planning/ROADMAP.md
@planning/STATE.md
@planning/phases/05-lead-flow/05-06-PLAN.md
@planning/phases/05-lead-flow/05-07-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify Brain-to-UI status alignment</name>
  <files></files>
  <action>
Test the status alignment by checking the database and UI:

1. Query a contact that has been analyzed by Brain:
```bash
# In Convex dashboard, run a query to find a contact with lead_status set by Brain
# Look for contacts with lead_status = "hot", "warm", or "cold"
```

2. Check that the status key matches the workspace configuration:
- Default config has keys: "new", "cold", "warm", "hot", "client", "lost"
- Brain should now set status to these keys
- UI should display the corresponding labels: "New", "Cold Lead", "Warm Lead", "Hot Lead", etc.

3. If Brain has already processed contacts with old status values ("hot" without config lookup), they should still display correctly since the default config includes those keys.

Document the findings for the checkpoint.
  </action>
  <verify>
Check Convex dashboard for contacts with lead_status values. Verify they match keys in the default/workspace status configuration.
  </verify>
  <done>
- Contact lead_status values match workspace config keys
- Brain correctly uses getWorkspaceStatusConfig before mapping
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete status configuration system:
1. Workspace-level status configuration (Schema + Convex mutations)
2. Brain reads workspace config for temperature-to-status mapping
3. Settings UI for managing lead stages
4. DELETE /api/contacts/[id] endpoint
5. PATCH phone field support in /api/contacts/[id]
  </what-built>
  <how-to-verify>
**Part A: Status Configuration**
1. Go to Settings > Lead Stages tab
2. Verify default stages are shown (New, Cold Lead, Warm Lead, Hot Lead, Client, Lost)
3. Add a new stage: "Qualified" with temperature "warm"
4. Edit "Warm Lead" stage - change label to "Interested"
5. Verify changes persist after page refresh
6. Go to Database page
7. Verify contacts show correct status labels (not "Prospect" for everything)

**Part B: Contact CRUD (deferred from 05-05)**
8. Go to Database page, click on any contact
9. In the contact detail sheet, try editing the phone number
10. Verify phone update saves (close and reopen to confirm)
11. Click the delete button for a test contact
12. Confirm deletion removes the contact from the list

**Part C: Brain Integration (if live)**
13. If Kapso webhook is active, send a test WhatsApp message
14. Wait for Brain to analyze the conversation
15. Check that the contact's status is updated to a valid stage key
16. Verify the status displays correctly in the UI
  </how-to-verify>
  <resume-signal>
Type "approved" if all verifications pass, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Human verification checkpoint covers:
- Status configuration UI works
- Status values align between Brain and UI
- DELETE endpoint works
- PATCH phone field works
</verification>

<success_criteria>
- [ ] Settings > Lead Stages tab shows and manages stages
- [ ] Contact statuses display correctly (not defaulting to "Prospect")
- [ ] DELETE contact works from contact detail sheet
- [ ] PATCH phone update works
- [ ] Human approval received
</success_criteria>

<output>
After completion, create `planning/phases/05-lead-flow/05-08-SUMMARY.md`
</output>
