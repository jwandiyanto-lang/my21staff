---
phase: 05-lead-flow
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Lead status can be updated from 'new' to 'qualified'"
    - "Lead status can be updated to 'consultation' or 'community'"
    - "Status changes persist and display correctly in UI"
  artifacts:
    - path: "convex/contacts.ts"
      provides: "updateContact mutation for status changes"
      exports: ["updateContact"]
    - path: "convex/ai/brain.ts"
      provides: "updateContactStatus helper for bot workflow"
      exports: ["updateContactStatus"]
  key_links:
    - from: "Brain analysis"
      to: "updateContactStatus"
      via: "ctx.runMutation"
      pattern: "runMutation.*updateContactStatus"
    - from: "updateContactStatus"
      to: "contacts table"
      via: "ctx.db.patch"
      pattern: "db\\.patch.*lead_status"
---

<objective>
Verify lead status updates work through the CRM workflow

Purpose: Confirm LEAD-03 requirement — Lead status updates work (new → qualified → consultation/community)
Output: Documented verification of complete status update flow
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@planning/PROJECT.md
@planning/ROADMAP.md
@planning/phases/05-lead-flow/05-RESEARCH.md
@planning/phases/05-lead-flow/05-02-SUMMARY.md
@convex/contacts.ts
@convex/ai/brain.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify status update via admin mutation</name>
  <files>N/A (no files modified - verification only)</files>
  <action>
Use the Convex dashboard to manually update a test contact's status and verify it persists:

1. Open Convex Dashboard: https://dashboard.convex.dev
2. Select "intent-otter-212" deployment
3. Go to "Functions" tab
4. Find `contacts:updateContact` mutation

Run the mutation with test data:
```json
{
  "contactId": "<contact_id from Plan 02>",
  "lead_status": "qualified"
}
```

Expected result:
- Mutation completes successfully
- Contact's lead_status field updates to "qualified"
- updated_at timestamp changes

Then verify in Data tab:
- Find the contact by ID
- Confirm lead_status is now "qualified"

Document the contact_id used and the result.
  </action>
  <verify>
Mutation returns successfully and contact's lead_status changes to "qualified" in database
  </verify>
  <done>
Status update from "new" to "qualified" works via direct mutation
  </done>
</task>

<task type="auto">
  <name>Task 2: Test status workflow transitions</name>
  <files>N/A (no files modified - verification only)</files>
  <action>
Test the complete status workflow by updating the same contact through all relevant states:

1. Update to "consultation" status:
   - Use Convex dashboard Functions tab
   - Run `contacts:updateContact` with:
     ```json
     {
       "contactId": "<same contact_id>",
       "lead_status": "consultation"
     }
     ```
   - Verify in Data tab: lead_status = "consultation"

2. For a different test contact, update to "community" status:
   - Use a contact from Phone Format Tests (e.g., "Local Format Test")
   - Run `contacts:updateContact` with:
     ```json
     {
       "contactId": "<different contact_id>",
       "lead_status": "community"
     }
     ```
   - Verify in Data tab: lead_status = "community"

3. Verify Brain's updateContactStatus function signature:
   - Go to Functions tab
   - Find `ai/brain:updateContactStatus`
   - Verify it accepts: contactId, leadScore (optional), leadStatus
   - This is the function called by the Bot Workflow (Phase 4)

Document all status transitions and their results.
  </action>
  <verify>
All status transitions (new → qualified → consultation/community) complete successfully
  </verify>
  <done>
Status workflow supports all required transitions: new, qualified, consultation, community
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Lead status update verification</what-built>
  <how-to-verify>
1. Open Contact Database:
   - Go to https://my21staff.com/eagle-overseas/database

2. Find the test contacts:
   - "Test Lead Phase5" (or whichever was updated to "consultation")
   - "Local Format Test" (or whichever was updated to "community")

3. Verify status displays correctly:
   - Check the Status column/badge in the contact list
   - "consultation" should show (possibly as "Consultation" or a hot/warm indicator)
   - "community" should show (possibly as "Community" or a nurture indicator)

4. Test status filter (if available):
   - Filter by status = "consultation"
   - Verify only contacts with that status appear
   - Filter by status = "community"
   - Verify only contacts with that status appear

5. Verify real bot workflow integration:
   - Check if any contacts have been updated by the Bot Workflow (Phase 4)
   - Look for contacts with lead_score > 0 and status != "new"
   - These would have been updated by Brain during conversation

Optional - Simulate bot flow:
   - Send a WhatsApp message to the Eagle number
   - Go through qualification questions
   - Check if lead_status updates automatically
  </how-to-verify>
  <resume-signal>Type "approved" if status updates display correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] Manual status update to "qualified" works
- [ ] Manual status update to "consultation" works
- [ ] Manual status update to "community" works
- [ ] Status changes persist in database
- [ ] Status displays correctly in Contact Database UI
- [ ] Status filter works (if implemented)
- [ ] Brain's updateContactStatus function available for bot workflow
</verification>

<success_criteria>
LEAD-03 is verified when:
1. Status can be updated from "new" to "qualified"
2. Status can be updated to "consultation" (hot lead path)
3. Status can be updated to "community" (free path)
4. Status changes persist and display in UI
5. updateContactStatus function is available for Bot Workflow integration
</success_criteria>

<output>
After completion, create `planning/phases/05-lead-flow/05-03-SUMMARY.md`
</output>
