---
phase: 06-admin-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/[workspace]/knowledge-base/knowledge-base-client.tsx
  - src/components/knowledge-base/persona-tab.tsx
  - src/app/api/workspaces/[workspaceId]/ari-config/route.ts
  - src/components/workspace/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view current persona settings (name, tone, greeting)"
    - "Admin can edit and save persona settings"
    - "Saved settings persist and load on page refresh"
    - "Community link is configurable for cold lead routing"
  artifacts:
    - path: "src/components/knowledge-base/persona-tab.tsx"
      provides: "Persona settings form component"
      exports: ["PersonaTab"]
    - path: "src/app/api/workspaces/[workspaceId]/ari-config/route.ts"
      provides: "ARI config CRUD API"
      exports: ["GET", "PUT"]
  key_links:
    - from: "persona-tab.tsx"
      to: "/api/workspaces/[workspaceId]/ari-config"
      via: "fetch for GET/PUT"
      pattern: "fetch.*ari-config"
---

<objective>
Create the Persona tab for ARI configuration settings.

Purpose: Workspace owners can customize their intern's name, communication tone, greeting template, and community link for cold leads. This fulfills ADMIN-01 through ADMIN-05.

Output: PersonaTab component + API route for ari_config CRUD.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-admin-interface/06-CONTEXT.md

# Existing files to reference
@src/app/(dashboard)/[workspace]/knowledge-base/knowledge-base-client.tsx
@src/lib/ari/types.ts (ARIConfig, ARITone types)
@supabase/migrations/34_ari_tables.sql (ari_config schema)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ARI Config API Route</name>
  <files>src/app/api/workspaces/[workspaceId]/ari-config/route.ts</files>
  <action>
Create API route for ari_config CRUD operations:

**GET /api/workspaces/[workspaceId]/ari-config**
- Fetch existing config or return defaults if none exists
- Default values: bot_name="ARI", greeting_style="professional", language="id", tone={supportive:true, clear:true, encouraging:true}, community_link=null

**PUT /api/workspaces/[workspaceId]/ari-config**
- Upsert config (insert if not exists, update if exists)
- Accept body: { bot_name, tone_description, greeting_template, community_link }
- Store tone_description in the tone JSONB field as { description: string }
- Validate: bot_name required, max 100 chars; tone_description max 500 chars

Use service role key for database operations (same pattern as slots API).
Return { config } on success, { error } on failure.
  </action>
  <verify>
curl commands or API testing:
- GET returns default config when none exists
- PUT creates new config, subsequent GET returns it
- PUT updates existing config
  </verify>
  <done>
API supports GET (with defaults) and PUT (upsert) for ari_config table.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PersonaTab Component</name>
  <files>src/components/knowledge-base/persona-tab.tsx</files>
  <action>
Create PersonaTab component with form fields:

**Fields:**
1. "Your Intern's Name" - Input, default "ARI", max 100 chars
2. "Tone Description" - Textarea, placeholder "e.g., Friendly and supportive, explains clearly...", max 500 chars
3. "Greeting Template" - Textarea, placeholder "e.g., Selamat {waktu}! Saya {nama}, asisten...", max 500 chars
4. "Community Link" - Input (URL), placeholder "https://chat.whatsapp.com/...", optional

**State:**
- Load existing config on mount via GET API
- Track dirty state (hasChanges)
- Submit via PUT API

**UI:**
- Use shadcn/ui components: Input, Textarea, Label, Button
- Show loading spinner during fetch
- Show toast on save success/error
- "Save Changes" button disabled when no changes or saving

**Labels in English** (admin interface).
  </action>
  <verify>
Component renders, shows loading, displays form fields.
Form submits to API and shows success toast.
  </verify>
  <done>
PersonaTab component displays and saves persona settings.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate Persona Tab and Rename Page</name>
  <files>
src/app/(dashboard)/[workspace]/knowledge-base/knowledge-base-client.tsx
src/components/workspace/sidebar.tsx
  </files>
  <action>
**knowledge-base-client.tsx updates:**
1. Rename page header from "Knowledge Base" to "Your Intern"
2. Update description to "Configure your intern's persona, conversation flow, knowledge, and scoring"
3. Change tab order: Persona (default) -> Flow -> Database -> Scoring -> Slots
4. Import and render PersonaTab in the persona tab content
5. Keep other tabs as disabled placeholders (Flow, Database, Scoring) - they'll be built in subsequent plans

**Tab structure:**
- Persona (enabled, default active) - use Bot icon
- Flow (disabled placeholder) - use GitBranch icon
- Database (disabled placeholder) - use Database icon
- Scoring (disabled placeholder) - use Target icon
- Slots (enabled, existing) - use Calendar icon

**sidebar.tsx update:**
1. Change "Knowledge Base" to "Your Intern" in adminNav
2. Keep same href (/knowledge-base) and BookOpen icon
  </action>
  <verify>
- Navigate to /[workspace]/knowledge-base
- Page title shows "Your Intern"
- Persona tab is default active and shows PersonaTab component
- Sidebar shows "Your Intern" instead of "Knowledge Base"
  </verify>
  <done>
Page renamed to "Your Intern", Persona tab integrated and working, sidebar updated.
  </done>
</task>

</tasks>

<verification>
1. Navigate to /[workspace]/knowledge-base
2. Page title is "Your Intern"
3. Persona tab is active by default
4. Can edit intern name, tone, greeting template, community link
5. Clicking Save persists changes
6. Refreshing page shows saved values
7. Sidebar shows "Your Intern" navigation item
</verification>

<success_criteria>
- ADMIN-01: Bot name editable (default "ARI") - COMPLETE
- ADMIN-02: Greeting style via tone description textarea - COMPLETE
- ADMIN-03: Language setting skipped (fixed Indonesian per CONTEXT.md) - N/A
- ADMIN-04: Tone configuration via description textarea - COMPLETE
- ADMIN-05: Community link setting for cold leads - COMPLETE
</success_criteria>

<output>
After completion, create `.planning/phases/06-admin-interface/06-01-SUMMARY.md`
</output>
