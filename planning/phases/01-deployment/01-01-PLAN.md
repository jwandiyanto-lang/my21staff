---
phase: 01-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

user_setup:
  - service: vercel
    why: "Deploy Next.js app"
    env_vars:
      - name: NEXT_PUBLIC_CONVEX_URL
        source: "Already have: https://intent-otter-212.convex.cloud"
      - name: NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
        source: "Clerk Dashboard -> API Keys"
      - name: CLERK_SECRET_KEY
        source: "Clerk Dashboard -> API Keys"
      - name: CLERK_JWT_ISSUER_DOMAIN
        source: "Clerk Dashboard -> JWT Templates"
      - name: RESEND_API_KEY
        source: "Resend Dashboard -> API Keys"
      - name: GROK_API_KEY
        source: "xAI Dashboard (optional)"
      - name: ENCRYPTION_KEY
        source: "Generate: openssl rand -base64 32"
      - name: KAPSO_API_KEY
        source: "Kapso Dashboard"
      - name: KAPSO_WEBHOOK_SECRET
        source: "Kapso Dashboard -> Webhooks"
  - service: kapso
    why: "WhatsApp webhook endpoint"
    dashboard_config:
      - task: "Update webhook URL to production"
        location: "Kapso Dashboard -> Webhooks"

must_haves:
  truths:
    - "User can access my21staff at production URL"
    - "Eagle team can log in with Clerk authentication"
    - "Convex data loads correctly in production UI"
    - "Environment variables configured for all services"
  artifacts:
    - path: "Vercel project"
      provides: "Production deployment"
    - path: "Production URL"
      provides: "Accessible application"
  key_links:
    - from: "Production URL"
      to: "Clerk auth"
      via: "Environment variables"
    - from: "Production URL"
      to: "Convex database"
      via: "NEXT_PUBLIC_CONVEX_URL"
---

<objective>
Deploy my21staff to production with fresh Vercel project.

Purpose: Get the application live and accessible for Eagle Overseas Education as the first client.
Output: Production URL serving the app with all integrations working.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@planning/PROJECT.md
@planning/ROADMAP.md
@planning/STATE.md
@.env.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vercel project and initial deploy</name>
  <files>None (external service)</files>
  <action>
    1. Authenticate with Vercel CLI: `vercel login`
    2. Create new project: `vercel --yes` (auto-confirms project creation)
    3. Note the deployment URL from output

    If auth fails, create checkpoint for user to authenticate.

    The codebase is already production-ready. This just creates the Vercel project and does initial deploy.
  </action>
  <verify>`vercel ls` shows the project</verify>
  <done>Vercel project exists and initial deployment completed (may show errors due to missing env vars - that's expected)</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Configure production environment variables</name>
  <what-needed>
    Environment variables must be set in Vercel Dashboard for the deployment to work.
    Claude cannot access Vercel Dashboard directly.
  </what-needed>
  <action>
    Go to Vercel Dashboard -> Project -> Settings -> Environment Variables

    Add these variables for Production environment:

    **Convex (already deployed):**
    - NEXT_PUBLIC_CONVEX_URL = https://intent-otter-212.convex.cloud

    **Clerk (copy from local .env or Clerk Dashboard):**
    - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
    - CLERK_SECRET_KEY
    - CLERK_JWT_ISSUER_DOMAIN
    - NEXT_PUBLIC_CLERK_SIGN_IN_URL = /sign-in
    - NEXT_PUBLIC_CLERK_SIGN_UP_URL = /sign-up
    - NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL = /dashboard
    - NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL = /dashboard

    **Kapso (from Kapso Dashboard):**
    - KAPSO_API_KEY
    - KAPSO_WEBHOOK_SECRET
    - NEXT_PUBLIC_KAPSO_PHONE_NUMBER

    **Other services:**
    - RESEND_API_KEY
    - GROK_API_KEY (if using Grok)
    - ENCRYPTION_KEY (generate: openssl rand -base64 32)

    After adding all variables, trigger a redeploy from Vercel Dashboard.
  </action>
  <resume-signal>Type "deployed" when env vars are set and redeploy is complete</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify deployment and configure domain</name>
  <what-built>Production deployment with all integrations</what-built>
  <how-to-verify>
    1. Visit the Vercel deployment URL (e.g., my21staff-xxx.vercel.app)
    2. Verify the landing page loads correctly
    3. Click "Sign In" and verify Clerk auth page appears
    4. Sign in as Eagle team member
    5. Verify Dashboard loads with Convex data

    **Domain setup (optional):**
    - If using custom domain: Vercel Dashboard -> Domains -> Add my21staff.com
    - Update DNS records as Vercel instructs

    **Kapso webhook update (DEPLOY-04):**
    - Go to Kapso Dashboard -> Webhooks
    - Update webhook URL to: https://[production-url]/api/webhook/kapso
    - Save and verify the webhook is active
  </how-to-verify>
  <resume-signal>Type "verified" with the production URL, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
After Task 3 completes:
- [ ] Production URL accessible (not 500 error)
- [ ] Clerk auth working (can sign in)
- [ ] Dashboard shows data from Convex
- [ ] Kapso webhook URL updated to production
</verification>

<success_criteria>
All DEPLOY-01 through DEPLOY-04 requirements met:
- Fresh Vercel project created and connected
- Production environment variables configured
- Domain accessible (Vercel subdomain or custom)
- Kapso webhook URL updated to production endpoint
</success_criteria>

<output>
After completion, create `.planning/phases/01-deployment/01-01-SUMMARY.md`
</output>
